(function () {
    var Constants;
    var TankTroubleAddons = TankTroubleAddons || {
        parseJSON: function (object) {
            if (object.constructor.name === String.name) {
                object = JSON.parse(object);
            }
            for (let [key, value] of Object.entries(object)) {
                if (value.constructor.name === Object.name) {
                    object[key] = this.parseJSON(value)
                }
                try {
                    var item = new Function('return ' + value)();
                    if (item.nodeType === Node.ELEMENT_NODE) {
                        item = value
                    }
                } catch (error) {
                    switch (error.constructor) {
                        case ReferenceError:
                        case SyntaxError:
                            object[key] = value;
                            continue;
                        default:
                            object[key] = value;
                            console.warn(error);
                            continue
                    }
                }
                object[key] = item
            }
            return object
        },
        main: function () {
            fetch(chrome.runtime.getURL('Constants.json'))
                .then(response => response.json())
                .then(data => {
                    Constants = this.parseJSON(data);
                    if (window.location.host === 'classic.tanktrouble.com') {
                        chrome.storage.local.get([Constants.REQUESTS.darkTheme], function (result) {
                            if (result[Constants.REQUESTS.darkTheme]) {
                                document.head.insertAdjacentHTML('beforeend', '<link rel="stylesheet" id="classicAddonsCSS" type="text/css" href="' + Constants.CSS_DARK_STYLESHEET_CLASSIC + '">')
                            }
                        });
                        return;
                    }
                    chrome.storage.local.get([Constants.REQUESTS.darkTheme], function (result) {
                        var stylesheetName;
                        if (result[Constants.REQUESTS.darkTheme]) {
                            stylesheetName = Constants.CSS_DARK_STYLESHEET;
                            document.documentElement.classList.add("dark");
                        } else {
                            stylesheetName = Constants.CSS_DEFAULT_STYLESHEET;
                            document.documentElement.classList.remove("dark");
                        }
                        document.head.insertAdjacentHTML('beforeend', '<link rel="stylesheet" id="addonsCSS" type="text/css" href="' + stylesheetName + '">')
                    });
                    document.head.insertAdjacentHTML('beforeend', '<link rel="stylesheet" id="fontCSS" type="text/css" href="' + Constants.CSS_EMPTY + '">');
                    chrome.storage.local.get([Constants.REQUESTS.alternativeFont], function (result) {
                        if (result[Constants.REQUESTS.alternativeFont]) {
                            document.getElementById('fontCSS').href = Constants.CSS_ATKINSON_FONT
                        }
                    });

                    function handleRequest(request, sendResponse) {
                        switch (request.method) {
                            case Constants.REQUESTS.darkTheme:
                                if (request.data) {
                                    document.getElementById('addonsCSS').href = Constants.CSS_DARK_STYLESHEET;
                                    document.documentElement.classList.add("dark");
                                } else {
                                    document.getElementById('addonsCSS').href = Constants.CSS_DEFAULT_STYLESHEET;
                                    document.documentElement.classList.remove("dark");
                                }
                                break;
                            case Constants.REQUESTS.alternativeFont:
                                if (request.data) {
                                    document.getElementById('fontCSS').href = Constants.CSS_ATKINSON_FONT
                                } else {
                                    document.getElementById('fontCSS').href = Constants.CSS_EMPTY
                                }
                                break;
                            case Constants.REQUESTS.musicTheme:
                                var musicTheme;
                                if (request.data) {
                                    musicTheme = Constants.MUSIC.RussianMarchPiano
                                } else {
                                    musicTheme = Constants.MUSIC.RussianMarch
                                }
                                var setMusicTheme = new CustomEvent(request.method, {
                                    detail: {
                                        theme: musicTheme
                                    }
                                });
                                document.dispatchEvent(setMusicTheme);
                                break;
                            case Constants.REQUESTS.classicMouse:
                            case Constants.REQUESTS.systemMessages:
                            case Constants.REQUESTS.highResTanks:
                                localStorage.setItem(request.method, request.data);
                                break;
                            default:
                                console.warn((new Error).stack, 'Invalid request called: ' + request.method);
                                break;
                        }
                    }
                    chrome.extension.onMessage.addListener(function (request, sender, sendResponse) {
                        handleRequest(request, sendResponse);
                        sendResponse({});
                    });
                    var scripts = [{
                        id: "d_url",
                        innerHTML: "var d_url=function(url){return'" + Constants.URL_EMPTY + "'+url};"
                    }, 

                    {
                        id: "Utils_addTTAddonsImageWithClasses",
                        innerHTML: "Utils.classMethod('addAddonsImageWithClasses',function(container,classes,src){var image=$('<img class=\"'+classes+'\"/>');image.attr('src',d_url(src));if(src.substring(src.length-4)==='.png'){var srcset=d_url(src.substring(0,src.length-4)+'@2x.png')+' 2x';image.attr('srcset',srcset)}container.append(image);return container});"
                    }, 

                    {
                        id: "parseJSON",
                        innerHTML: "var TankTroubleAddons=TankTroubleAddons||{};TankTroubleAddons.parseJSON=function(r){if(r.constructor.name===String.name){r=JSON.parse(r)}for(let[e,n]of Object.entries(r)){if(n.constructor.name===Object.name){r[e]=this.parseJSON(n)}try{var t=new Function(\"return \"+n)();if(t.nodeType===Node.ELEMENT_NODE){t=n}}catch(o){switch(o.constructor){case ReferenceError:case SyntaxError:r[e]=n;continue;default:console.log(o);continue}}r[e]=t}return r};"
                    }, 

                    {
                        id: "tankRenderingImprovements",
                        innerHTML: "var TankTroubleAddons=TankTroubleAddons||{};TankTroubleAddons.isHighresTanksEnabled=function(){return eval(localStorage.getItem('highResTanks'))?true:false};UITankIcon.classMethod('loadPlayerTankIcon',function(canvas,size,playerId,onReady,context){Backend.getInstance().getPlayerDetails(function(result){if(typeof result=='object'){var adminStatus=TankTroubleAddons.getAdminStatus(result);var turretColour=result.getTurretColour();var treadColour=result.getTreadColour();var baseColour=result.getBaseColour();var turretAccessory=result.getTurretAccessory();var barrelAccessory=result.getBarrelAccessory();var frontAccessory=result.getFrontAccessory();var backAccessory=result.getBackAccessory();var badge=adminStatus=='false'||TankTroubleAddons.isHighresTanksEnabled()?'0':adminStatus=='active'?'1':'2';if(!turretColour||!treadColour||!baseColour||!turretAccessory||!barrelAccessory||!frontAccessory||!backAccessory||!badge){return}if(onReady&&context){UITankIcon.loadTankIcon(canvas,size,turretColour,treadColour,baseColour,turretAccessory,barrelAccessory,frontAccessory,backAccessory,null,null,badge,onReady,context)}else{UITankIcon.loadTankIcon(canvas,size,turretColour,treadColour,baseColour,turretAccessory,barrelAccessory,frontAccessory,backAccessory,null,null,badge,function(self){},self)}}else{if(onReady&&context){UITankIcon.loadTankIcon(canvas,size,UIConstants.TANK_UNAVAILABLE_COLOUR,UIConstants.TANK_UNAVAILABLE_COLOUR,UIConstants.TANK_UNAVAILABLE_COLOUR,null,null,null,null,null,null,null,onReady,context)}else{UITankIcon.loadTankIcon(canvas,size,UIConstants.TANK_UNAVAILABLE_COLOUR,UIConstants.TANK_UNAVAILABLE_COLOUR,UIConstants.TANK_UNAVAILABLE_COLOUR,null,null,null,null,null,null,null,function(self){},self)}}},function(){},function(){},playerId,Caches.getPlayerDetailsCache())});UITankIcon.classMethod('loadTankIcon',function(canvas,size,turretColour,treadColour,baseColour,turretAccessory,barrelAccessory,frontAccessory,backAccessory,treadAccessory,backgroundAccessory,badge,onReady,context){var loader=UITankIconLoader.create(canvas,size);loader.queueColour(UIConstants.TANK_ICON_TINT_PARTS.TURRET,turretColour);loader.queueColour(UIConstants.TANK_ICON_TINT_PARTS.TREAD,treadColour);loader.queueColour(UIConstants.TANK_ICON_TINT_PARTS.BASE,baseColour);loader.queueAccessory(UIConstants.TANK_ICON_ACCESSORY_PARTS.TURRET,turretAccessory);loader.queueAccessory(UIConstants.TANK_ICON_ACCESSORY_PARTS.BARREL,barrelAccessory);loader.queueAccessory(UIConstants.TANK_ICON_ACCESSORY_PARTS.FRONT,frontAccessory);loader.queueAccessory(UIConstants.TANK_ICON_ACCESSORY_PARTS.BACK,backAccessory);loader.queueAccessory(UIConstants.TANK_ICON_ACCESSORY_PARTS.TREAD,treadAccessory);loader.queueAccessory(UIConstants.TANK_ICON_ACCESSORY_PARTS.BACKGROUND,backgroundAccessory);loader.queueAccessory(UIConstants.TANK_ICON_ACCESSORY_PARTS.BADGE,badge);loader.onReady(onReady,context);loader.start()});UITankIconLoader.method('queueAddons',function(part,accessory){if(accessory!==null&&accessory!==undefined&&accessory!=='0'&&!TankTroubleAddons.isHighresTanksEnabled()){this._queueImage('accessories/',part,accessory,this.accessories,part,true)}});UITankIcon.classMethod('drawTankIcon',function(canvas,turretColour,treadColour,baseColour,turret,barrel,leftTread,rightTread,base,turretShade,barrelShade,leftTreadShade,rightTreadShade,baseShade,turretAccessory,barrelAccessory,frontAccessory,backAccessory,treadAccessory,backgroundAccessory,badge){var context=canvas.getContext('2d');if(canvas.width!=this.compositedBuffer.width||canvas.height!=this.compositedBuffer.height){this.compositedBuffer.width=canvas.width;this.compositedBuffer.height=canvas.height}var compositedContext=this.compositedBuffer.getContext('2d');compositedContext.clearRect(0,0,canvas.width,canvas.height);if(canvas.width!=this.tintedBuffer.width||canvas.height!=this.tintedBuffer.height){this.tintedBuffer.width=canvas.width;this.tintedBuffer.height=canvas.height}var tintedContext=this.tintedBuffer.getContext('2d');tintedContext.clearRect(0,0,canvas.width,canvas.height);if(backAccessory instanceof HTMLImageElement){compositedContext.drawImage(backAccessory,0,0,canvas.width,canvas.height)}tintedContext.globalCompositeOperation='copy';if(treadColour instanceof HTMLImageElement){tintedContext.drawImage(treadColour,0,0,canvas.width,canvas.height)}else{tintedContext.fillStyle=treadColour;tintedContext.fillRect(0,0,canvas.width,canvas.height)}tintedContext.globalCompositeOperation='destination-atop';tintedContext.drawImage(leftTread,0,0,canvas.width,canvas.height);compositedContext.drawImage(this.tintedBuffer,0,0);compositedContext.drawImage(leftTreadShade,0,0,canvas.width,canvas.height);tintedContext.globalCompositeOperation='copy';if(turretColour instanceof HTMLImageElement){tintedContext.drawImage(turretColour,0,0,canvas.width,canvas.height)}else{tintedContext.fillStyle=turretColour;tintedContext.fillRect(0,0,canvas.width,canvas.height)}tintedContext.globalCompositeOperation='destination-atop';tintedContext.drawImage(turret,0,0,canvas.width,canvas.height);compositedContext.drawImage(this.tintedBuffer,0,0);compositedContext.drawImage(turretShade,0,0,canvas.width,canvas.height);tintedContext.globalCompositeOperation='copy';if(baseColour instanceof HTMLImageElement){tintedContext.drawImage(baseColour,0,0,canvas.width,canvas.height)}else{tintedContext.fillStyle=baseColour;tintedContext.fillRect(0,0,canvas.width,canvas.height)}tintedContext.globalCompositeOperation='destination-atop';tintedContext.drawImage(base,0,0,canvas.width,canvas.height);compositedContext.drawImage(this.tintedBuffer,0,0);compositedContext.drawImage(baseShade,0,0,canvas.width,canvas.height);tintedContext.globalCompositeOperation='copy';if(treadColour instanceof HTMLImageElement){tintedContext.drawImage(treadColour,0,0,canvas.width,canvas.height)}else{tintedContext.fillStyle=treadColour;tintedContext.fillRect(0,0,canvas.width,canvas.height)}tintedContext.globalCompositeOperation='destination-atop';tintedContext.drawImage(rightTread,0,0,canvas.width,canvas.height);compositedContext.drawImage(this.tintedBuffer,0,0);compositedContext.drawImage(rightTreadShade,0,0,canvas.width,canvas.height);tintedContext.globalCompositeOperation='copy';if(turretColour instanceof HTMLImageElement){tintedContext.drawImage(turretColour,0,0,canvas.width,canvas.height)}else{tintedContext.fillStyle=turretColour;tintedContext.fillRect(0,0,canvas.width,canvas.height)}tintedContext.globalCompositeOperation='destination-atop';tintedContext.drawImage(barrel,0,0,canvas.width,canvas.height);compositedContext.drawImage(this.tintedBuffer,0,0);compositedContext.drawImage(barrelShade,0,0,canvas.width,canvas.height);if(turretAccessory instanceof HTMLImageElement){compositedContext.drawImage(turretAccessory,0,0,canvas.width,canvas.height)}if(frontAccessory instanceof HTMLImageElement){compositedContext.drawImage(frontAccessory,0,0,canvas.width,canvas.height)}if(barrelAccessory instanceof HTMLImageElement){compositedContext.drawImage(barrelAccessory,0,0,canvas.width,canvas.height)}if(badge instanceof HTMLImageElement){compositedContext.drawImage(badge,0,0,canvas.width,canvas.height)}if(canvas.width!=this.outlineBuffer.width||canvas.height!=this.outlineBuffer.height){this.outlineBuffer.width=canvas.width;this.outlineBuffer.height=canvas.height}var outlineContext=this.outlineBuffer.getContext('2d');outlineContext.globalCompositeOperation='copy';outlineContext.fillStyle='rgba(0,0,0, 0.8)';outlineContext.fillRect(0,0,canvas.width,canvas.height);outlineContext.globalCompositeOperation='destination-atop';outlineContext.drawImage(this.compositedBuffer,0,0);if(!TankTroubleAddons.isHighresTanksEnabled()){var width=UIConstants.TANK_ICON_OUTLINE_WIDTH;var diagWidth=Math.sqrt(width*width/2);context.drawImage(this.outlineBuffer,-width,0);context.drawImage(this.outlineBuffer,-diagWidth,-diagWidth);context.drawImage(this.outlineBuffer,-diagWidth,diagWidth);context.drawImage(this.outlineBuffer,0,width);context.drawImage(this.outlineBuffer,0,-width);context.drawImage(this.outlineBuffer,diagWidth,-diagWidth);context.drawImage(this.outlineBuffer,diagWidth,diagWidth);context.drawImage(this.outlineBuffer,width,0)}context.drawImage(this.compositedBuffer,0,0)});UITankIconLoader.method('_queueImage',function(basePath,part,image,output,customKey){var key=part;if(customKey!==undefined){key=customKey}var cachedImage=UITankIconLoader.imageCache[part+image+'-'+this.size];if(cachedImage===undefined){var highresEnabled=TankTroubleAddons.isHighresTanksEnabled();var imageName=basePath+part+image+'-'+(highresEnabled?UIConstants.TANK_ICON_RESOLUTIONS['large']:UIConstants.TANK_ICON_RESOLUTIONS[this.size]);if(imageName.includes('assets')){var imgName=imageName.substring(14)}else{var imgName=imageName}var src=d_url('images/'+imgName+'.png');if(highresEnabled){src=d_url('images/'+imgName+'@2x.png')}var srcset=d_url('images/'+imgName+'@2x.png')+' 2x';var imageElement=$('<img src=\"'+src+'\" srcset=\"'+srcset+'\" crossorigin=\"anonymous\"/>');var self=this;imageElement.load(function(result){output[key]=imageElement[0];++self.numImagesLoaded;self._checkIfDone()});imageElement.error(function(result){var failsafeImageElement=$('<img src=\"'+g_url('assets/images/'+imgName+'.png')+'\" srcset=\"'+g_url('assets/images/'+imgName+'@2x.png')+' 2x\" crossorigin=\"anonymous\"/>');failsafeImageElement.load(function(){output[key]=failsafeImageElement[0];++self.numImagesLoaded;self._checkIfDone()});failsafeImageElement.error(function(){++self.numImagesLoaded;self._checkIfDone()})})}else{output[key]=cachedImage;++this.numImagesLoaded}++this.numImages});"
                    }, 

                    {
                        id: "maskUsernames",
                        innerHTML: "var TankTroubleAddons=TankTroubleAddons||{};TankTroubleAddons.getAdminStatus=function(playerDetails){return playerDetails.getGmLevel()>=UIConstants.ADMIN_LEVEL_PLAYER_LOOKUP?'active':TankTrouble.WallOfFame.admins.includes(playerDetails.getUsername())?'retired':'false'};Utils.classMethod('maskUnapprovedUsername',function(playerDetails){var isLoggedIn=Users.isAnyUser(playerDetails.getPlayerId());var adminStatus=TankTroubleAddons.getAdminStatus(playerDetails);var isUsernameUnapproved=!playerDetails.getUsernameApproved();var adminAuthenticated=Users.getHighestGmLevel()>=UIConstants.ADMIN_LEVEL_PLAYER_LOOKUP;switch(true){case adminStatus=='active':if(isUsernameUnapproved){return'(GM'+playerDetails.getGmLevel()+') × '+playerDetails.getUsername()+' ×'}return'(GM'+playerDetails.getGmLevel()+') '+playerDetails.getUsername();break;case adminStatus=='retired':if(isUsernameUnapproved){if(isLoggedIn){return'(Retd.) × '+playerDetails.getUsername()+' ×'}}return'(Retd.) '+playerDetails.getUsername();break;default:if(isUsernameUnapproved){if(adminAuthenticated){return'× '+playerDetails.getUsername()+' ×'}return'× × ×'}return playerDetails.getUsername()}});"
                    }, 

                    {
                        id: "forumThreadHighlight",
                        innerHTML: "ForumView.method('checkForUnmoderatedReplies',function(thread,animate){if(Users.highestGmLevel>=UIConstants.ADMIN_LEVEL_APPROVE_THREAD_OR_REPLY){var self=this;Backend.getInstance().getForumReplies(function(result){if(typeof result=='object'){var replies=result.result.data.replies;if(replies.length>0){for(var i=0;i<replies.length;i++){if(replies[i].approved==false&&replies[i].deleted==false){i=replies.length;thread.html.threadlist=$(thread.html.threadlist).addClass('unmoderatedReplies').prop('outerHTML');self.mergeThread(thread,animate)}}}}else{self.mergeThread(thread,animate)}},function(result){},function(result){},thread.id,Number.MAX_SAFE_INTEGER,'older',0,3)}else{this.mergeThread(thread,animate)}});ForumView.method('threadListChanged',function(threadList,animate){this.changeState(ForumView.STATE_THREADLIST);if(this.model.getTrackingNewestThreads()){Forum.getInstance().startThreadSynchronization(UIConstants.FORUM_THREAD_REFRESH_INTERVAL,!this.suppressNextUpdateAnimation)}else{Forum.getInstance().stopSynchronization(!this.suppressNextUpdateAnimation)}for(var i=0;i<threadList.length;i++){this.mergeThread(threadList[i],animate);this.checkForUnmoderatedReplies(threadList[i],animate)}$('.forum .thread[id]').each(function(){var t=$(this).data();for(i=0;i<threadList.length;i++){if(threadList[i].id==t.id){if(threadList[i].time<=t.time){return}}}if(animate){$(this).css('height',$(this).height()).css('min-height',0).animate({opacity:0},300).animate({height:0,marginTop:0},300,function(){$(this).remove()})}else{$(this).remove()}});var pageCount=Math.ceil(this.model.getThreadCount()/this.model.getThreadRequestSize());var currentPage=Math.floor(pageCount-(this.model.getThreadCount()-this.model.getThreadOffset())/this.model.getThreadRequestSize()-1);Forum.log.debug(this.model.getThreadOffset()+'/'+this.model.getThreadCount());Forum.log.debug(currentPage+'/'+pageCount);this.updatePaginator($('.threadsPaginator').first(),currentPage,pageCount,this.threadPageFunctions,false,false,false,!this.suppressNextUpdateAnimation);this.updatePaginator($('.threadsPaginator').last(),currentPage,pageCount,this.threadPageFunctions,false,false,false,!this.suppressNextUpdateAnimation);Forum.getInstance().updateComposeAndStatus(!this.suppressNextUpdateAnimation,true);this.suppressNextUpdateAnimation=false;Forum.log.debug('Pushing thread list length '+threadList.length);var data={id:this.model.getCurrentThreadWindowNewestThreadId()};Content.updateTab('forum','/forum?id='+data.id,data,this.replaceNextHistory);this.replaceNextHistory=false});"
                    }, 

                    {
                        id: "forumAdditions",
                        innerHTML: "ForumView.method('mergeReply',function(reply,i,animate){var inserted=false;$('.forum .reply').each(function(){var r=$(this).data();if(reply.id==r.id){Forum.log.debug('VIEW REPLY UPDATE');var replyHtml=$(reply.html.replylist);var newContent=replyHtml.find('.content');var newDetails=replyHtml.find('.details');if(reply.latestEdit!==null){$(newDetails).text($(newDetails).html().trim()+' [Edited '+Utils.forumTimeDiffToString(reply.time,reply.latestEdit)+' ago]')}$(this).find('.content').replaceWith(newContent);$(this).find('.details').replaceWith(newDetails);$(this).removeClass('banned deleted approved moderatable approvable deletable bannable editable likable liked').addClass(replyHtml.attr('class'));$(this).data(reply);inserted=true;return false}else if(reply.id<r.id){Forum.log.debug('VIEW REPLY MERGE');var atLeft=(Forum.getInstance().getSelectedThreadReplyOffset()+i)%2==1;var replyHtml=$(reply.html.replylist);var newDetails=replyHtml.find('.details');if(reply.latestEdit!==null){$(newDetails).text($(newDetails).html().trim()+' [Edited '+Utils.forumTimeDiffToString(reply.time,reply.latestEdit)+' ago]')}$(replyHtml).find('.details').replaceWith(newDetails);replyHtml.addClass(atLeft?'left':'right');if(animate){replyHtml.addClass('collapsed')}replyHtml.data(reply);[reply.coCreator1,reply.coCreator2].forEach(function(playerId,index){index=index+1;if(playerId!==null){var coCreatorDiv=$(\"<div style='position: absolute;'></div>\");var canvas=$(\"<canvas id='reply-\"+reply.id+'-coTank'+index+\"'></canvas>\");canvas=canvas[0];coCreatorDiv.on('mouseup',function(event){var position=$(this).offset();TankTrouble.TankInfoBox.show(position.left+$(this).width()/2,position.top+$(this).height()/2,playerId,$(this).width()/2,$(this).height()/4)});canvas.width=UIConstants.TANK_ICON_WIDTH_SMALL;canvas.height=UIConstants.TANK_ICON_HEIGHT_SMALL;canvas.style.width=UIConstants.TANK_ICON_RESOLUTIONS[UIConstants.TANK_ICON_SIZES.SMALL]*(1-index/5)+'px';canvas.style.height=UIConstants.TANK_ICON_RESOLUTIONS[UIConstants.TANK_ICON_SIZES.SMALL]*.6*(1-index/5)+'px';coCreatorDiv.css('top',UIConstants.TANK_ICON_RESOLUTIONS[UIConstants.TANK_ICON_SIZES.SMALL]*(index/10)+'px');coCreatorDiv.css('left',(atLeft?'-':'')+60*(index*.9)+'px');UITankIcon.loadPlayerTankIcon(canvas,UIConstants.TANK_ICON_SIZES.SMALL,playerId);coCreatorDiv.append(canvas);replyHtml.find('.tank').append(coCreatorDiv)}});replyHtml.insertBefore($(this));if(animate){insertedReplyHeight=replyHtml.height();replyHtml.css({minHeight:0,height:0,opacity:0});replyHtml.delay(300).animate({height:insertedReplyHeight},300).animate({opacity:1},300,function(){$(this).removeAttr('style')});replyHtml.removeClass('collapsed')}inserted=true;return false}});if(!inserted){Forum.log.debug('VIEW REPLY BOTTOM');var previousReply=$('.forum .reply').last();var atLeft=false;if(previousReply.length>0){Forum.log.debug('RELATIVE PLACEMENT');atLeft=previousReply.hasClass('left')?false:true}else{Forum.log.debug('ABSOLUTE PLACEMENT');atLeft=(Forum.getInstance().getSelectedThreadReplyOffset()+i)%2==1}var replyHtml=$(reply.html.replylist);var newDetails=replyHtml.find('.details');if(reply.latestEdit!==null){$(newDetails).text($(newDetails).html().trim()+' [Edited '+Utils.forumTimeDiffToString(reply.time,reply.latestEdit)+' ago]')}$(replyHtml).find('.details').replaceWith(newDetails);replyHtml.addClass(atLeft?'left':'right');if(animate){replyHtml.addClass('collapsed')}replyHtml.data(reply);[reply.coCreator1,reply.coCreator2].forEach(function(playerId,index){index=index+1;if(playerId!==null){var coCreatorDiv=$(\"<div style='position: absolute;'></div>\");var canvas=$(\"<canvas id='reply-\"+reply.id+'-coTank'+index+\"'></canvas>\");canvas=canvas[0];coCreatorDiv.on('mouseup',function(event){var position=$(this).offset();TankTrouble.TankInfoBox.show(position.left+$(this).width()/2,position.top+$(this).height()/2,playerId,$(this).width()/2,$(this).height()/4)});canvas.width=UIConstants.TANK_ICON_WIDTH_SMALL;canvas.height=UIConstants.TANK_ICON_HEIGHT_SMALL;canvas.style.width=UIConstants.TANK_ICON_RESOLUTIONS[UIConstants.TANK_ICON_SIZES.SMALL]*(1-index/5)+'px';canvas.style.height=UIConstants.TANK_ICON_RESOLUTIONS[UIConstants.TANK_ICON_SIZES.SMALL]*.6*(1-index/5)+'px';coCreatorDiv.css('top',UIConstants.TANK_ICON_RESOLUTIONS[UIConstants.TANK_ICON_SIZES.SMALL]*(index/10)+'px');coCreatorDiv.css('left',(atLeft?'-':'')+32*(1.5+index**2/2.5)+'px');UITankIcon.loadPlayerTankIcon(canvas,UIConstants.TANK_ICON_SIZES.SMALL,playerId);coCreatorDiv.append(canvas);replyHtml.find('.tank').append(coCreatorDiv)}});replyHtml.appendTo('#repliesContainer');if(animate){insertedReplyHeight=replyHtml.height();replyHtml.css({minHeight:0,height:0,opacity:0});replyHtml.delay(300).animate({height:insertedReplyHeight},300).animate({opacity:1},300,function(){$(this).removeAttr('style')});replyHtml.removeClass('collapsed')}}});ForumView.method('replyUpdated',function(reply){var existingReply=$('#reply-'+reply.id);var r=existingReply.data();if(r&&reply.id==r.id){Forum.log.debug('VIEW REPLY UPDATE SINGLE');var replyHtml=$(reply.html.replylist);var newContent=replyHtml.find('.content');var newDetails=replyHtml.find('.details');if(reply.latestEdit!==null){$(newDetails).text($(newDetails).html().trim()+' [Edited '+Utils.forumTimeDiffToString(reply.time,reply.latestEdit)+' ago]')}existingReply.find('.content').replaceWith(newContent);existingReply.find('.details').replaceWith(newDetails);existingReply.removeClass('banned deleted approved moderatable approvable deletable bannable editable likable liked').addClass(replyHtml.attr('class'));existingReply.data(reply);this.updateSingleBubbleAndActionWidth(existingReply);this.updateModerationTooltip(existingReply);Forum.getInstance().checkCooldown(true)}});Utils.classMethod('forumTimeDiffToString',function(now,then){if(then>now){return'no time'}else{var diff=now-then;if(diff>31536e3){var years=Math.floor(diff/31536e3);return years+' year'+(years!=1?'s':'')}else if(diff>2678400){var months=Math.floor(diff/2678400);return months+' month'+(months!=1?'s':'')}else if(diff>604800){var weeks=Math.floor(diff/604800);return weeks+' week'+(weeks!=1?'s':'')}else if(diff>86400){var days=Math.floor(diff/86400);return days+' day'+(days!=1?'s':'')}else if(diff>3600){var hours=Math.floor(diff/3600);return hours+' hour'+(hours!=1?'s':'')}else if(diff>60){var minutes=Math.floor(diff/60);return minutes+' minute'+(minutes!=1?'s':'')}else{var seconds=Math.floor(diff/1);return seconds+' second'+(seconds!==1?'s':'')}}});"
                    }, 

                    {
                        id: "qualityScript",
                        innerHTML: "TankTrouble.SettingsBox.init=function(){if(this.initialized){this.settings=null;this.settingsContent=null;this.settingsTabTop=null;this.settingsServerTitleDiv=null;this.settingsServerForm=null;this.settingsServerSelect=null;this.settingsServerOptions=[];this.settingsQualityTitleDiv=null;this.settingsQualityForm=null;this.settingsQualitySelect=null;this.settingsQualityOptions=[];this.settingsBackground=null;this.refreshServerStatsInterval=null}if(window.g_url){$.widget('custom.iconselectmenu',$.ui.selectmenu,{_renderItem:function(ul,item){var li=$('<li>',{text:item.label});if(item.disabled){li.addClass('ui-state-disabled')}if(item.element.attr('data-imagesrc')){$('<img width=\"26\" src=\"'+item.element.attr('data-imagesrc')+'\" srcset=\"'+item.element.attr('data-imagesrcset')+'\"/>').addClass('ui-icon').appendTo(li)}if(item.element.attr('data-description')){$('<div style=\"font-size: 0.7em;\">'+item.element.attr('data-description')+'</div>').appendTo(li)}return li.appendTo(ul)}});this.settings=$('<div class=\"box noselect\" id=\"settings\"></div>');this.settingsContent=$('<div class=\"content\"></div>');this.settingsTabTop=$('<div class=\"tab topRight\"></div>');this.settingsServerTitleDiv=$('<div class=\"spaced\">Server:</div>');this.settingsServerForm=$('<form class=\"spaced\"></form>');this.settingsServerSelect=$('<select/>');var servers=ClientManager.getAvailableServers();var serverIds=Object.keys(servers);for(var i=0;i<serverIds.length;++i){var serverData=servers[serverIds[i]];var option=$('<option disabled value=\"'+serverIds[i]+'\" data-imagesrc=\"'+g_url('assets/images/game/pingTimeNoConnection.png')+'\" data-imagesrcset=\"'+g_url('assets/images/game/pingTimeNoConnection@2x.png')+' 2x\" data-description=\" (N/A ms)\">'+serverData.name+'</option>');this.settingsServerOptions.push(option)}this.settingsQualityTitleDiv=$('<div class=\"spaced\">Quality:</div>');this.settingsQualityForm=$('<form class=\"spaced\"></form>');this.settingsQualitySelect=$('<select/>');this.settingsQualityOptions.push($('<option selected value=\"auto\" data-imagesrc=\"'+g_url('assets/images/game/pingTimeNoConnection.png')+'\" data-imagesrcset=\"'+g_url('assets/images/game/pingTimeNoConnection@2x.png')+' 2x\" data-description=\" (N/A fps)\">Auto</option>'));this.settingsQualityOptions.push($('<option value=\"high\">High</option>'));this.settingsQualityOptions.push($('<option value=\"low\">Low</option>'));this.settingsQualityOptions.push($('<option value=\"minimum\">Minimum</option>'));this.settingsBackground=$('<div class=\"boxbackground\"></div>');for(var i=0;i<this.settingsServerOptions.length;++i){this.settingsServerSelect.append(this.settingsServerOptions[i])}this.settingsServerForm.append(this.settingsServerSelect);for(var i=0;i<this.settingsQualityOptions.length;++i){this.settingsQualitySelect.append(this.settingsQualityOptions[i])}this.settingsQualityForm.append(this.settingsQualitySelect);this.settingsContent.append(this.settingsTabTop);this.settingsContent.append(this.settingsServerTitleDiv);this.settingsContent.append(this.settingsServerForm);this.settingsContent.append(this.settingsQualityTitleDiv);this.settingsContent.append(this.settingsQualityForm);this.settings.append(this.settingsContent);$('body').append(this.settingsBackground);$('body').append(this.settings);this.settingsBackground.hide();this.settings.hide();var self=this;this.settingsBackground.click(function(event){if(self.showing){self.hide()}});this.settingsServerSelect.css('width',UIConstants.SETTINGS_WIDTH-10);this.settingsServerSelect.css('height',UIConstants.SETTINGS_SERVER_SELECT_HEIGHT);this.settingsQualitySelect.css('width',UIConstants.SETTINGS_WIDTH-10);this.settingsQualitySelect.css('height',UIConstants.SETTINGS_QUALITY_SELECT_HEIGHT);if(Cookies.get('multiplayerserverid')){this.settingsServerSelect.val(Cookies.get('multiplayerserverid'))}if(Cookies.get('quality')){this.settingsQualitySelect.val(Cookies.get('quality'))}this.settingsServerSelect.iconselectmenu({change:function(event,ui){self._changeServer(event,ui)}}).iconselectmenu('menuWidget').addClass('ui-menu-icons').css('max-height',UIConstants.SETTINGS_SERVER_MAX_OPTION_HEIGHT);this.settingsQualitySelect.iconselectmenu({change:function(event,ui){self._changeQuality(event,ui)}}).iconselectmenu('menuWidget').addClass('ui-menu-icons').css('max-height',UIConstants.SETTINGS_QUALITY_MAX_OPTION_HEIGHT);this.initialized=true;QualityManager.addEventListener(this._qualityEventHandler,this);this._setQuality(QualityManager.getQuality());this.refreshServerStatsInterval=setInterval(function(){self._refreshServerStats()},UIConstants.REFRESH_SERVER_STATS_INTERVAL);setTimeout(function(){self._refreshServerStats()},UIConstants.INITIAL_SERVER_STATS_DELAY)}};QualityManager.QUALITY_SETTINGS.MINIMUM='minimum';QualityManager.QUALITY_VALUES['minimum']={'tank explosion smoke count':0,'tank explosion fragment count':0,'missile launch smoke count':0,'missile smoke frequency':360,'crate land dust count':0,'aimer min segment length':1,'aimer off max segment length':4,'aimer on max segment length':2,'bullet puff count':1,'shield inverse bolt probability':1,'shield spark particles per emit':0,'spawn zone inverse unstable particle probability':1,'spawn zone num collapse particles':0};UIConstants.SETTINGS_QUALITY_MAX_OPTION_HEIGHT=200;UIRubbleGroup.prototype.emit=function(tank){if(QualityManager.getQuality()!==QualityManager.QUALITY_SETTINGS.LOW&&QualityManager.getQuality()!==QualityManager.QUALITY_SETTINGS.MINIMUM){if(tank.getSpeed()!=0||tank.getRotationSpeed()!=0){this.exists=true;this.visible=true;var rubbleFragmentSprite=this.fragmentGroup.getFirstExists(false);if(rubbleFragmentSprite){rubbleFragmentSprite.spawn(UIUtils.mpx(tank.getX()),UIUtils.mpx(tank.getY()),tank.getRotation(),tank.getSpeed())}else{}this.emitter.emit(UIUtils.mpx(tank.getX()),UIUtils.mpx(tank.getY()),tank.getRotation(),tank.getSpeed())}}};Game.UIGameState.method('_addCameraShake',function(shake){if(QualityManager.getQuality()!==QualityManager.QUALITY_SETTINGS.MINIMUM){this.cameraShake=Math.min(UIConstants.MAX_CAMERA_SHAKE,this.cameraShake+shake)}else{this.cameraShake=0}});TankTrouble.SettingsBox.init();"
                    }, 

                    {
                        id: "tankInfoBoxImprovements",
                        innerHTML: "TankTrouble.TankInfoBox.infoControl=null;TankTrouble.TankInfoBox._initialize=function(){this.info=$('<div class=\"box noselect\" id=\"tankinfo\"/>');this.infoIcon=$('<canvas class=\"icon\"/>');this.iconCanvas=this.infoIcon[0];this.infoIconPlaceholder=$('<img class=\"icon\" src=\"'+g_url('assets/images/tankIcon/placeholder-320.png')+'\" srcset=\"'+g_url('assets/images/tankIcon/placeholder-320@2x.png')+' 2x\"/>');this.infoContent=$('<div class=\"content\"/>');this.infoTabLeft=$('<div class=\"tab left\"/>');this.infoTabRight=$('<div class=\"tab right\"/>');this.infoTabBottom=$('<div class=\"tab bottom\"/>');this.infoName=$('<div class=\"username\"/>');this.infoRank=$('<div class=\"rank\"/>');this.infoRankTitle=$('<div class=\"title\"/>');this.infoRankIcon=$('<img class=\"rankIcon\" src=\"'+g_url('/assets/images/ranks/0.png')+'\" srcset=\"'+g_url('/assets/images/ranks/0@2x.png')+' 2x\"/>');this.infoRankGuestIcon=$('<img class=\"rankIcon\" src=\"'+g_url('/assets/images/ranks/guest.png')+'\" srcset=\"'+g_url('/assets/images/ranks/guest@2x.png')+' 2x\"/>');this.infoRankProgress=$('<div class=\"progress\"/>');this.infoRankProgressBorder=$('<div class=\"border\"/>');this.infoRankProgressBar=$('<div class=\"bar\"/>');this.infoXP=$('<div class=\"xp\"/>');this.infoXPTitle=$('<div class=\"title\"/>');this.infoXPProgress=$('<div class=\"progress\"/>');this.infoXPProgressBorder=$('<div class=\"border\"/>');this.infoXPProgressBar=$('<div class=\"bar\"/>');this.infoTable=$('<table/>');this.infoKillsAndVictoriesTableRow=$('<tr/>');this.infoDeathsTableRow=$('<tr/>');this.infoKillsTableCell=$('<td/>');this.infoKillsIcon=$('<img class=\"statsIcon\" src=\"'+g_url('assets/images/tankInfo/kills.png')+'\" srcset=\"'+g_url('assets/images/tankInfo/kills@2x.png')+' 2x\"/>');this.infoKills=$('<div/>');this.infoVictoriesTableCell=$('<td/>');this.infoVictoriesIcon=$('<img class=\"statsIcon\" src=\"'+g_url('assets/images/tankInfo/victories.png')+'\" srcset=\"'+g_url('assets/images/tankInfo/victories@2x.png')+' 2x\"/>');this.infoVictories=$('<div/>');this.infoDeathsIcon=$('<img class=\"statsIcon\" src=\"'+d_url('ttaddons/tankInfo/deaths.png')+'\" srcset=\"'+d_url('ttaddons/tankInfo/deaths@2x.png')+' 2x\"/>');this.infoDeaths=$('<div/>');this.infoGoldAndDiamondTableRow=$('<tr/>');this.infoGoldTableCell=$('<td/>');this.infoGoldIcon=$('<img class=\"statsIcon\" src=\"'+g_url('assets/images/tankInfo/gold.png')+'\" srcset=\"'+g_url('assets/images/tankInfo/gold@2x.png')+' 2x\"/>');this.infoGold=$('<div/>');this.infoDiamondTableCell=$('<td/>');this.infoDiamondIcon=$('<img class=\"statsIcon\" src=\"'+g_url('assets/images/tankInfo/diamond.png')+'\" srcset=\"'+g_url('assets/images/tankInfo/diamond@2x.png')+' 2x\"/>');this.infoDiamondGlow=$('<img class=\"glow\" src=\"'+g_url('assets/images/tankInfo/diamondGlow.png')+'\" srcset=\"'+g_url('assets/images/tankInfo/diamondGlow@2x.png')+' 2x\"/>');this.infoDiamondFirstRay=$('<img class=\"ray first\" src=\"'+g_url('assets/images/tankInfo/diamondRays.png')+'\" srcset=\"'+g_url('assets/images/tankInfo/diamondRays@2x.png')+' 2x\"/>');this.infoDiamondSecondRay=$('<img class=\"ray second\" src=\"'+g_url('assets/images/tankInfo/diamondRays.png')+'\" srcset=\"'+g_url('assets/images/tankInfo/diamondRays@2x.png')+' 2x\"/>');this.infoDiamond=$('<div/>');this.infoActionsCentered=$('<div class=\"actions centered\"/>');this.infoAdminLookup=$('<div class=\"button\" title=\"\"/>');this.infoFavouriteStarOn=$('<div class=\"button\" title=\"\"/>');this.infoFavouriteStarOff=$('<div class=\"button\" title=\"\"/>');this.infoGameJoin=$('<div class=\"button\" title=\"\"/>');this.infoGameJoinQueue=$('<div class=\"button\" title=\"\"/>');this.infoChat=$('<div class=\"button\" title=\"\"/>');this.infoActions=$('<div class=\"actions\"/>');this.infoSignUp=Utils.createFixedWidthButton('Sign up now','medium',198);this.infoShop=$('<div class=\"button shop\" title=\"\"/>');this.infoGarage=$('<div class=\"button\" title=\"\"/>');this.infoAchievements=$('<div class=\"button\" title=\"\"/>');this.infoControl=$('<div class=\"button\" title=\"\"/>');this.infoAchievementsUnseenMarkerIcon=$('<img class=\"buttonMarker\" src=\"'+g_url('assets/images/tankInfo/unseenMarker.png')+'\" srcset=\"'+g_url('assets/images/tankInfo/unseenMarker@2x.png')+' 2x\"/>');this.infoMazeCreator=$('<div class=\"button\" title=\"\"/>');this.infoAccount=$('<div class=\"button\" title=\"\"/>');this.infoAdmin=$('<div class=\"button\" title=\"\"/>');this.infoLogOut=$('<div class=\"button\" title=\"\"/>');this.infoBackground=$('<div class=\"boxbackground\"/>');this.infoContent.append(this.infoTabLeft);this.infoContent.append(this.infoTabRight);this.infoContent.append(this.infoTabBottom);this.infoRankProgress.append(this.infoRankProgressBorder);this.infoRankProgress.append(this.infoRankProgressBar);this.infoRank.append(this.infoRankProgress);this.infoRank.append(this.infoRankGuestIcon);this.infoRank.append(this.infoRankIcon);this.infoRank.append(this.infoRankTitle);this.infoXPProgress.append(this.infoXPProgressBorder);this.infoXPProgress.append(this.infoXPProgressBar);this.infoXP.append(this.infoXPProgress);this.infoXP.append(this.infoXPTitle);this.infoKillsTableCell.append(this.infoKillsIcon);this.infoKillsTableCell.append(this.infoKills);this.infoVictoriesTableCell.append(this.infoVictoriesIcon);this.infoVictoriesTableCell.append(this.infoVictories);this.infoKillsAndVictoriesTableRow.append(this.infoKillsTableCell);this.infoKillsAndVictoriesTableRow.append(this.infoVictoriesTableCell);this.infoGoldTableCell.append(this.infoGoldIcon);this.infoGoldTableCell.append(this.infoGold);this.infoDiamondTableCell.append(this.infoDiamondGlow);this.infoDiamondTableCell.append(this.infoDiamondFirstRay);this.infoDiamondTableCell.append(this.infoDiamondSecondRay);this.infoDiamondTableCell.append(this.infoDiamondIcon);this.infoDiamondTableCell.append(this.infoDiamond);this.infoGoldAndDiamondTableRow.append(this.infoGoldTableCell);this.infoGoldAndDiamondTableRow.append(this.infoDiamondTableCell);this.infoTable.append(this.infoKillsAndVictoriesTableRow);this.infoTable.append(this.infoDeathsTableRow);this.infoTable.append(this.infoGoldAndDiamondTableRow);Utils.addImageWithClasses(this.infoAdminLookup,'standard','assets/images/tankInfo/admin.png');Utils.addImageWithClasses(this.infoAdminLookup,'active','assets/images/tankInfo/adminActive.png');Utils.addImageWithClasses(this.infoAdminLookup,'disabled','assets/images/tankInfo/adminDisabled.png');Utils.addImageWithClasses(this.infoFavouriteStarOn,'standard','assets/images/tankInfo/favouriteOn.png');Utils.addImageWithClasses(this.infoFavouriteStarOn,'active','assets/images/tankInfo/favouriteOnActive.png');Utils.addImageWithClasses(this.infoFavouriteStarOn,'disabled','assets/images/tankInfo/favouriteDisabled.png');Utils.addImageWithClasses(this.infoFavouriteStarOff,'standard','assets/images/tankInfo/favouriteOff.png');Utils.addImageWithClasses(this.infoFavouriteStarOff,'active','assets/images/tankInfo/favouriteOffActive.png');Utils.addImageWithClasses(this.infoFavouriteStarOff,'disabled','assets/images/tankInfo/favouriteDisabled.png');Utils.addImageWithClasses(this.infoGameJoin,'standard','assets/images/tankInfo/join.png');Utils.addImageWithClasses(this.infoGameJoin,'active','assets/images/tankInfo/joinActive.png');Utils.addImageWithClasses(this.infoGameJoin,'disabled','assets/images/tankInfo/joinDisabled.png');Utils.addImageWithClasses(this.infoGameJoinQueue,'standard','assets/images/tankInfo/joinQueue.png');Utils.addImageWithClasses(this.infoGameJoinQueue,'active','assets/images/tankInfo/joinQueueActive.png');Utils.addImageWithClasses(this.infoGameJoinQueue,'disabled','assets/images/tankInfo/joinDisabled.png');Utils.addImageWithClasses(this.infoChat,'standard','assets/images/tankInfo/chat.png');Utils.addImageWithClasses(this.infoChat,'active','assets/images/tankInfo/chatActive.png');Utils.addImageWithClasses(this.infoChat,'disabled','assets/images/tankInfo/chatDisabled.png');Utils.addImageWithClasses(this.infoShop,'standard','assets/images/tankInfo/shop.png');Utils.addImageWithClasses(this.infoShop,'standard flicker','assets/images/tankInfo/shopFlicker.png');Utils.addImageWithClasses(this.infoShop,'active','assets/images/tankInfo/shopActive.png');Utils.addImageWithClasses(this.infoShop,'disabled','assets/images/tankInfo/shop.png');Utils.addImageWithClasses(this.infoGarage,'standard','assets/images/tankInfo/garage.png');Utils.addImageWithClasses(this.infoGarage,'active','assets/images/tankInfo/garageActive.png');Utils.addImageWithClasses(this.infoAchievements,'standard','assets/images/tankInfo/achievements.png');Utils.addImageWithClasses(this.infoAchievements,'active','assets/images/tankInfo/achievementsActive.png');Utils.addImageWithClasses(this.infoAchievements,'disabled','assets/images/tankInfo/achievements.png');Utils.addImageWithClasses(this.infoMazeCreator,'standard','assets/images/tankInfo/mazeCreator.png');Utils.addImageWithClasses(this.infoMazeCreator,'active','assets/images/tankInfo/mazeCreatorActive.png');Utils.addImageWithClasses(this.infoMazeCreator,'disabled','assets/images/tankInfo/mazeCreator.png');Utils.addImageWithClasses(this.infoAccount,'standard','assets/images/tankInfo/account.png');Utils.addImageWithClasses(this.infoAccount,'active','assets/images/tankInfo/accountActive.png');Utils.addImageWithClasses(this.infoAdmin,'standard','assets/images/tankInfo/admin.png');Utils.addImageWithClasses(this.infoAdmin,'active','assets/images/tankInfo/adminActive.png');Utils.addImageWithClasses(this.infoLogOut,'standard','assets/images/tankInfo/logOut.png');Utils.addImageWithClasses(this.infoLogOut,'active','assets/images/tankInfo/logOutActive.png');Utils.addImageWithClasses(this.infoLogOut,'disabled','assets/images/tankInfo/logOutDisabled.png');this.infoAchievements.append(this.infoAchievementsUnseenMarkerIcon);this.infoActionsCentered.append(this.infoAdminLookup);this.infoActionsCentered.append(this.infoGameJoin);this.infoActionsCentered.append(this.infoGameJoinQueue);this.infoActionsCentered.append(this.infoChat);this.infoActions.append(this.infoSignUp);this.infoActions.append(this.infoShop);this.infoActions.append(this.infoGarage);this.infoActions.append(this.infoAchievements);this.infoActions.append(this.infoControl);this.infoActions.append(this.infoAccount);this.infoActions.append(this.infoAdmin);this.infoActions.append(this.infoLogOut);this.infoContent.append(this.infoName);this.infoContent.append(this.infoRank);this.infoContent.append(this.infoXP);this.infoContent.append(this.infoTable);this.infoContent.append(this.infoActionsCentered);this.infoContent.append(this.infoActions);this.info.append(this.infoContent);this.info.append(this.infoIcon);this.info.append(this.infoIconPlaceholder);$('body').append(this.infoBackground);$('body').append(this.info);this.infoBackground.hide();this.info.hide();this.infoIcon.hide();this.infoRank.tooltipster({position:'right',offsetX:5});this.infoXP.tooltipster({position:'right',offsetX:5});this.infoKillsTableCell.tooltipster({position:'left',offsetX:5});this.infoVictoriesTableCell.tooltipster({position:'right',offsetX:5});this.infoGoldTableCell.tooltipster({position:'left',offsetX:5});this.infoDiamondTableCell.tooltipster({position:'right',offsetX:5});this.infoAdminLookup.tooltipster({position:'left',offsetX:5});this.infoFavouriteStarOn.tooltipster({position:'left',offsetX:5});this.infoFavouriteStarOff.tooltipster({position:'left',offsetX:5});this.infoGameJoin.tooltipster({position:'top',offsetY:5});this.infoGameJoinQueue.tooltipster({position:'top',offsetY:5});this.infoChat.tooltipster({position:'right',offsetX:5});this.infoSignUp.tooltipster({position:'top',offsetY:5});this.infoShop.tooltipster({position:'left',offsetX:5});this.infoGarage.tooltipster({position:'top',offsetY:5});this.infoAchievements.tooltipster({position:'top',offsetY:5});this.infoControl.tooltipster({position:'right',offsetY:5});this.infoMazeCreator.tooltipster({position:'right',offsetX:5});this.infoAccount.tooltipster({position:'top',offsetY:5});this.infoAdmin.tooltipster({position:'top',offsetX:5});this.infoLogOut.tooltipster({position:'right',theme:'tooltipster-error',offsetX:5});var self=this;this.infoBackground.click(function(event){if(self.showing){self.hide()}});this.infoAdminLookup.on('mouseup',function(event){if(self.showing){if(!$(this).hasClass('disabled')){self._lookup()}}});this.infoFavouriteStarOn.on('mouseup',function(event){if(self.showing){if(!$(this).hasClass('disabled')){self._setFavourited(false)}}});this.infoFavouriteStarOff.on('mouseup',function(event){if(self.showing){if(!$(this).hasClass('disabled')){self._setFavourited(true)}}});this.infoGameJoin.on('mouseup',function(event){if(self.showing){if(!$(this).hasClass('disabled')){self.hide();console.log('TODO: JOIN GAME')}}});this.infoGameJoinQueue.on('mouseup',function(event){if(self.showing){if(!$(this).hasClass('disabled')){self.hide();console.log('TODO: JOIN GAME QUEUE')}}});this.infoChat.on('mouseup',function(event){if(self.showing){if(!$(this).hasClass('disabled')){self.hide();TankTrouble.ChatBox.addRecipient(self.playerId);TankTrouble.ChatBox.open()}}});this.infoSignUp.click(function(event){if(self.showing){self.hide();OverlayManager.pushOverlay(TankTrouble.SignUpOverlay,{guestPlayerIdToSignUp:self.playerId})}});this.infoShop.on('mouseup',function(event){if(self.showing){self.hide();OverlayManager.pushOverlay(TankTrouble.VirtualShopOverlay,{playerId:self.playerId})}});this.infoGarage.on('mouseup',function(event){if(self.showing){self.hide();OverlayManager.pushOverlay(TankTrouble.GarageOverlay,{playerId:self.playerId})}});this.infoAchievements.on('mouseup',function(event){if(self.showing){self.hide();OverlayManager.pushOverlay(TankTrouble.AchievementsOverlay,{playerId:self.playerId})}});this.infoControl.on('mouseup',function(event){if(self.showing){self.hide();if(Inputs.getUnavailableInputSetIds().length<Inputs.getAllInputSetIds().length){OverlayManager.pushOverlay(TankTrouble.ControlsOverlay,{playerId:self.playerId})}else{TankTrouble.ErrorBox.show('Failed to reassign input: All sets are occupied')}}});this.infoMazeCreator.on('mouseup',function(event){if(self.showing){self.hide();console.log('TODO: OPEN MAZE CREATOR')}});this.infoAccount.on('mouseup',function(event){if(self.showing){self.hide();OverlayManager.pushOverlay(TankTrouble.AccountOverlay,{playerId:self.playerId})}});this.iconCanvas.width=UIConstants.TANK_ICON_WIDTH_LARGE;this.iconCanvas.height=UIConstants.TANK_ICON_HEIGHT_LARGE;this.infoContent.css('width',UIConstants.TANK_INFO_WIDTH-1);this.infoName.svg({settings:{width:UIConstants.TANK_INFO_WIDTH-1,height:30}});this.infoNameSvg=this.infoName.svg('get');this.infoRankTitle.svg({settings:{width:UIConstants.TANK_INFO_WIDTH-1,height:30}});this.infoRankTitleSvg=this.infoRankTitle.svg('get');this.infoXPTitle.svg({settings:{width:UIConstants.TANK_INFO_WIDTH-1,height:30}});this.infoXPTitleSvg=this.infoXPTitle.svg('get');this.infoKills.svg({settings:{width:UIConstants.TANK_INFO_MAX_NUMBER_WIDTH,height:30}});this.infoKillsSvg=this.infoKills.svg('get');this.infoVictories.svg({settings:{width:UIConstants.TANK_INFO_MAX_NUMBER_WIDTH,height:30}});this.infoVictoriesSvg=this.infoVictories.svg('get');this.infoDeaths.svg({settings:{width:UIConstants.TANK_INFO_MAX_NUMBER_WIDTH,height:30}});this.infoDeathsSvg=this.infoDeaths.svg('get');this.infoGold.svg({settings:{width:UIConstants.TANK_INFO_MAX_NUMBER_WIDTH,height:30}});this.infoGoldSvg=this.infoGold.svg('get');this.infoDiamond.svg({settings:{width:UIConstants.TANK_INFO_MAX_NUMBER_WIDTH,height:30}});this.infoDiamondSvg=this.infoDiamond.svg('get');this.initialized=true};TankTrouble.TankInfoBox.show=function(x,y,playerId,preferredRadiusHorizontal,preferredRadiusVertical,preferredDirections){if(!this.initialized){this._initialize()}if(preferredDirections===undefined){preferredDirections=['top','right','left','bottom']}this.playerId=playerId;this.username=null;this.infoRank.tooltipster('content','Tank rank (0/100)');this.infoXP.tooltipster('content','Tank level (0/100)');this.infoKillsTableCell.tooltipster('content','Kills');this.infoVictoriesTableCell.tooltipster('content','Victories');this.infoGoldTableCell.tooltipster('content','Gold');this.infoDiamondTableCell.tooltipster('content','Dimitrium');this.infoFavouriteStarOff.tooltipster('content','Loading favourite information');this.infoGameJoin.tooltipster('content','Loading battle information');this.infoChat.tooltipster('content','Loading chat information');this.infoShop.tooltipster('content','Dimitri\\'s Emporium');this.infoGarage.tooltipster('content','Customize your tank');this.infoAchievements.tooltipster('content','Achievements');this.infoControl.tooltipster('content','Switch controls');this.infoMazeCreator.tooltipster('content','Maze creator');this.infoAccount.tooltipster('content','Account info');this.infoAdmin.tooltipster('content','Admin');this.infoSignUp.tooltipster('content','Sign up to store your progress');this.infoLogOut.tooltipster('content','WARNING: If you leave you will lose all progress with this guest');this.infoLogOut.tooltipster('option','theme','tooltipster-error');this.infoControl.empty();this.info.show();this.infoBackground.fadeIn(200);this.showing=true;this._hideAllButtonsAndInfo();this._showRelevantButtonsAndInfo();Utils.placeBoxBestLocation(this.info,x,y,preferredDirections,preferredRadiusHorizontal,preferredRadiusVertical,30,35,[150,0,0,0]);this.info.css({scale:0,opacity:0});this.info.transition({scale:1,queue:false},300,'easeOutBack');this.info.animate({opacity:1},{duration:200,queue:false});this.infoIconPlaceholder.show();this.infoIcon.hide();this.infoAchievementsUnseenMarkerIcon.hide();this.infoNameSvg.clear();this.infoRankTitleSvg.clear();this.infoXPTitleSvg.clear();this.infoKillsSvg.clear();this.infoVictoriesSvg.clear();this.infoDeathsSvg.clear();var self=this;Backend.getInstance().getPlayerDetails(function(result){UITankIcon.loadPlayerTankIcon(self.iconCanvas,UIConstants.TANK_ICON_SIZES.LARGE,self.playerId,function(self){self.infoIconPlaceholder.hide();self.iconCanvas.getContext('2d').clearRect(0,0,self.iconCanvas.width,self.iconCanvas.height);self.infoIcon.show()},self);self.username='Scrapped';var victories='N/A';var kills='N/A';var deaths='N/A';var guest=false;var rank=0;var rankLevel=0;var rankToRankDown=0;var rankToRankUp=UIConstants.RANK_POINTS_PER_RANK_LEVEL;var rankTitle='N/A';var rankImage='0';var xp=0;var level=0;var xpToLevelDown=UIConstants.XP_LEVELS[0];var xpToLevelUp=UIConstants.XP_LEVELS[1];var levelTitle='N/A';if(typeof result=='object'){self.username=Utils.maskUnapprovedUsername(result);victories=result.getVictories();kills=result.getKills();deaths=result.getDeaths();rank=result.getRank();rankLevel=UIUtils.getRankLevelFromRank(rank);rankToRankDown=rankLevel>0?UIConstants.RANK_LEVELS[rankLevel-1]:0;rankToRankUp=UIConstants.RANK_LEVELS[rankLevel];rankTitle=UIConstants.RANK_TITLES[rankLevel];rankImage=rankLevel+'';xp=result.getXP();level=UIUtils.getLevelFromXp(xp);xpToLevelDown=level>0?UIConstants.XP_LEVELS[level-1]:0;xpToLevelUp=UIConstants.XP_LEVELS[level];levelTitle='Level '+(level+1);if(rankToRankUp===undefined){self.infoRank.tooltipster('content','Rank ('+rank+')')}else{self.infoRank.tooltipster('content','Rank ('+rank+' / '+rankToRankUp+')')}if(xpToLevelUp===undefined){self.infoXP.tooltipster('content','XP ('+xp+' / Maxed out)')}else{self.infoXP.tooltipster('content','XP ('+xp+' / '+xpToLevelUp+')')}self.infoAdminLookup.tooltipster('content','Look up '+self.username);self.infoFavouriteStarOn.tooltipster('content','Remove '+self.username+' from your favourites');self.infoFavouriteStarOff.tooltipster('content','Add '+self.username+' to your favourites');self.infoGameJoin.tooltipster('content','Battle '+self.username);self.infoGameJoinQueue.tooltipster('content','Queue up to battle '+self.username);self.infoChat.tooltipster('content','Send message to '+self.username);if(result.getGuest()){guest=true}self.infoAdminLookup.removeClass('disabled');self._updateLogInAndOutStatus();self._updateFavouriteStatus();self._updateJoinGameStatus();self._updateChatStatus()}else{self.infoRank.tooltipster('content','Could not retrieve this tank\"s rank');self.infoXP.tooltipster('content','Could not retrieve this tank\"s XP');self.infoAdminLookup.tooltipster('content','You cannot currently look up this tank');self.infoFavouriteStarOn.tooltipster('content','You cannot currently remove this tank from your favourites');self.infoFavouriteStarOff.tooltipster('content','You cannot currently add this tank to your favourites');self.infoGameJoin.tooltipster('content','You cannot currently battle this tank');self.infoGameJoinQueue.tooltipster('content','You cannot currently battle this tank');self.infoChat.tooltipster('content','You cannot currently message this tank')}var infoNameTextOutline=self.infoNameSvg.text(self.infoName.width()/2,24,self.username,{textAnchor:'middle',fontFamily:'TankTrouble',fontWeight:'normal',fontSize:24,fill:'white',stroke:'black',strokeLineJoin:'round',strokeWidth:4});var infoNameText=self.infoNameSvg.text(self.infoName.width()/2,24,self.username,{textAnchor:'middle',fontFamily:'TankTrouble',fontWeight:'normal',fontSize:24,fill:'white',stroke:'black',strokeLineJoin:'round',strokeWidth:0});var infoNameLength=Utils.measureSVGText(self.username,{fontFamily:'TankTrouble',fontWeight:'normal',fontSize:24});var scaleAndTranslate=Utils.getSVGScaleAndTranslateToFit(self.infoName.width(),infoNameLength+4,29);self.infoNameSvg.configure(infoNameTextOutline,{transform:scaleAndTranslate});self.infoNameSvg.configure(infoNameText,{transform:scaleAndTranslate});var rankWidth=self.infoRankTitleSvg.text(18+2,22,rankTitle,{textAnchor:'left',fontFamily:'Arial',fontWeight:'bold',fontSize:14,fill:'none',stroke:'black',strokeLineJoin:'round',strokeWidth:3}).getComputedTextLength();self.infoRankTitleSvg.text(18+2,22,rankTitle,{textAnchor:'left',fontFamily:'Arial',fontWeight:'bold',fontSize:14,fill:'white'});rankWidth+=4;if(guest){self.infoRankGuestIcon.show();var guestWidth=self.infoRankTitleSvg.text(18+rankWidth+18+2,22,'Guest',{textAnchor:'left',fontFamily:'Arial',fontWeight:'bold',fontSize:14,fill:'none',stroke:'black',strokeLineJoin:'round',strokeWidth:3}).getComputedTextLength();self.infoRankTitleSvg.text(18+rankWidth+18+2,22,'Guest',{textAnchor:'left',fontFamily:'Arial',fontWeight:'bold',fontSize:14,fill:'white'});guestWidth+=4;self.infoRankTitleSvg.configure({width:18+rankWidth+18+guestWidth})}else{self.infoRankGuestIcon.hide();self.infoRankTitleSvg.configure({width:18+rankWidth})}self.infoRankTitle.css('left',self.infoRank.width()/2-self.infoRankTitleSvg.width()/2);self.infoRankIcon.attr('src',g_url('/assets/images/ranks/'+rankImage+'.png'));self.infoRankIcon.attr('srcset',g_url('/assets/images/ranks/'+rankImage+'@2x.png')+' 2x');self.infoRankIcon.css('left',self.infoRank.width()/2-self.infoRankTitleSvg.width()/2-2);self.infoRankGuestIcon.css('left',self.infoRank.width()/2-self.infoRankTitleSvg.width()/2+18+rankWidth);if(rankToRankUp===undefined){self.infoRankProgressBar.css('width','100%')}else{self.infoRankProgressBar.css('width',(rank-rankToRankDown)/(rankToRankUp-rankToRankDown)*100+'%')}var assignedInput=Inputs.getAssignedInputSetId(self.playerId);if(assignedInput){Utils.addAddonsImageWithClasses(self.infoControl,'standard','ttaddons/inputs/'+assignedInput+'Control.png');Utils.addAddonsImageWithClasses(self.infoControl,'active','ttaddons/inputs/'+assignedInput+'Control.png');Utils.addAddonsImageWithClasses(self.infoControl,'disabled','ttaddons/inputs/'+assignedInput+'Control.png')}self.infoXPTitleSvg.text(self.infoXPTitle.width()/2,22,levelTitle,{textAnchor:'middle',fontFamily:'Arial',fontWeight:'bold',fontSize:14,fill:'none',stroke:'black',strokeLineJoin:'round',strokeWidth:3});self.infoXPTitleSvg.text(self.infoXPTitle.width()/2,22,levelTitle,{textAnchor:'middle',fontFamily:'Arial',fontWeight:'bold',fontSize:14,fill:'white'});if(xpToLevelUp===undefined){self.infoXPProgressBar.css('width','100%')}else{self.infoXPProgressBar.css('width',(xp-xpToLevelDown)/(xpToLevelUp-xpToLevelDown)*100+'%')}var killsTextOutline=self.infoKillsSvg.text(1,22,kills.toString(),{textAnchor:'start',fontFamily:'Arial Black',fontSize:14,fill:'none',stroke:'black',strokeLineJoin:'round',strokeWidth:3,letterSpacing:1});var killsText=self.infoKillsSvg.text(1,22,kills.toString(),{textAnchor:'start',fontFamily:'Arial Black',fontSize:14,fill:'white',letterSpacing:1});var killsLength=Utils.measureSVGText(kills.toString(),{fontFamily:'Arial Black',fontSize:14});scaleAndTranslate=Utils.getSVGScaleAndTranslateToFit(UIConstants.TANK_INFO_MAX_NUMBER_WIDTH,killsLength+7,34,'left');self.infoKillsSvg.configure(killsTextOutline,{transform:scaleAndTranslate});self.infoKillsSvg.configure(killsText,{transform:scaleAndTranslate});var victoriesTextOutline=self.infoVictoriesSvg.text(UIConstants.TANK_INFO_MAX_NUMBER_WIDTH-1,22,victories.toString(),{textAnchor:'end',fontFamily:'Arial Black',fontSize:14,fill:'none',stroke:'black',strokeLineJoin:'round',strokeWidth:3,letterSpacing:1});var victoriesText=self.infoVictoriesSvg.text(UIConstants.TANK_INFO_MAX_NUMBER_WIDTH-1,22,victories.toString(),{textAnchor:'end',fontFamily:'Arial Black',fontSize:14,fill:'white',letterSpacing:1});var victoriesLength=Utils.measureSVGText(victories.toString(),{fontFamily:'Arial Black',fontSize:14});scaleAndTranslate=Utils.getSVGScaleAndTranslateToFit(UIConstants.TANK_INFO_MAX_NUMBER_WIDTH,victoriesLength+7,34,'right');self.infoVictoriesSvg.configure(victoriesTextOutline,{transform:scaleAndTranslate});self.infoVictoriesSvg.configure(victoriesText,{transform:scaleAndTranslate});var deathsTextOutline=self.infoDeathsSvg.text(UIConstants.TANK_INFO_MAX_NUMBER_WIDTH-1,22,deaths.toString(),{textAnchor:'end',fontFamily:'Arial Black',fontSize:14,fill:'none',stroke:'black',strokeLineJoin:'round',strokeWidth:3,letterSpacing:1});var deathsText=self.infoDeathsSvg.text(UIConstants.TANK_INFO_MAX_NUMBER_WIDTH-1,22,deaths.toString(),{textAnchor:'end',fontFamily:'Arial Black',fontSize:14,fill:'white',letterSpacing:1});var deathsLength=Utils.measureSVGText(deaths.toString(),{fontFamily:'Arial Black',fontSize:14});scaleAndTranslate=Utils.getSVGScaleAndTranslateToFit(UIConstants.TANK_INFO_MAX_NUMBER_WIDTH,deathsLength+7,34,'right');self.infoDeathsSvg.configure(deathsTextOutline,{transform:scaleAndTranslate});self.infoDeathsSvg.configure(deathsText,{transform:scaleAndTranslate})},function(result){},function(result){},this.playerId,Caches.getPlayerDetailsCache());Backend.getInstance().getUnseenAchievements(function(result){if(Array.isArray(result)){if(result.length>0){self.infoAchievementsUnseenMarkerIcon.stop(true).show().css({scale:0,rotate:'0deg'}).delay(500).transition({scale:1.5,rotate:'0deg'},200).transition({scale:1,rotate:'0deg'},250,function(){self._loopButtonMarkerAnimation()});self.infoAchievements.tooltipster('content','You have unlocked '+result.length+' new achievement'+(result.length>1?'s':''))}}},function(result){},function(result){},this.playerId,Caches.getUnseenAchievementsCache());GameManager.disableGameInput();ClientManager.getClient().addEventListener(this._clientEventHandler,this);this._notifyEventListeners(TankTrouble.TankInfoBox.EVENTS.OPENED,this.playerId)};TankTrouble.TankInfoBox._hideAllButtonsAndInfo=function(){this.infoGoldAndDiamondTableRow.hide();this.infoAdminLookup.hide();this.infoFavouriteStarOn.hide();this.infoFavouriteStarOff.hide();this.infoGameJoin.hide();this.infoGameJoinQueue.hide();this.infoChat.hide();this.infoSignUp.hide();this.infoShop.hide();this.infoGarage.hide();this.infoAchievements.hide();this.infoControl.hide();this.infoMazeCreator.hide();this.infoAccount.hide();this.infoAdmin.hide();this.infoLogOut.hide()};TankTrouble.TankInfoBox._showRelevantButtonsAndInfo=function(){var isAuthenticatedUser=Users.isAuthenticatedUser(this.playerId);var isGuestUser=Users.isGuestUser(this.playerId);var self=this;if(!isAuthenticatedUser&&!isGuestUser){if(Users.getHighestGmLevel()>=UIConstants.ADMIN_LEVEL_PLAYER_LOOKUP){this.infoAdminLookup.show();this.infoAdminLookup.addClass('disabled')}this.infoFavouriteStarOff.show();this.infoFavouriteStarOff.addClass('disabled');this.infoGameJoin.show();this.infoGameJoin.addClass('disabled');this.infoChat.show();this.infoChat.addClass('disabled');this.info.removeClass('localPlayer')}else{this.infoGoldAndDiamondTableRow.show();this.infoDiamondSvg.clear();this.infoGoldSvg.clear();this.info.addClass('localPlayer');if(isGuestUser){this.infoSignUp.show();this.infoLogOut.off('mouseup').on('mouseup',function(event){if(self.showing){if(!$(this).hasClass('disabled')){self.hide();Backend.getInstance().deleteGuest(function(result){if(typeof result=='object'){Users.removeGuestUser(result.playerId)}else{TankTrouble.ErrorBox.show(result)}},function(result){},function(result){},self.playerId,Caches.getCurrencyCache())}}}).show()}else{Backend.getInstance().getPlayerDetails(function(result){if(typeof result=='object'){if(result.getGmLevel()>=UIConstants.ADMIN_LEVEL_DASHBOARD){self.infoAdmin.off('mouseup').on('mouseup',function(event){if(self.showing){self.hide();OverlayManager.pushOverlay(TankTrouble.AdminDashboardOverlay,{adminId:self.playerId})}}).show()}else if(result.getGmLevel()===UIConstants.ADMIN_LEVEL_ACCEPT_GUIDELINES){self.infoAdmin.off('mouseup').on('mouseup',function(event){if(self.showing){self.hide();OverlayManager.pushOverlay(TankTrouble.AdminAcceptGuidelinesOverlay,{adminId:self.playerId,page:'intro'})}}).show()}}},function(result){},function(result){},this.playerId,Caches.getPlayerDetailsCache());this.infoAccount.show();this.infoLogOut.off('mouseup').on('mouseup',function(event){if(self.showing){if(!$(this).hasClass('disabled')){self.hide();Backend.getInstance().deauthenticate(function(result){if(typeof result=='object'){Users.removeAuthenticatedUser(result.playerId)}else{TankTrouble.ErrorBox.show(result)}},function(result){},function(result){},self.playerId,Caches.getEmailCache(),Caches.getCurrencyCache())}}}).show()}this._updateLogInAndOutStatus();Backend.getInstance().getCurrency(function(result){self._spawnDiamondSparkle(self.infoDiamondTableCell);self._spawnGoldSparkle(self.infoGoldTableCell);var diamonds='N/A';if(typeof result=='object'){diamonds=result.getDiamonds()}var diamondsTextOutline=self.infoDiamondSvg.text(UIConstants.TANK_INFO_MAX_NUMBER_WIDTH-1,22,diamonds.toString(),{textAnchor:'end',fontFamily:'Arial Black',fontSize:14,fill:'none',stroke:'black',strokeLineJoin:'round',strokeWidth:3,letterSpacing:1});var diamondsText=self.infoDiamondSvg.text(UIConstants.TANK_INFO_MAX_NUMBER_WIDTH-1,22,diamonds.toString(),{textAnchor:'end',fontFamily:'Arial Black',fontSize:14,fill:'white',letterSpacing:1});var diamondsLength=Utils.measureSVGText(diamonds.toString(),{fontFamily:'Arial Black',fontSize:14});var scaleAndTranslate=Utils.getSVGScaleAndTranslateToFit(UIConstants.TANK_INFO_MAX_NUMBER_WIDTH,diamondsLength+7,34,'right');self.infoDiamondSvg.configure(diamondsTextOutline,{transform:scaleAndTranslate});self.infoDiamondSvg.configure(diamondsText,{transform:scaleAndTranslate});var gold='N/A';if(typeof result=='object'){gold=result.getGold()}var goldTextOutline=self.infoGoldSvg.text(1,22,gold.toString(),{textAnchor:'start',fontFamily:'Arial Black',fontSize:14,fill:'none',stroke:'black',strokeLineJoin:'round',strokeWidth:3,letterSpacing:1});var goldText=self.infoGoldSvg.text(1,22,gold.toString(),{textAnchor:'start',fontFamily:'Arial Black',fontSize:14,fill:'white',letterSpacing:1});var goldLength=Utils.measureSVGText(gold.toString(),{fontFamily:'Arial Black',fontSize:14});scaleAndTranslate=Utils.getSVGScaleAndTranslateToFit(UIConstants.TANK_INFO_MAX_NUMBER_WIDTH,goldLength+7,34,'left');self.infoGoldSvg.configure(goldTextOutline,{transform:scaleAndTranslate});self.infoGoldSvg.configure(goldText,{transform:scaleAndTranslate})},function(result){},function(result){},this.playerId,Caches.getCurrencyCache());this.infoShop.show();this._loopShopButtonFlickerAnimation();if(Content.getActiveTab()!=='garage'){this.infoGarage.show()}this.infoAchievements.show();this.infoControl.show();this.infoMazeCreator.show()}};"
                    }, 

                    {
                        id: "garageLoadingImprovements",
                        innerHTML: "Garage.UILoadState.method('create',function(){this.log=Log.create('UILoadState');this.waitingIconGroup=this.game.add.existing(new UIWaitingIconGroup(this.game));this.waitingIconGroup.spawn(this.game.width/2,this.game.height/3,true,'Loading accessories');this.load.onFileError.add(this._onFileError,this);this.playerIdToGarageContent={};var self=this;this.load.onLoadComplete.addOnce(function(){var welderSpotsBitmapData=this.game.make.bitmapData(UIConstants.TANK_ICON_WIDTH_LARGE,UIConstants.TANK_ICON_HEIGHT_LARGE);var welderSpotsCellCountX=Math.floor(welderSpotsBitmapData.width/UIConstants.WELDER_SAMPLE_CELL_SIZE);var welderSpotsCellCountY=Math.floor(welderSpotsBitmapData.height/UIConstants.WELDER_SAMPLE_CELL_SIZE);for(var playerId in this.playerIdToGarageContent){var content=this.playerIdToGarageContent[playerId];for(var i=0;i<content.boxes.length;++i){var box=content.boxes[i];for(var j=0;j<box.accessories.length;++j){var accessory=box.accessories[j];if(!this.accessoryToWelderPoints[accessory.type+accessory.value]){this.accessoryToWelderPoints[accessory.type+accessory.value]=[];var image=this.game.cache.getImage(accessory.type+accessory.value+'preprocess');welderSpotsBitmapData.clear();welderSpotsBitmapData.draw(image,0,0);welderSpotsBitmapData.update();for(var x=0;x<welderSpotsCellCountX;++x){for(var y=0;y<welderSpotsCellCountY;++y){var sampleX=Math.floor((x+.5)*UIConstants.WELDER_SAMPLE_CELL_SIZE+(Math.random()*2-1)*UIConstants.WELDER_SAMPLE_JITTER_SIZE);var sampleY=Math.floor((y+.5)*UIConstants.WELDER_SAMPLE_CELL_SIZE+(Math.random()*2-1)*UIConstants.WELDER_SAMPLE_JITTER_SIZE);var sample=welderSpotsBitmapData.getPixel32(sampleX,sampleY);if(sample>>24&255>0){var point={x:sampleX/UIConstants.TANK_ICON_WIDTH_LARGE-.5,y:sampleY/UIConstants.TANK_ICON_HEIGHT_LARGE-.5};this.accessoryToWelderPoints[accessory.type+accessory.value].push(point)}}}}}}}welderSpotsBitmapData.destroy();this.state.start('Main',true,false,this.playerIdToGarageContent,this.accessoryToWelderPoints)},this);var playerIds=[];if(this.playerId!==null){playerIds.push(this.playerId)}else{playerIds=Users.getAllPlayerIds()}var numGarageContentResponses=0;var numExpectedGarageContentResponses=playerIds.length;for(var i=0;i<playerIds.length;++i){Backend.getInstance().getGarageContent(function(result){self.playerIdToGarageContent[result.playerId]=result;for(var j=0;j<result.boxes.length;++j){var box=result.boxes[j];if(!self.itemAlreadyQueuedForLoad['box'+box.id]){self.itemAlreadyQueuedForLoad['box'+box.id]=true;if(self.game.device.pixelRatio>1){self.load.spritesheet('box'+box.id,g_url('assets/images/boxes/box'+box.id+'-140@2x.png'),280,280)}else{self.load.spritesheet('box'+box.id,g_url('assets/images/boxes/box'+box.id+'-140.png'),140,140)}}if(box.id=='5'){for(var k=0;k<box.accessories.length;++k){var accessory=box.accessories[k];if(!self.itemAlreadyQueuedForLoad[accessory.type+accessory.value]){self.itemAlreadyQueuedForLoad[accessory.type+accessory.value]=true;if(self.game.device.pixelRatio>1){self.load.image(accessory.type+accessory.value,d_url('images/backdoor/'+accessory.type+accessory.value+'Icon-60@2x.png'))}else{self.load.image(accessory.type+accessory.value,d_url('images/backdoor/'+accessory.type+accessory.value+'Icon-60.png'))}if(self.game.device.pixelRatio>1){self.load.image(accessory.type+accessory.value+'preprocess',d_url('images/backdoor/'+accessory.type+accessory.value+'-320@2x.png'))}else{self.load.image(accessory.type+accessory.value+'preprocess',d_url('images/backdoor/'+accessory.type+accessory.value+'-320.png'))}}}}else{for(var k=0;k<box.accessories.length;++k){var accessory=box.accessories[k];if(!self.itemAlreadyQueuedForLoad[accessory.type+accessory.value]){self.itemAlreadyQueuedForLoad[accessory.type+accessory.value]=true;if(self.game.device.pixelRatio>1){self.load.image(accessory.type+accessory.value,g_url('assets/images/accessories/'+accessory.type+accessory.value+'Icon-60@2x.png'))}else{self.load.image(accessory.type+accessory.value,g_url('assets/images/accessories/'+accessory.type+accessory.value+'Icon-60.png'))}if(self.game.device.pixelRatio>1){self.load.image(accessory.type+accessory.value+'preprocess',g_url('assets/images/accessories/'+accessory.type+accessory.value+'-320@2x.png'))}else{self.load.image(accessory.type+accessory.value+'preprocess',g_url('assets/images/accessories/'+accessory.type+accessory.value+'-320.png'))}}}}for(var k=0;k<box.sprayCans.length;++k){var sprayCan=box.sprayCans[k];if(sprayCan.colour.type=='image'){var colourValue=sprayCan.colour.imageValue;if(!self.itemAlreadyQueuedForLoad['colour'+colourValue]){self.itemAlreadyQueuedForLoad['colour'+colourValue]=true;if(self.game.device.pixelRatio>1){self.load.image('colour'+colourValue,g_url('assets/images/colours/colour'+colourValue+'Icon-26@2x.png'))}else{self.load.image('colour'+colourValue,g_url('assets/images/colours/colour'+colourValue+'Icon-26.png'))}}}}}},function(result){},function(result){++numGarageContentResponses;if(numGarageContentResponses==numExpectedGarageContentResponses){self.load.start()}},playerIds[i],Caches.getGarageContentCache())}Users.addEventListener(this._authenticationEventHandler,this);this.scale.onSizeChange.add(this._onSizeChangeHandler,this)});Garage.UIBootState.method('preload',function(){this.load.crossOrigin='anonymous';if(this.game.device.pixelRatio>1){this.load.image('preloadbar',d_url('images/lobby/waiting@2x.png'));this.load.image('waitingicon',d_url('images/lobby/waiting@2x.png'))}else{this.load.image('preloadbar',d_url('images/lobby/waiting.png'));this.load.image('waitingicon',d_url('images/lobby/waiting.png'))}});"
                    }, 

                    {
                        id: "lobbyLoadingImprovements",
                        innerHTML: "PlayerPanel.UIPreloadState.method('preload',function(){this.preloadBackground=this.add.sprite(this.game.world.centerX-UIConstants.WAITING_ICON_WIDTH*.3/2,this.game.height/2,'preloadbar');this.preloadBackground.anchor.setTo(0,.5);this.preloadBackground.alpha=.3;this.preloadBackground.scale.setTo(.3*UIConstants.ASSET_SCALE);this.preloadBar=this.add.sprite(this.game.world.centerX-UIConstants.WAITING_ICON_WIDTH*.3/2,this.game.height/2,'preloadbar');this.load.setPreloadSprite(this.preloadBar);this.preloadBar.anchor.setTo(0,.5);this.preloadBar.scale.setTo(.3*UIConstants.ASSET_SCALE);if(this.game.device.pixelRatio>1){this.load.spine('laika',g_url('assets/images/laika/laika.json'),'@2x');this.load.spine('dimitri',g_url('assets/images/dimitri/dimitri.json'),'@2x');this.load.atlas('playerpanel',g_url('assets/images/playerPanel/playerPanel@2x.png'),g_url('assets/images/playerPanel/playerPanel@2x.json'));this.load.physics('playerpanel-physics',g_url('assets/images/playerPanel/playerPanel-physics@2x.json'));this.load.atlas('ranks',g_url('assets/images/ranks/ranks@2x.png'),g_url('assets/images/ranks/ranks@2x.json'));this.load.image('favourite',g_url('assets/images/lobby/favourite@2x.png'));this.load.image('tankiconplaceholder-medium',d_url('images/tankIcon/placeholder-200@2x.png'));this.load.image('addtank',d_url('images/lobby/addTank@2x.png'))}else{this.load.spine('laika',g_url('assets/images/laika/laika.json'));this.load.spine('dimitri',g_url('assets/images/dimitri/dimitri.json'));this.load.atlas('playerpanel',g_url('assets/images/playerPanel/playerPanel.png'),g_url('assets/images/playerPanel/playerPanel.json'));this.load.physics('playerpanel-physics',g_url('assets/images/playerPanel/playerPanel-physics.json'));this.load.atlas('ranks',g_url('assets/images/ranks/ranks.png'),g_url('assets/images/ranks/ranks.json'));this.load.image('favourite',g_url('assets/images/lobby/favourite.png'));this.load.image('tankiconplaceholder-medium',d_url('images/tankIcon/placeholder-200.png'));this.load.image('addtank',d_url('images/lobby/addTank.png'))}});"
                    }, 

                    {
                        id: "gameLoadingImprovements",
                        innerHTML: "UIConstants.TANK_NAME_DISPLAY_TIME=1.2;Game.UIBootState.method('create',function(){this.log=Log.create('UIBootState');this.input.touch.preventDefault=false;this.scale.compatibility.scrollTo=false;this.game.canvas.oncontextmenu=function(e){e.preventDefault()};this.game.stage.disableVisibilityChange=true;this.input.keyboard.addKeyCapture([Phaser.Keyboard.LEFT,Phaser.Keyboard.RIGHT,Phaser.Keyboard.UP,Phaser.Keyboard.DOWN,Phaser.Keyboard.SPACEBAR]);if(OverlayManager.isOverlayShowing()){this.input.enabled=false}this.world.bounds=new Phaser.Rectangle(0,0,this.game.width,this.game.height);this.camera.setBoundsToWorld();this.stage.backgroundColor='#fff';var time=this.game.time;time._desiredFps=144,time.physicsElapsed=1/144,time.physicsElapsedMS=1e3*time.physicsElapsed,time.desiredFpsMult=1/144;if(this.game.device.pixelRatio>1){this.scale.scaleMode=Phaser.ScaleManager.USER_SCALE;this.scale.setUserScale(1/this.game.device.pixelRatio,1/this.game.device.pixelRatio,0,0);this.scale.setGameSize(this.game.width*this.game.device.pixelRatio,this.game.height*this.game.device.pixelRatio);this.scale.setResizeCallback(function(scale,parentBounds){if(Math.abs(parentBounds.width*this.game.device.pixelRatio-this.game.width)>=.01||Math.abs(parentBounds.height*this.game.device.pixelRatio-this.game.height)>=.01){this.log.debug('RESIZE CANVAS!');this.scale.setGameSize(parentBounds.width*this.game.device.pixelRatio,parentBounds.height*this.game.device.pixelRatio)}},this)}else{this.scale.scaleMode=Phaser.ScaleManager.RESIZE}this.state.start('Preload')});Game.UIBootState.method('preload',function(){this.load.crossOrigin='anonymous';if(this.game.device.pixelRatio>1){this.load.image('preloadbar',d_url('images/lobby/waiting@2x.png'));this.load.image('waitingicon',d_url('images/lobby/waiting@2x.png'))}else{this.load.image('preloadbar',d_url('images/lobby/waiting.png'));this.load.image('waitingicon',d_url('images/lobby/waiting.png'))}});"
                    }, 

                    {
                        id: "moreGameIcons",
                        innerHTML: "UIConstants.GAME_ICON_POOL_SIZE=6;UIConstants.GAME_ICON_COUNT=6;UIConstants.GAME_ICON_WIDTH=UIConstants.GAME_ICON_WIDTH/1.9;UIConstants.GAME_ICON_HEIGHT=UIConstants.GAME_ICON_HEIGHT/1.9;UIGameIconImage.prototype.spawn=function(x,y,gameState,favouriteActiveQueuedCounts){this.reset(x,y);this.gameId=gameState.getId();this.mode=gameState.getMode();this.ranked=gameState.getRanked();this.playerStates=gameState.getPlayerStates();this.favouriteActiveQueuedCounts=favouriteActiveQueuedCounts;this._updateUI();var delay=50+Math.random()*200;if(this.removeTween){this.removeTween.stop()}this.game.add.tween(this.scale).to({x:UIConstants.ASSET_SCALE/1.9,y:UIConstants.ASSET_SCALE/1.9},UIConstants.ELEMENT_POP_IN_TIME,Phaser.Easing.Back.Out,true,delay)};"
                    },


                    {
                        id: "classicMouseControls",
                        innerHTML: "Tank.method('_computeRotationSpeed',function(){this.rotationSpeed=0;var speedModifier=this.roundModel.getModifier(this.playerId,Constants.MODIFIER_TYPES.SPEED);var classicMouseEnabled=Inputs.isClassicMouseEnabled(this.playerId);if(this.left){this.rotationSpeed+=-Constants.TANK.ROTATION_SPEED*(classicMouseEnabled?Inputs.turnMultiplier:speedModifier)}if(this.right){this.rotationSpeed+=Constants.TANK.ROTATION_SPEED*(classicMouseEnabled?Inputs.turnMultiplier:speedModifier)}});Inputs.classMethod('isClassicMouseEnabled',function(playerId){return(playerId==undefined?true:Inputs.getAssignedInputSetId(playerId)==Inputs.INPUT_TYPES.MOUSE)&&localStorage.getItem('classicMouse')=='true'});Inputs.turnMultiplier=1;MouseInputManager.method('update',function(){this._super();var game=GameManager.getGame();if(game){var forwardState=false;var backState=false;var leftState=false;var rightState=false;var fireState=false;var gameBounds=game.scale.bounds;var gameScale=game.scale.scaleFactor;var classicMouseEnabled=Inputs.isClassicMouseEnabled(this.playerId);var deadAngle=classicMouseEnabled?.03:UIConstants.MOUSE_INPUT.ROTATION_DEAD_ANGLE;this.mouseX=(MouseInputManager.mousePageX-gameBounds.x)*gameScale.x;this.mouseY=(MouseInputManager.mousePageY-gameBounds.y)*gameScale.y;if(game.input.enabled&&MouseInputManager.mouseActivated){if(game.state.getCurrentState().getTankSprite){var tankSprite=game.state.getCurrentState().getTankSprite(this.playerId);if(tankSprite){var relativeToTank=tankSprite.toLocal(new Phaser.Point(this.mouseX,this.mouseY));var magnitude=relativeToTank.getMagnitude();var angle=Phaser.Math.angleBetween(0,0,relativeToTank.x,relativeToTank.y);var canReverse=magnitude<(classicMouseEnabled?10:UIConstants.MOUSE_INPUT.MAX_REVERSE_DISTANCE)/UIConstants.GAME_ASSET_SCALE;var goInReverse=false;var turnInt=Math.abs((angle/Math.PI+.5)*4).toPrecision(3)+2;turnInt>.25?Inputs.turnMultiplier=turnInt*3:Inputs.turnMultiplier=1;Inputs.turnMultiplier>4?Inputs.turnMultiplier=4:null;if(angle>Math.PI*.5+deadAngle||angle<-Math.PI*.5-deadAngle*2){if(angle>0&&canReverse){rightState=true;goInReverse=true}else{leftState=true}}else if(angle>-Math.PI*.5+deadAngle&&angle<Math.PI*.5-deadAngle*2){if(angle>0&&canReverse){leftState=true;goInReverse=true}else{rightState=true}}else if(angle>0){if(canReverse){goInReverse=true}else{if(angle>Math.PI*.5){leftState=true}else{rightState=true}}}if(magnitude>(classicMouseEnabled?180:UIConstants.MOUSE_INPUT.POSITION_DEAD_DISTANCE)/UIConstants.GAME_ASSET_SCALE){if(canReverse){forwardState=!goInReverse;backState=goInReverse}else if(angle>-Math.PI*.5-UIConstants.MOUSE_INPUT.POSITION_DEAD_ANGLE&&angle<-Math.PI*.5+UIConstants.MOUSE_INPUT.POSITION_DEAD_ANGLE){forwardState=true}}}}fireState=MouseInputManager.mouseDown||game.input.mousePointer.leftButton.isDown}var stateChanged=Inputs.turnMultiplier!==1&&classicMouseEnabled;if(!stateChanged){stateChanged|=this.storedStates['forward']!==forwardState;stateChanged|=this.storedStates['back']!==backState;stateChanged|=this.storedStates['left']!==leftState;stateChanged|=this.storedStates['right']!==rightState;stateChanged|=this.storedStates['fire']!==fireState}var gameController=GameManager.getGameController();if(stateChanged&&gameController){var inputState=InputState.withState(this.playerId,forwardState,backState,leftState,rightState,fireState);gameController.setInputState(inputState)}this.storedStates['forward']=forwardState;this.storedStates['back']=backState;this.storedStates['left']=leftState;this.storedStates['right']=rightState;this.storedStates['fire']=fireState}});QualityManager.classMethod('update',function(){var time=Date.now();if(QualityManager.fpsTime>0){var currentFps=1e3/(time-QualityManager.fpsTime);QualityManager.avgFps*=1-UIConstants.SETTINGS_QUALITY_FPS_AVG_WEIGHT;QualityManager.avgFps+=currentFps*UIConstants.SETTINGS_QUALITY_FPS_AVG_WEIGHT;QualityManager.numFpsSamples++}QualityManager.fpsTime=time;if(QualityManager.quality===QualityManager.QUALITY_SETTINGS.AUTO){if(QualityManager.numFpsSamples>UIConstants.SETTINGS_QUALITY_FPS_MIN_SAMPLES){if(QualityManager.numFpsSamples%UIConstants.SETTINGS_QUALITY_FPS_SAMPLE_UPDATE_INTERVAL===0){QualityManager._notifyEventListeners(QualityManager.EVENTS.FPS_UPDATED,QualityManager.avgFps)}if(QualityManager.avgFps<UIConstants.SETTINGS_QUALITY_FPS_CHANGE_TO_LOW){QualityManager.setQuality(QualityManager.QUALITY_SETTINGS.LOW)}}}});Inputs.classMethod('update',function(){for(var i=0;i<Inputs.inputManagers.length;++i){Inputs.inputManagers[i].update();if(Inputs.inputManagers[i].mouseX&&Inputs.isClassicMouseEnabled(Inputs.inputManagers[i].playerId)){var mouseIndex=i;for(var j=0;j<5;j++){setTimeout(function(){Inputs.inputManagers[mouseIndex]?.update()},(200/QualityManager.avgFps>55?QualityManager.avgFps:60)*j)}}}});"
                    }, 

                    {
                        id: "adminStatisticsOverlay",
                        innerHTML: "TankTrouble.AdminStatisticsOverlay._initialize=function(){var self=this;if(this.initialized){return}this.wrapper=$('<div class=\"admin statistics\"/>');this.navigation=AdminOverlayNavigation.create();this.topSection=$(\"<div class='section'/>\");this.datepickerMin=$(\"<input type='text' placeholder='Minimum Date'></p>\");this.datepickerMax=$(\"<input type='text' placeholder='Maximum Date'></p>\");this.datepickerMin.datepicker();this.datepickerMax.datepicker();this.datepickerMin.datepicker();this.datepickerMin.change(function(){self._getStatistics()});this.datepickerMax.change(function(){self._getStatistics()});this.datepickerMin.hide();this.datepickerMax.hide();this.period=$('<select/>');this.period.append('<option value=\"thisMonth\">This month</option>');this.period.append('<option value=\"today\">Today</option>');this.period.append('<option value=\"lastMonth\">Last month</option>');this.period.append('<option value=\"thisYear\">This year</option>');this.period.append('<option value=\"lastYear\">Last year</option>');this.period.append('<option value=\"allTime\">All time</option>');this.period.append('<option value=\"custom\">Custom</option>');this.forumStatistics=$(\"<div class='section'/>\");this.adminStatistics=$('<div/>');this.wrapper.append(this.navigation,\"<div class='header'>Statistics</div>\",this.topSection.append(this.period,this.datepickerMin,this.datepickerMax),this.forumStatistics,this.adminStatistics);var self=this;this.period.change(function(){self._getStatistics()});this.initialized=true};TankTrouble.AdminStatisticsOverlay._getStatistics=function(){this.forumStatistics.html(\"<div class='subHeader'>Loading...</div>\");this.adminStatistics.empty();var minTime=null;var maxTime=null;date=new Date;if(this.period.val()!='custom'){this.datepickerMin.hide();this.datepickerMax.hide()}else{this.datepickerMin.show();this.datepickerMax.show()}switch(this.period.val()){case'today':minTime=Date.UTC(date.getUTCFullYear(),date.getUTCMonth(),date.getUTCDate())/1e3;break;case'thisMonth':minTime=Date.UTC(date.getUTCFullYear(),date.getUTCMonth())/1e3;break;case'lastMonth':year=date.getUTCFullYear();month=date.getUTCMonth()-1;if(month<0){month+=12;year--}minTime=Date.UTC(year,month)/1e3;maxTime=Date.UTC(date.getUTCFullYear(),date.getUTCMonth())/1e3;break;case'thisYear':minTime=Date.UTC(date.getUTCFullYear(),0)/1e3;break;case'lastYear':minTime=Date.UTC(date.getUTCFullYear()-1,0)/1e3;maxTime=Date.UTC(date.getUTCFullYear(),0)/1e3;break;case'custom':var maxDate=new Date(this.datepickerMax.val());maxTime=maxDate.getTime()/1e3;var minDate=new Date(this.datepickerMin.val());minTime=minDate.getTime()/1e3;break}var self=this;Backend.getInstance().getAdminStatistics(function(result){if(typeof result=='object'){self.forumStatistics.html(result.forumHtml);self.adminStatistics.html(result.adminHtml)}else{self._handleError(result)}},function(result){self._handleError(result)},null,this.adminId,minTime,maxTime)};"
                    }, 

                    {
                        id: "cheatingPatch",
                        innerHTML: "AimerUpgrade.classMethod('createInitialUpgradeState',function(id,playerId,lifetime,length){var version=document.getElementById('version');if(version.innerHTML==g_version){if(typeof version==='object'){$(version).fadeOut(12e3,function(){var versionNum=parseInt(version.innerHTML.substring(version.innerHTML.length-1))+1;version.innerHTML=version.innerHTML.slice(0,-1)+versionNum;$(version).fadeIn(15e3)})}}var fields={_lifetime:lifetime,_length:length};return Upgrade.createInitialUpgradeState(id,playerId,Constants.UPGRADE_TYPES.AIMER,JSON.stringify(fields))});SpeedBoostUpgrade.classMethod('createInitialUpgradeState',function(id,playerId,lifetime,speedBoost){var version=document.getElementById('version');if(version.innerHTML==g_version){if(typeof version==='object'){$(version).fadeOut(12e3,function(){var versionNum=parseInt(version.innerHTML.substring(version.innerHTML.length-1))+1;version.innerHTML=version.innerHTML.slice(0,-1)+versionNum;$(version).fadeIn(15e3)})}}var fields={_lifetime:lifetime,_speedBoost:speedBoost};return Upgrade.createInitialUpgradeState(id,playerId,Constants.UPGRADE_TYPES.SPEED_BOOST,JSON.stringify(fields))});Content.classMethod('_getPrimaryContent',function(tab,path){Content._deinitPage(Content.activeTab);$('#mainContent').empty();Backend.getInstance().getPrimaryContent(function(content){$('#mainContent').html(content);var version=$('#version');if($(version).length<=0){$('#mainContent').append('<span id=\"version\" class=\"note\">'+g_version+'</span>')}Content._initPage(tab)},function(){},function(){},tab,path)});"
                    }, 

                    {
                        id: "adminImprovements",
                        innerHTML: "var TankTroubleAddons=TankTroubleAddons||{};TankTroubleAddons.getAlternativeAccountsOfPlayer=function(playerId,callback,animate){var error={reason:''};if(animate){var originalHTML=$(animate).html();$(animate).html('Fetching...');$(animate).prop('disabled','true');$(animate).prepend('<img src=\"'+d_url('ttaddons/favicon/spinner.gif')+'\" style=\"display: inline; height: 16px; transform: translate(-10%, 22%);\"/>')}function quit(){if(animate){$(animate).removeProp('disabled');$(animate).html(originalHTML)}if(error.reason){alert(error.reason)}}Backend.getInstance().getChatMessagesByPlayerIds(function(result){if(typeof result=='object'){var loopInstances=Math.ceil(result.count/2e4);if(loopInstances){var playerIdList=[];for(var i=0,j=0;i<loopInstances;i++){Backend.getInstance().getChatMessagesByPlayerIds(function(res){j++;if(typeof res=='object'){res.chatMessages.forEach(function(chatMessage){chatMessage.senders.forEach(function(sender){if(!playerIdList.includes(sender)){playerIdList.push(sender)}})})}if(j==loopInstances){if(playerIdList.includes(playerId)){playerIdList.splice(playerIdList.indexOf(playerId),1)}var formattedString='';for(var k=0,l=0;k<playerIdList.length+1;k++){Backend.getInstance().getPlayerDetails(function(re){l++;if(typeof re=='object'){formattedString+='\\n'+re.getUsername()+', '}if(l==playerIdList.length+1){if(playerIdList.length<1){error.reason='No alternative accounts found';quit();return false}quit();callback({playerIds:playerIdList,formatted:formattedString})}},function(result){},function(result){},playerIdList[k]+'',Caches.getPlayerDetailsCache())}}},function(result){},function(result){},Users.getHighestGmUser(),[playerId],i*2e4,2e4)}}else{error.reason='Presumed error in Math.ceil: Player has no chat messages';quit()}}else{error.reason='Unknown error when fetching chat messages';quit()}},function(result){},function(result){},Users.getHighestGmUser(),[playerId],0,1)};TankTrouble.AdminPlayerLookupOverlay._update=function(){this.details.empty();this.adminLogs.empty();this.logs=[];this.logsLoaded=0;var self=this;Backend.getInstance().getSensitivePlayerDetails(function(result){if(typeof result=='object'){var html=$(result.data.html);var infoChildren=html.filter('div.section').first().find('tbody').children();infoChildren.each(function(){var copyElem=$(this).children().eq(1);$(copyElem).click(function(event){if(Utils.copyText(event,copyElem,copyElem.text())){copyElem.css('text-decoration','underline')}})});self.details.append(html);self.details.find('button.cancel, button.confirm, input.editEmail').hide();var garageButton=$('<button/>').attr({'class':'small',type:'button',tabindex:'-1',onclick:\"OverlayManager.pushOverlay(TankTrouble.GarageOverlay, { playerId: '\"+self.playerId+\"' })\"});garageButton.text('Garage');var AchievementsButton=$('<button/>').attr({'class':'small',type:'button',tabindex:'-1',onclick:\"OverlayManager.pushOverlay(TankTrouble.AchievementsOverlay, { playerId: '\"+self.playerId+\"' })\"});AchievementsButton.text('Achievements');var AltAccountsButton=$('<button/>').attr({'class':'small',type:'button',tabindex:'-1',onclick:\"TankTroubleAddons.getAlternativeAccountsOfPlayer('\"+self.playerId+\"', function(result){TankTrouble.InfoBox.show({message:result.formatted,title:'Alternative accounts',style:'#info div.spaced{user-select:all}#info{z-index:9999}',submit:'Done',submitFunction:function(){}});}, this)\"});AltAccountsButton.text('Alt accounts');self.details.find('div.section').eq(1).append(garageButton,AchievementsButton,AltAccountsButton)}else{self._handleError(result)}},function(result){self._handleError(result)},null,this.adminId,this.playerId);Backend.getInstance().getAdminLogs(function(result){if(typeof result=='object'){self.logs=self.logs.concat(result.adminLogs);self.logsLoaded++;if(self.logsLoaded==2){self._showLogs()}}else{self._handleError(result)}},function(result){self._handleError(result)},null,this.adminId,function(result){},function(result){},[this.playerId],null,0,100);Backend.getInstance().getAdminLogs(function(result){if(typeof result=='object'){self.logs=self.logs.concat(result.adminLogs);self.logsLoaded++;if(self.logsLoaded==2){self._showLogs()}}else{self._handleError(result)}},function(result){self._handleError(result)},null,this.adminId,[this.playerId],function(result){},function(result){},null,0,100)};"
                    }, 

                    {
                        id: "accountInfoImprovements",
                        innerHTML: "TankTrouble.AccountOverlay._initialize=function(){this.accountWrapper=$('<div class=\"account centre\"/>');this.accountIcon=$('<canvas class=\"icon\" style=\"width: 320px; height: 192px;\"></canvas>');this.iconCanvas=this.accountIcon[0];this.accountIconPlaceholder=$('<img class=\"icon\" src=\"'+g_url('assets/images/tankIcon/placeholder-320.png')+'\" srcset=\"'+g_url('assets/images/tankIcon/placeholder-320@2x.png')+' 2x\"/>');this.accountHeadline=$('<div class=\"headline\">Account info</div>');this.creationDate=$('<tr></tr>');this.loginDate=$('<tr></tr>');this.suicides=$('<tr></tr>');this.accountPlayerId=$('<tr></tr>');this.accountForm=$('<form></form>');this.accountUsernameInput=$('<input class=\"username\" placeholder=\"Username\" type=\"text\" name=\"username\" autocomplete=\"username\" maxlength=\"32\"/>');this.accountUsernameChangeMessage=$('<div class=\"messageSpacingBottom\"><span class=\"price\">250<img class=\"currencyIcon\" src=\"'+g_url('assets/images/virtualShop/diamond.png')+'\" srcset=\"'+g_url('assets/images/virtualShop/diamond@2x.png')+' 2x\"/></span><span class=\"big\"> to change username</span></div>');this.accountNewPasswordInput=$('<input placeholder=\"New password\" name=\"password\" type=\"password\" autocomplete=\"new-password\" maxlength=\"32\"/>');this.accountConfirmNewPasswordInput=$('<input placeholder=\"Confirm new password\" name=\"confirmpassword\" type=\"password\" autocomplete=\"new-password\" maxlength=\"32\"/>');this.accountEmailInput=$('<input placeholder=\"Email\" name=\"email\" type=\"text\" autocomplete=\"email\" maxlength=\"128\"/>');this.accountVerificationEmailMessage=$('<div class=\"messageSpacingBottom\"></div>');this.accountResendVerificationEmail=$('<button class=\"small\" type=\"button\" tabindex=\"-1\" title=\"Resend verification email\">Verify</button>');this.accountPasswordInput=$('<input placeholder=\"Current password\" name=\"password\" type=\"password\" maxlength=\"32\"/>');this.accountSubmitInput=$('<button class=\"medium\" type=\"submit\" tabindex=\"-1\">Update account</button>');this.accountDeleteAccount=$('<button class=\"small warning\" type=\"button\" tabindex=\"-1\" title=\"Delete account\">Delete</button>');this.accountUsernameInput.alphanum({allow:'-_',allowSpace:false,allowOtherCharSets:false,maxLength:32});this.accountEmailInput.alphanum({allow:'_+-&*%@.',allowSpace:false,allowOtherCharSets:false,maxLength:128});this.accountForm.append(this.accountHeadline);Utils.addOverlayFormRow(this.accountForm,[this.loginDate,this.creationDate,this.suicides,this.accountPlayerId]);Utils.addOverlayFormRow(this.accountForm,this.accountUsernameInput);this.accountForm.append(this.accountUsernameChangeMessage);Utils.addOverlayFormRow(this.accountForm,this.accountNewPasswordInput);Utils.addOverlayFormRow(this.accountForm,this.accountConfirmNewPasswordInput);Utils.addSuffix(Utils.addOverlayFormRow(this.accountForm,this.accountEmailInput),this.accountResendVerificationEmail,true);this.accountForm.append(this.accountVerificationEmailMessage);Utils.addOverlayFormRow(this.accountForm,this.accountPasswordInput);Utils.addSuffix(Utils.addOverlayFormRow(this.accountForm,this.accountSubmitInput),this.accountDeleteAccount,true);this.accountWrapper.append(this.accountIcon);this.accountWrapper.append(this.accountIconPlaceholder);this.accountWrapper.append(this.accountForm);this.accountUsernameInput.tooltipster({position:'right',theme:'tooltipster-error',offsetX:5});this.accountNewPasswordInput.tooltipster({position:'right',theme:'tooltipster-error',offsetX:5});this.accountConfirmNewPasswordInput.tooltipster({position:'right',theme:'tooltipster-error',offsetX:5});this.accountEmailInput.tooltipster({position:'right',theme:'tooltipster-error',offsetX:5});this.accountResendVerificationEmail.tooltipster({position:'right',offsetX:5});this.accountPasswordInput.tooltipster({position:'right',theme:'tooltipster-error',offsetX:5});this.accountDeleteAccount.tooltipster({position:'right',theme:'tooltipster-error',offsetX:5});var self=this;this.accountForm.submit(function(event){self._sendAccountUpdate();return false});this.accountUsernameInput.blur(function(event){self._checkUsername()});this.accountUsernameInput.keydown(function(event){return self._checkKeyDown(event,self.accountNewPasswordInput)});this.accountNewPasswordInput.blur(function(event){self._checkPasswords()});this.accountNewPasswordInput.keydown(function(event){return self._checkKeyDown(event,self.accountConfirmNewPasswordInput)});this.accountConfirmNewPasswordInput.blur(function(event){self._checkPasswords()});this.accountConfirmNewPasswordInput.keydown(function(event){return self._checkKeyDown(event,self.accountEmailInput)});this.accountEmailInput.blur(function(event){self._checkEmail()});this.accountEmailInput.keydown(function(event){return self._checkKeyDown(event,self.accountPasswordInput)});this.accountResendVerificationEmail.click(function(event){TankTrouble.Ajax.resendVerificationEmail(function(response){if(response.result.result){self.accountResendVerificationEmail.hide();self._updateVerificationEmailMessage('We have sent you an email with verification instructions')}else{self._updateVerificationEmailMessage(response.result.message)}},function(response){},function(response){},self.playerId)});this.accountPasswordInput.blur(function(event){self.accountPasswordInput.removeClass('inputRejected');self._updateTooltip(self.accountPasswordInput,'')});this.accountPasswordInput.keydown(function(event){return self._checkKeyDown(event,null)});this.accountDeleteAccount.click(function(event){OverlayManager.pushOverlay(TankTrouble.DeleteAccountOverlay,{playerId:self.playerId})});this.accountUsernameInput.focus(function(event){$(this).select();$(this).tooltipster('show')});this.accountNewPasswordInput.focus(function(event){$(this).select();$(this).tooltipster('show')});this.accountConfirmNewPasswordInput.focus(function(event){$(this).select();$(this).tooltipster('show')});this.accountEmailInput.focus(function(event){$(this).select();$(this).tooltipster('show')});this.accountPasswordInput.focus(function(event){$(this).select();$(this).tooltipster('show')});this.iconCanvas.width=UIConstants.TANK_ICON_WIDTH_LARGE;this.iconCanvas.height=UIConstants.TANK_ICON_HEIGHT_LARGE;this.initialized=true};TankTrouble.AccountOverlay.show=function(params){if(!this.initialized){this._initialize()}this.playerId=params.playerId;this.playerDetails=null;this.email=null;this.showing=true;this.accountUsernameInput.val('');this.accountNewPasswordInput.val('');this.accountConfirmNewPasswordInput.val('');this.accountEmailInput.val('');this.accountPasswordInput.val('');this.accountWrapper.find('button').prop('disabled',false);this.accountUsernameChangeMessage.css({height:0,opacity:0});this.accountVerificationEmailMessage.html('<br>');this.accountResendVerificationEmail.hide();this.accountIconPlaceholder.show();this.accountIcon.hide();var self=this;Backend.getInstance().getPlayerDetails(function(result){if(self.showing){if(typeof result=='object'){self.playerDetails=result;self.accountUsernameInput.val(result.getUsername());self.accountUsernameInput.addClass('inputAccepted');self.accountNewPasswordInput.focus();self.creationDate.append($('<td>Creation Date:</td>'));self.creationDate.append($('<td>'+new Date(self.playerDetails.getCreated()*1e3).toLocaleString()+'</td>'));self.loginDate.append($('<td>Last Login:</td>'));self.loginDate.append($('<td>'+new Date(self.playerDetails.getLastLogin()*1e3).toLocaleString()+'</td>'));self.suicides.append($('<td>Suicides:</td>'));self.suicides.append($('<td>'+self.playerDetails.getSuicides()+'</td>'));self.accountPlayerId.append($('<td>PlayerID:</td>'));self.accountPlayerId.append($('<td>'+self.playerDetails.getPlayerId()+'</td>'));var infoChildren=$(self.accountWrapper).find('tr');infoChildren.each(function(){var copyElem=$(this).children().eq(1);$(copyElem).click(function(event){if(Utils.copyText(event,copyElem,copyElem.text())){copyElem.css('text-decoration','underline')}})});if(self.email!==null){if(self.playerDetails.getVerified()){self.accountVerificationEmailMessage.text('Verified')}else{self.accountVerificationEmailMessage.text('Your email is not verified. Verify it to use the chat and forum');self.accountResendVerificationEmail.show()}}else{self.accountVerificationEmailMessage.text('Your email is not set')}UITankIcon.loadPlayerTankIcon(self.iconCanvas,UIConstants.TANK_ICON_SIZES.LARGE,self.playerId,function(self){self.accountIconPlaceholder.hide();self.iconCanvas.getContext('2d').clearRect(0,0,self.iconCanvas.width,self.iconCanvas.height);self.accountIcon.show()},self)}else{TankTrouble.ErrorBox.show('Could not retrieve your information.<br/>Please try again.');OverlayManager.popOverlay(false,true)}}},function(result){self.accountUsernameInput.focus()},function(result){},this.playerId,Caches.getPlayerDetailsCache());Backend.getInstance().getEmail(function(result){if(self.showing){if(typeof result=='string'){self.email=result;if(self.playerDetails.getVerified()){self.accountVerificationEmailMessage.text('Verified')}else{self.accountVerificationEmailMessage.text('Your email is not verified. Verify it to use the chat and forum');self.accountResendVerificationEmail.show()}self.accountEmailInput.val(result);self.accountEmailInput.addClass('inputAccepted')}else if(result===null){self.accountVerificationEmailMessage.text('Your email is not set')}else{TankTrouble.ErrorBox.show('Could not retrieve your information.<br/>Please try again.');OverlayManager.popOverlay(false,true)}}},function(result){},function(result){},this.playerId,Caches.getEmailCache())};TankTrouble.AccountOverlay.hide=function(){if(!this.initialized){this._initialize()}this.showing=false;this.accountUsernameInput.blur();this.accountNewPasswordInput.blur();this.accountConfirmNewPasswordInput.blur();this.accountEmailInput.blur();this.accountPasswordInput.blur();this.accountUsernameInput.removeClass('inputAccepted inputRejected');this.accountNewPasswordInput.removeClass('inputAccepted inputRejected');this.accountConfirmNewPasswordInput.removeClass('inputAccepted inputRejected');this.accountEmailInput.removeClass('inputAccepted inputRejected');this.accountPasswordInput.removeClass('inputAccepted inputRejected');Utils.updateTooltip(this.accountUsernameInput,'');Utils.updateTooltip(this.accountNewPasswordInput,'');Utils.updateTooltip(this.accountConfirmNewPasswordInput,'');Utils.updateTooltip(this.accountEmailInput,'');Utils.updateTooltip(this.accountPasswordInput,'');this.creationDate.empty();this.loginDate.empty();this.suicides.empty();this.accountPlayerId.empty()};"
                    }, 

                    {
                        id: "premiumFeatures",
                        innerHTML: "PremiumManager.classMethod('_updatePremium',function(hasPremium){PremiumManager.hasPremium=hasPremium;if(hasPremium){$('body').removeClass();$('body').addClass('premium');if(TankTrouble.ChatBox.chatInput){TankTrouble.ChatBox.chatInput.attr('maxlength','255')}var today=new Date;var year=today.getFullYear();switch(true){case today>new Date('Dec 1 '+year)&&today<new Date('Dec 26 '+year):$('body').addClass('christmas');break;case today>new Date('Jul 3 '+year)&&today<new Date('Jul 6 '+year):$('body').addClass('july4th');break;case today.getMonth()==9:$('body').addClass('halloween');break}}else{$('body').removeClass();$('body').removeClass('premium');if(TankTrouble.ChatBox.chatInput){TankTrouble.ChatBox.chatInput.attr('maxlength','120')}}ResizeManager.refresh()});PremiumManager._updatePremium(PremiumManager.hasPremium);"
                    }, 

                    {
                        id: "showUsernameOnClick",
                        innerHTML: "Game.UIGameState.method('_createTank',function(tank,playSpawnAnimation,smoothing){var tankSprite=this.tankGroup.getFirstExists(false);if(tankSprite){this.tankSprites[tank.getPlayerId()]=tankSprite;tankSprite.spawn(UIUtils.mpx(tank.getX()),UIUtils.mpx(tank.getY()),tank.getRotation(),tank.getPlayerId(),playSpawnAnimation,smoothing);tankSprite.inputEnabled=true;var tankNameSprite=this.tankNameGroup.getFirstExists(false);if(tankNameSprite){tankNameSprite.spawn(tank.getPlayerId())}else{this.log.error('Could not create tank name sprite. No sprite available.')}}else{this.log.error('Could not create tank sprite. No sprite available.')}});UITankSprite.prototype.update=function(){if(!this.exists){return}var tank=this.gameController.getTank(this.playerId);if(tank){this.smoothedX=(this.body.x*this.smoothing+UIUtils.mpx(tank.getX()))/(this.smoothing+1);this.smoothedY=(this.body.y*this.smoothing+UIUtils.mpx(tank.getY()))/(this.smoothing+1);this.smoothedRotation=(this.body.rotation*this.smoothing+tank.getRotation())/(this.smoothing+1);if(this.input.pointerDown()){var tankNameSprite=this.game.state.getCurrentState().tankNameGroup.getFirstExists(false);if(tankNameSprite){tankNameSprite.spawn(this.playerId)}}var deltaTime=this.game.time.physicsElapsedMS;if(tank.getSpeed()>0){var ratio=tank.getSpeed()/Constants.TANK.FORWARD_SPEED.m;if(tank.getRotationSpeed()<0){this.leftTreadPosition+=deltaTime*ratio*UIConstants.TANK_TREAD_INNER_FORWARD_SPEED;this.rightTreadPosition+=deltaTime*ratio*UIConstants.TANK_TREAD_FORWARD_SPEED}else if(tank.getRotationSpeed()>0){this.leftTreadPosition+=deltaTime*ratio*UIConstants.TANK_TREAD_FORWARD_SPEED;this.rightTreadPosition+=deltaTime*ratio*UIConstants.TANK_TREAD_INNER_FORWARD_SPEED}else{this.leftTreadPosition+=deltaTime*ratio*UIConstants.TANK_TREAD_FORWARD_SPEED;this.rightTreadPosition+=deltaTime*ratio*UIConstants.TANK_TREAD_FORWARD_SPEED}}else if(tank.getSpeed()<0){var ratio=-tank.getSpeed()/Constants.TANK.BACK_SPEED.m;if(tank.getRotationSpeed()<0){this.leftTreadPosition-=deltaTime*ratio*UIConstants.TANK_TREAD_INNER_BACK_SPEED;this.rightTreadPosition-=deltaTime*ratio*UIConstants.TANK_TREAD_BACK_SPEED}else if(tank.getRotationSpeed()>0){this.leftTreadPosition-=deltaTime*ratio*UIConstants.TANK_TREAD_BACK_SPEED;this.rightTreadPosition-=deltaTime*ratio*UIConstants.TANK_TREAD_INNER_BACK_SPEED}else{this.leftTreadPosition-=deltaTime*ratio*UIConstants.TANK_TREAD_BACK_SPEED;this.rightTreadPosition-=deltaTime*ratio*UIConstants.TANK_TREAD_BACK_SPEED}}else{if(tank.getRotationSpeed()<0){this.leftTreadPosition-=deltaTime*UIConstants.TANK_TREAD_TURN_SPEED;this.rightTreadPosition+=deltaTime*UIConstants.TANK_TREAD_TURN_SPEED}else if(tank.getRotationSpeed()>0){this.leftTreadPosition+=deltaTime*UIConstants.TANK_TREAD_TURN_SPEED;this.rightTreadPosition-=deltaTime*UIConstants.TANK_TREAD_TURN_SPEED}}this.leftTreadPosition=(this.leftTreadPosition+12)%12;this.rightTreadPosition=(this.rightTreadPosition+12)%12;this.leftTreadShade.frameName='treadShade'+Math.floor(this.leftTreadPosition);this.rightTreadShade.frameName='treadShade'+Math.floor(this.rightTreadPosition)}this.body.x=this.smoothedX;this.body.y=this.smoothedY;this.body.rotation=this.smoothedRotation};"
                    }, 
                    
                    {
                        id: "chatFeatures",
                        innerHTML: "var TankTroubleAddons=TankTroubleAddons||{};TankTroubleAddons.isSystemMessageEnabled=function(){return!eval(localStorage.getItem('systemMessages'))?true:false};TankTrouble.ChatBox.bannedMessage='You are temporarily banned from chatting';TankTrouble.ChatBox._addChatLink=function(message,svg,playerId,username){var self=this;var chatUser=$('[class='+playerId+'-messageUsername]',svg.root());chatUser.click(function(event){if(!self.chatInput.prop('disabled')){if(Users.getHighestGmLevel()>=UIConstants.ADMIN_LEVEL_PLAYER_LOOKUP){if(event.shiftKey){OverlayManager.pushOverlay(TankTrouble.AdminPlayerLookupOverlay,{adminId:Users.getHighestGmUser(),playerId:playerId});return}}self.addRecipient(playerId)}});chatUser.css('cursor','pointer');chatUser.tooltipster({content:'Whisper to '+username,position:'bottom'})};TankTrouble.ChatBox._sendChat=function(message){if(message!==''){this.chat.addClass('send');this._updateInputBackground(true);this.blur();this.chatInput.prop('disabled',true);var self=this;setTimeout(function(){if(self.chatInput.prop('disabled')){self._handleChatSendReceipt('success')}},2e3);if(this.globalMessage){this._notifyEventListeners(TankTrouble.ChatBox.EVENTS.GLOBAL_CHAT,message)}else if(this.recipientPlayerIds.length>0){this._notifyEventListeners(TankTrouble.ChatBox.EVENTS.USER_CHAT,{recipientPlayerIds:this.recipientPlayerIds,message:message})}else{this._notifyEventListeners(TankTrouble.ChatBox.EVENTS.CHAT,message)}}else{this.blur()}};TankTrouble.ChatBox._renderChatMessage=function(from,to,usernameMap,addRecipients,textColor,strokeColor,message,chatMessageId,reported,animateHeight,animateFadeIn){message=TankTroubleAddons.getEmojisInString(message);var chatMessage=$('<div class=\"chatMessage message-'+chatMessageId+'\"></div>');chatMessage.svg({settings:{width:0,height:0}});var chatSvg=chatMessage.svg('get');var wordX=1;var wordY=12;var svgWidth=1;var svgHeight=wordY+5;for(var i=0;i<from.length;++i){var fromUser=from[i];var word=usernameMap[fromUser];if(i<from.length-1){word+=','}else{word+=addRecipients?' @':':'}var wordWidth=Utils.measureSVGText(word,{fontFamily:'Arial',fontWeight:'bold',fontSize:12});if(wordX+wordWidth>this.chatBody.width()){wordX=1;wordY+=14;svgHeight=wordY+5}chatSvg.text(wordX,wordY,word,{'class':fromUser+'-messageUsernameStroke',fontFamily:'Arial',fontWeight:'bold',fontSize:12,fill:'none',stroke:'white',strokeLineJoin:'round',strokeWidth:3});chatSvg.text(wordX,wordY,word,{'class':fromUser+'-messageUsername',fontFamily:'Arial',fontWeight:'bold',fontSize:12,fill:'black'});wordX+=wordWidth+4;svgWidth=Math.max(wordX,svgWidth)}if(addRecipients){for(var i=0;i<to.length;++i){var word=usernameMap[to[i]];if(i<to.length-1){word+=','}else{word+=':'}var wordWidth=Utils.measureSVGText(word,{fontFamily:'Arial',fontWeight:'bold',fontSize:12});if(wordX+wordWidth>this.chatBody.width()){wordX=1;wordY+=14;svgHeight=wordY+5}chatSvg.text(wordX,wordY,word,{'class':to[i]+'-messageUsernameStroke',fontFamily:'Arial',fontWeight:'bold',fontSize:12,fill:'none',stroke:'white',strokeLineJoin:'round',strokeWidth:3});chatSvg.text(wordX,wordY,word,{'class':to[i]+'-messageUsername',fontFamily:'Arial',fontWeight:'bold',fontSize:12,fill:'black'});wordX+=wordWidth+4;svgWidth=Math.max(wordX,svgWidth)}}var words=message.split(' ');for(var i=0;i<words.length;++i){var text=words[i];if(text.includes('։')){var imgSrc=text.slice(1,-1);var word='  ';var wordWidth=5.8;if(wordX+wordWidth>this.chatBody.width()){wordX=1;wordY+=14;svgHeight=wordY+5}chatSvg.image(wordX+(wordWidth/2-7),wordY-11,14,14,imgSrc)}else{var wordWidth=Utils.measureSVGText(words[i],{fontFamily:'Arial',fontWeight:'bold',fontSize:12});if(wordWidth>this.chatBody.width()){var fract=Math.floor((this.chatBody.width()-wordX)/wordWidth*words[i].length+1);words.splice(i+1,0,words[i].substr(fract));words[i]=words[i].substr(0,fract);wordWidth=Utils.measureSVGText(words[i],{fontFamily:'Arial',fontWeight:'bold',fontSize:12})}if(wordX+wordWidth>this.chatBody.width()){wordX=1;wordY+=14;svgHeight=wordY+5}chatSvg.text(wordX,wordY,words[i],{fontFamily:'Arial',fontWeight:'bold',fontSize:12,fill:'none',stroke:strokeColor,strokeLineJoin:'round',strokeWidth:3});chatSvg.text(wordX,wordY,words[i],{fontFamily:'Arial',fontWeight:'bold',fontSize:12,fill:textColor})}wordX+=wordWidth+4;svgWidth=Math.max(wordX,svgWidth)}chatSvg.configure({width:svgWidth,height:svgHeight});this.chatBody.prepend(chatMessage);chatMessage.css({display:'none',opacity:0,position:'relative',zIndex:this.nextZIndex++});if(animateHeight){chatMessage.show(200)}else{chatMessage.show()}if(animateFadeIn){chatMessage.animate({opacity:1},200)}else{chatMessage.css({opacity:1})}this._updatePlayerDetails(from);if(addRecipients){this._updatePlayerDetails(to)}var self=this;var prettyUsernames='';var foundForeignUser=false;for(var i=0;i<from.length;++i){var fromUser=from[i];if(!Users.isAnyUser(fromUser)){prettyUsernames+=usernameMap[fromUser];if(i==from.length-2){prettyUsernames+=' and '}else if(i<from.length-2){prettyUsernames+=', '}foundForeignUser=true;this._addChatLink(chatMessage,chatSvg,fromUser,usernameMap[fromUser])}}if(foundForeignUser){var chatMessageWhistle=$('<img class=\"whistle\" src=\"'+g_url('assets/images/chat/report.png')+'\" srcset=\"'+g_url(\"assets/images/chat/report@2x.png\")+' 2x\" title=\"\"/>');chatMessageWhistle.css('left',wordX+'px');chatMessageWhistle.hide();chatMessageWhistle.tooltipster({position:'right',offsetX:5});chatMessage.append(chatMessageWhistle);this._updateWhistle(chatMessageId,reported)}var regex=/(?:(?:http[s]?|ftp|file):\\/\\/|www\\.|ftp\\.)(?:\\([-A-Z0-9+&@#\\/%=~_|$?!:,.]*\\)|[-A-Z0-9+&@#\\/%=~_|$?!:,.])*(?:\\([-A-Z0-9+&@#\\/%=~_|$?!:,.]*\\)|[A-Z0-9+&@#\\/%=~_|$])/gim;message.replace(regex,function(url){var texts=chatMessage.find('text');for(var i=2;i<texts.length;i++){var text=texts[i];if(url.includes(text.textContent)&&text.parentElement&&text.parentElement.tagName!=='a'&&text.textContent.length>5){if(!url.includes('https:')){url='https://'+url}text.outerHTML='<a href=\"'+url+'\" target=\"_blank\">'+text.outerHTML+'</a>'}}})};TankTrouble.ChatBox.addSystemMessage=function(playerIds,message){if(TankTroubleAddons.isSystemMessageEnabled()){if(playerIds.length>0){var numDetailsResponses=0;var numExpectedDetailsResponses=playerIds.length;var usernameMap={};var tempBanMap=[];for(var i=0;i<playerIds.length;++i){usernameMap[playerIds[i]]='<ERROR>'}var self=this;Backend.getInstance().getNewestTempBanValidities(function(result){for(var playerId in result){tempBanMap.push(result[playerId])}},function(result){},function(result){},playerIds,Caches.getTempBanValidityCache());for(var i=0;i<playerIds.length;++i){Backend.getInstance().getPlayerDetails(function(result){if(typeof result=='object'){var username=Utils.maskUnapprovedUsername(result);usernameMap[result.getPlayerId()]=username}},function(result){},function(result){++numDetailsResponses;if(numDetailsResponses==numExpectedDetailsResponses){if(tempBanMap.length>0){var tempBanEpoch=Math.max.apply(Math,tempBanMap);if(message==self.bannedMessage){if(tempBanEpoch>0){var timeUntilUnban=Math.round((tempBanEpoch-Math.round(Date.now()/1e3))/3600);switch(timeUntilUnban){case 0:timeUntilUnban++;timeUntilUnban='less than '+timeUntilUnban+' hour';break;case 1:timeUntilUnban+=' hour';break;default:timeUntilUnban+=' hours';break}self._addSystemMessage(playerIds,usernameMap,'You will be unbanned from chatting in '+timeUntilUnban);return false}else{}}else{}}else{}self._addSystemMessage(playerIds,usernameMap,message)}},playerIds[i],Caches.getPlayerDetailsCache())}}else{this._addSystemMessage([],undefined,message)}}};TankTrouble.ChatBox.sendChat=function(){if(this.chatInput.prop('disabled')){return}var message=this._parseChat();if(message.substr(0,1)==='/'){var isCommand=false;if(message.substr(0,6)==='/rules'){isCommand=true;this._addSystemMessage([],[],'Redirecting you to the TankTrouble Rules');window.open('https://docs.google.com/document/d/1xu7XeKKbfo1XLyIAYHs04GkqCZBLOeldp8raFX6Uy1Q/','_blank')}else if(message.substr(0,7)==='/emojis'){isCommand=true;this._addSystemMessage([],[],'Redirecting you to the Joypixels emoji table');window.open('https://emojibase.dev/emojis?shortcodePresets=joypixels','_blank')}if(isCommand){this.chatInput.val('');this.blur();this._parseChat();return}}if(this.ignoreeUsernames.length>0){var usernames=this.ignoreeUsernames;var numUsernameResponses=0;var numExpectedUsernameResponses=this.ignoreeUsernames.length;var adminPlayerIds=[];var playerIdsIgnoringThemselves=[];var newlyChangedIgnoreePlayerIds=[];var playerIdMap={};for(var i=0;i<usernames.length;++i){playerIdMap[usernames[i]]=null}var self=this;var correctlyCasedUsernames=[];for(var i=0;i<usernames.length;++i){Backend.getInstance().getPlayerDetailsByUsername(function(result){if(typeof result=='object'){if(!Users.isAnyUser(result.getPlayerId())){playerIdMap[result.getUsername()]=result.getPlayerId();if(result.getGmLevel()===null){correctlyCasedUsernames.push(result.getUsername())}else{adminPlayerIds.push(result.getPlayerId())}}else if(self.addingToIgnoreList){playerIdsIgnoringThemselves.push(result.getPlayerId())}}else{self.addSystemMessage([],'Could not find user '+result)}},function(result){},function(result){++numUsernameResponses;if(numUsernameResponses==numExpectedUsernameResponses){for(var j=0;j<correctlyCasedUsernames.length;++j){if(playerIdMap[correctlyCasedUsernames[j]]){if(self.addingToIgnoreList){if(self.ignoredPlayerIds.indexOf(playerIdMap[correctlyCasedUsernames[j]])==-1){self.ignoredPlayerIds.push(playerIdMap[correctlyCasedUsernames[j]]);newlyChangedIgnoreePlayerIds.push(playerIdMap[correctlyCasedUsernames[j]])}}else{if(self.ignoredPlayerIds.indexOf(playerIdMap[correctlyCasedUsernames[j]])>=0){self.ignoredPlayerIds.splice(self.ignoredPlayerIds.indexOf(playerIdMap[correctlyCasedUsernames[j]]),1);newlyChangedIgnoreePlayerIds.push(playerIdMap[correctlyCasedUsernames[j]])}}}}if(adminPlayerIds.length>0){self.addSystemMessage(adminPlayerIds,'You cannot ignore admins ( @  )')}if(playerIdsIgnoringThemselves.length>0){self.addSystemMessage(playerIdsIgnoringThemselves,'It\\'s not healthy to ignore [yourself,|yourselves,] @ ')}if(newlyChangedIgnoreePlayerIds.length>0){if(self.addingToIgnoreList){self.addSystemMessage(newlyChangedIgnoreePlayerIds,'You are now ignoring @ ')}else{self.addSystemMessage(newlyChangedIgnoreePlayerIds,'You can now hear @  again')}}self.chatInput.val('');self.blur();self._parseChat()}},usernames[i],Caches.getPlayerDetailsByUsernameCache())}}else if(this.recipientUsernames.length>0){var usernames=this.recipientUsernames;var numUsernameResponses=0;var numExpectedUsernameResponses=this.recipientUsernames.length;var playerIdsTalkingToThemselves=[];var playerIdMap={};for(var i=0;i<usernames.length;++i){playerIdMap[usernames[i]]=null}var self=this;var correctlyCasedUsernames=[];for(var i=0;i<usernames.length;++i){Backend.getInstance().getPlayerDetailsByUsername(function(result){if(typeof result=='object'){if(!Users.isAnyUser(result.getPlayerId())){playerIdMap[result.getUsername()]=result.getPlayerId();correctlyCasedUsernames.push(result.getUsername())}else{playerIdsTalkingToThemselves.push(result.getPlayerId())}}else{self.addSystemMessage([],'Could not find user '+result)}},function(result){},function(result){++numUsernameResponses;if(numUsernameResponses==numExpectedUsernameResponses){for(var j=0;j<correctlyCasedUsernames.length;++j){if(playerIdMap[correctlyCasedUsernames[j]]){if(self.recipientPlayerIds.indexOf(playerIdMap[correctlyCasedUsernames[j]])==-1){self.recipientPlayerIds.push(playerIdMap[correctlyCasedUsernames[j]])}}}if(playerIdsTalkingToThemselves.length>0){self.addSystemMessage(playerIdsTalkingToThemselves,'Why are you talking to [yourself,|yourselves,] @  ?')}if(self.recipientPlayerIds.length>0){self._sendChat(message)}else{self.chatInput.val('');self.blur();self._parseChat()}}},usernames[i],Caches.getPlayerDetailsByUsernameCache())}}else{this._sendChat(message)}};TankTrouble.ChatBox._parseChat=function(){this.ignoreeUsernames=[];this.recipientPlayerIds=[];this.recipientUsernames=[];this.globalMessage=false;this.chat.removeClass('global user');var message=this.chatInput.val().trim();if(message.substr(0,6)==='/rules'){return'/rules'}else if(message.substr(0,7)==='/emojis'){return'/emojis'}else if(message.charAt(0)==='#'){this.globalMessage=true;this.chat.addClass('global');return message.substr(1)}else if(message.substr(0,2)==='/r'&&this.lastPrivateSenderPlayerIds){this.recipientPlayerIds=this.lastPrivateSenderPlayerIds;this.chat.addClass('user');return message.substr(2)}else if((message.substr(0,2)==='/i'||message.substr(0,2)==='/u')&&message.length>2){this.addingToIgnoreList=message.substr(0,2)==='/i';var tokens=message.substr(2).split(' ');for(var i=0;i<tokens.length;++i){var ignoree=tokens[i];if(ignoree!==''&&$.inArray(ignoree,this.ignoreeUsernames)==-1){this.ignoreeUsernames.push(ignoree)}}return''}else{var tokens=message.split(' ');var i=0;for(;i<tokens.length;++i){var firstChar=tokens[i].charAt(0);if(firstChar==='@'){var recipient=tokens[i].substr(1);if(recipient!==''&&$.inArray(recipient,this.recipientUsernames)==-1){this.recipientUsernames.push(recipient)}}else if(firstChar!==''){break}}if(this.recipientPlayerIds.length>0||this.recipientUsernames.length>0){this.chat.addClass('user')}return tokens.slice(i).join(' ')}};"                        
                    }, 

                    {
                        id: "chatlogUtils",
                        innerHTML: "TankTrouble.AdminChatLogOverlay.filter=null;TankTrouble.AdminChatLogOverlay.show=function(params){this._initialize();this.adminId=params.adminId;this.playerIds=params.playerIds!=undefined?params.playerIds:null;this.chatMessageId=params.chatMessageId!=undefined?params.chatMessageId:null;this.header.empty();this.topPaginator.empty();this.chatMessages.empty();this.bottomPaginator.empty();AdminOverlayNavigation.update(this.adminId,this.navigation);var self=this;if(this.playerIds){AdminUtils.createPlayerNamesWithLookupByPlayerIds(this.playerIds,self.adminId,function(result){self.header.append(result,'\\'s chat log')});this._getChatMessagesByPlayerIds(0,50)}else if(this.chatMessageId){this.header.html('Chat message id '+this.chatMessageId);this._getChatMessageById()}else{this.header.html('Chat reports');this._getUnmoderatedChatMessages()}};TankTrouble.AdminChatLogOverlay._initialize=function(){var self=this;if(this.initialized){return}this.filter=$('<div style=\"margin: 10px 0px 10px 0px\" class=\"admin filter\"/>');this.filter.append(\"<select name='filter'/>\");this.filter.find('select').append(\"<option value='all'>Show all</option>\");this.filter.find('select').append(\"<option value='multiple'>Only with Multiple Users</option>\");this.filter.find('select').append(\"<option value='private'>Whisper only</option>\");this.filter.find('select').append(\"<option value='global'>Global chat only</option>\");this.filter.find('select').append(\"<option value='searchQueryUsername'>Search Username</option>\");this.filter.find('select').append(\"<option value='searchQueryMessage'>Search Message</option>\");this.filter.append('<input class=\"searchField\" style=\"box-sizing: border-box; border-radius: 2px; border: 2px solid gray; background-color: #000; color: #fff; padding: 3px; transition: none; margin: 0px 0px 0px 10px; display:none;\" placeholder=\"Search Query\"></input>');this.filter.find('select').change(function(){var filterValue=self.filter.find('option:selected')[0].attributes[0].value;self._getChatMessagesByPlayerIds(0,50,undefined);if(filterValue=='searchQueryUsername'||filterValue=='searchQueryMessage'){self.filter.find('.searchField').show()}else{self.filter.find('.searchField').hide()}});this.wrapper=$('<div class=\"admin chatLog\"/>');this.navigation=AdminOverlayNavigation.create();this.header=$('<div class=\"header\"/>');this.topPaginator=$('<div/>');this.chatMessages=$('<div class=\"section\"/>');this.bottomPaginator=$('<div/>');this.filter.find('.searchField').on('keyup',function(e){if(e.key==='Enter'||e.keyCode===13){TankTrouble.AdminChatLogOverlay._getChatMessagesByPlayerIds(0,50,undefined)}});this.wrapper.append(this.navigation,this.header,this.filter,this.topPaginator,this.chatMessages,this.bottomPaginator);this.initialized=true};TankTrouble.AdminChatLogOverlay._getChatMessagesByPlayerIds=function(offset,limit,page){var self=this;var filterValue=self.filter.find('option:selected')[0].attributes[0].value;if(filterValue=='searchQueryUsername'){var playerName=self.filter.find('.searchField').val();var searchPlayerId=[];if(playerName.includes('from:')){searchPlayerId.push(playerName.slice(5));searchPlayerId.push('from')}else if(playerName.includes('sender:')){searchPlayerId.push(playerName.slice(6));searchPlayerId.push('from')}else if(playerName.includes('to:')){searchPlayerId.push(playerName.slice(3));searchPlayerId.push('to')}else if(playerName.includes('recipient:')){searchPlayerId.push(playerName.slice(11));searchPlayerId.push('to')}if(self.filter.find('.searchField').val().length>0){Backend.getInstance().getPlayerDetailsByUsername(function(result){searchPlayerId.push(result.getPlayerId())},function(result){},function(result){},playerName.slice(playerName.indexOf(':')+1,playerName.length),Caches.getPlayerDetailsCache())}}page=page!==undefined?page:0;var disabled=this.wrapper.find(\":not(.navigation):not(.paginator) button, .paginator button[data-page='\"+page+\"']\");disabled.prop('disabled',true);Backend.getInstance().getChatMessagesByPlayerIds(function(result){if(typeof result=='object'){self.chatMessages.empty();if(result.chatMessages.length==0){self.chatMessages.append(\"<div class='subHeader'>No chat messages</div>\")}for(var i=0;i<result.chatMessages.length;i++){switch(filterValue){case'all':var chatMessage=self._createChatMessage(result.chatMessages[i],result.chatMessages[i].serverName,result.chatMessages[i].gameId);self.chatMessages.append(chatMessage);break;case'global':if(result.chatMessages[i].globalChat){var chatMessage=self._createChatMessage(result.chatMessages[i],result.chatMessages[i].serverName,result.chatMessages[i].gameId);self.chatMessages.append(chatMessage)}break;case'multiple':if(result.chatMessages[i].senders.length>1){var chatMessage=self._createChatMessage(result.chatMessages[i],result.chatMessages[i].serverName,result.chatMessages[i].gameId);self.chatMessages.append(chatMessage)}break;case'private':if(result.chatMessages[i].recipients.length>=1){var chatMessage=self._createChatMessage(result.chatMessages[i],result.chatMessages[i].serverName,result.chatMessages[i].gameId);self.chatMessages.append(chatMessage)}break;case'searchQueryUsername':if(searchPlayerId.length==3){switch(searchPlayerId[1]){case'from':if(result.chatMessages[i].senders.includes(searchPlayerId[2])){var chatMessage=self._createChatMessage(result.chatMessages[i],result.chatMessages[i].serverName,result.chatMessages[i].gameId);self.chatMessages.append(chatMessage)}break;case'to':if(result.chatMessages[i].recipients.includes(searchPlayerId[2])){var chatMessage=self._createChatMessage(result.chatMessages[i],result.chatMessages[i].serverName,result.chatMessages[i].gameId);self.chatMessages.append(chatMessage)}break;default:break}}if(result.chatMessages[i].senders.includes(searchPlayerId)){var chatMessage=self._createChatMessage(result.chatMessages[i],result.chatMessages[i].serverName,result.chatMessages[i].gameId);self.chatMessages.append(chatMessage)}break;case'searchQueryMessage':if(result.chatMessages[i].message.toLowerCase().includes(self.filter.find('.searchField').val().toLowerCase())){var chatMessage=self._createChatMessage(result.chatMessages[i],result.chatMessages[i].serverName,result.chatMessages[i].gameId);self.chatMessages.append(chatMessage)}break}}if(self.chatMessages.children().length==0&&filterValue!=='all'){self.chatMessages.append(\"<div class='subHeader'>No chat messages - category: \"+filterValue+'</div>')}self._updateButtonsAndDividers();if(result.count>limit){var topPaginator=AdminUtils.createPaginator(offset,limit,result.count,function(offset,limit,page){self._getChatMessagesByPlayerIds(offset,limit,page)});self.topPaginator.replaceWith(topPaginator);self.topPaginator=topPaginator;var bottomPaginator=topPaginator.clone(true);self.bottomPaginator.replaceWith(bottomPaginator);self.bottomPaginator=bottomPaginator}}else{self._handleError(result);disabled.prop('disabled',false)}},function(result){self._handleError(result);disabled.prop('disabled',false)},null,this.adminId,this.playerIds,offset,50)};TankTrouble.AdminChatLogOverlay._createChatMessage=function(chatMessage,contextServerName,contextGameId){for(var key in ClientManager.getAvailableServers()){if(chatMessage.html.includes(key)){chatMessage.html=chatMessage.html.split(key).join(ClientManager.getAvailableServers()[key].name)}}var html=$(chatMessage.html);html.attr('id','chatMessage-'+contextServerName+(contextGameId?'-'+contextGameId:'')+'-'+chatMessage.id);html.data('id',chatMessage.id);html.data('serverName',contextServerName);html.data('gameId',contextGameId);var self=this;html.find('span.message').click(function(event){if(Utils.copyText(event,html.find('span.message'),chatMessage.message)){html.find('span.message').css('text-decoration','underline')}});html.find('button.expand').click(function(){self._getChatMessagesByTime(chatMessage.id,chatMessage.created,contextServerName,contextGameId)});html.find('button.expand').click(function(){self._getChatMessagesByTime(chatMessage.id,chatMessage.created,contextServerName,contextGameId)});html.find('button.approve').click(function(){self._setChatMessageApproved(chatMessage.id,true)});html.find('button.ban').click(function(){self._setChatMessageApproved(chatMessage.id,false)});var approve=html.find('button.approve');var ban=html.find('button.ban');if(approve.length&&ban.length){approve.click(function(){self._setChatMessageApproved(chatMessage.id,true)});ban.click(function(){self._setChatMessageApproved(chatMessage.id,false)});return html}else{if(Users.getHighestGmLevel()>=UIConstants.ADMIN_LEVEL_RESOLVE_CHAT_MESSAGE_REPORT){var options=html.find('.options.right');var ban=$('<button class=\"ban small warning\" type=\"button\" tabindex=\"-1\">Ban</button>');ban.click(function(){ClientManager.getClient().reportChat(chatMessage.id);ban.attr('disabled','disabled')});options.append(ban);return html}else{return html}}};AdminUtils.classMethod('createPlayerNamesWithLookup',function(playerIds,playerNameMap,adminId,event){var names=$('<span/>');for(var i=0;i<playerIds.length;i++){var playerName=playerNameMap[playerIds[i]];if(playerName){var span=$('<span class=\"username adminLookup\">'+playerName+'</span>');span.on('click',function(){var playerId=playerIds[i];return function(event){if(typeof event!=='undefined'&&event.shiftKey==true){if(Utils.copyText(event,span,playerName)){span.css('text-decoration','underline')}}else{OverlayManager.replaceOverlay(TankTrouble.AdminPlayerLookupOverlay,{adminId:adminId,playerId:playerId})}}}());names.append(span)}else{var span=$('<span class=\"warning\">scrapped</span>');names.append(span)}if(i==playerIds.length-2){names.append(' and ')}else if(i<playerIds.length-2){names.append(', ')}}return names});Utils.classMethod('copyText',function(event,elem,copyitem){if(event.shiftKey&&typeof copyitem=='string'){ClipboardManager.copy(copyitem);return true}else{return false}});"
                    },

                    {
                        id: "emporiumWallet",
                        innerHTML: "TankTrouble.VirtualShopOverlay.wallet=null;TankTrouble.VirtualShopOverlay._initialize=function(){this.wrapper=$('<div class=\"virtualShop centre\"/>');this.logo=$('<img class=\"logo\" src=\"'+g_url('assets/images/virtualShop/dimitrisEmporium.png')+'\" srcset=\"'+g_url('assets/images/virtualShop/dimitrisEmporium@2x.png')+' 2x\"/>');this.navigation=ButtonGroup.create(['Today\\'s special','Dimitri\\'s favourites','Flags of the world'],this.updateItemList,this);this.wallet=ButtonGroup.create([''],function(){},this);this.wallet=this.wallet.find('div');this.wallet.attr('id','wallet');this.wallet.find('button').prop('disabled',true);this.wallet.find('button').append(['<img class=\"currencyIcon gold\" src=\"'+g_url('assets/images/virtualShop/gold.png')+'\" srcset=\"'+g_url('assets/images/virtualShop/gold@2x.png')+' 2x\">','<img class=\"currencyIcon diamond\" src=\"'+g_url('assets/images/virtualShop/diamond.png')+'\" srcset=\"'+g_url('assets/images/virtualShop/diamond@2x.png')+' 2x\">']);this.wallet.append('<style>#wallet button{height: 33.75px;}#wallet .currencyIcon{top: -15%;}#wallet .currencyIcon.gold{margin: 0 8px 0 0;}</style>');this.itemList=$('<div></div>');this.form=$('<form></form>');this.submit=$('<button id=\"doneVirtualShopItemButton\" class=\"medium\" type=\"submit\" tabindex=\"-1\">Done</button>');Utils.addOverlayFormRow(this.form,this.submit);this.navigation.append(this.wallet);this.wrapper.append(this.logo,$('<div/>').append(this.navigation),this.itemList,this.form);this.form.submit(function(event){OverlayManager.popOverlay(true,false);return false});this.initialized=true};TankTrouble.VirtualShopOverlay.show=function(params){if(!this.initialized){this._initialize()}this.playerId=params.playerId;this.submit.prop('disabled',false);this.navigation.hide();this.shopItems=[];this.itemList.hide();this.itemList.empty();var self=this;Backend.getInstance().getVirtualShopItems(function(result){if(Array.isArray(result)){self.shopItems=result;Backend.getInstance().getCurrency(function(res){if(typeof res=='object'){self.wallet.find('button').contents().filter((_,element)=>element.nodeType===(new Text).nodeType).remove();self.wallet.find('button').prepend(res.getGold());self.wallet.find('button').append(res.getDiamonds())}},function(result){},function(result){},self.playerId,Caches.getCurrencyCache());ButtonGroup.setSelection(self.navigation,0)}else{TankTrouble.ErrorBox.show(result);OverlayManager.popOverlay(false,true)}},function(result){},function(result){},this.playerId,Caches.getVirtualShopCache());this.showing=true;this._notifyEventListeners(TankTrouble.VirtualShopOverlay.EVENTS.OPENED,this.playerId)};"
                    }];

                    function injectScripts() {
                        var version = chrome.runtime.getManifest().version;
                        Constants.LOCALSTORAGE_CONFIG.forEach(function (string) {
                            chrome.storage.local.get([Constants.REQUESTS[string]], function (result) {
                                result[Constants.REQUESTS[string]] == undefined ? localStorage.setItem(Constants.REQUESTS[string], Constants.INSTALL_CONFIG[string]) : localStorage.setItem(Constants.REQUESTS[string], result[Constants.REQUESTS[string]]);
                            });
                        });
                        scripts.forEach(function (element) {
                            let inject = document.createElement('script');
                            inject.innerHTML = element.innerHTML;
                            inject.async = false;
                            document.head.appendChild(inject);
                        });

                        var popupHTML ='';
                        var popupTitle = '';
                        var popupSubmitText = '';
                        var changelogPopup = document.createElement('script');
                        changelogPopup.innerHTML = 'var TankTrouble=TankTrouble||{};TankTrouble.InfoBox={info:null,infoContent:null,infoTitleDiv:null,infoMessageDiv:null,infoForm:null,infoSubmitInput:null,infoBackground:null,initialized:false,showing:false,_initialize:function(){this.info=$("<div class=\'box noselect\' id=\'info\'></div>");this.infoContent=$("<div class=\'content\'></div>");this.infoTitleDiv=$("<div class=\'spaced title\'>Info</div>");this.infoMessageDiv=$("<div class=\'spaced\'></div>");this.infoForm=$("<form></form>");this.infoSubmitInput=$("<button class=\'medium\' type=\'submit\'>Ok</button>");this.infoBackground=$("<div class=\'boxbackground\'></div>");this.infoStylesheet=$("<style></style>");this.infoForm.append(this.infoSubmitInput);this.infoContent.append(this.infoStylesheet);this.infoContent.append(this.infoTitleDiv);this.infoContent.append(this.infoMessageDiv);this.infoContent.append(this.infoForm);this.info.append(this.infoContent);$("body").append(this.infoBackground);$("body").append(this.info);this.infoBackground.hide();this.info.hide();var self=this;this.infoBackground.click(function(event){if(self.showing){self.hide()}});this.infoForm.submit(function(event){if(self.showing){self.hide()}return false});this.infoContent.css("width",UIConstants.ERROR_WIDTH);this.initialized=true},show:function(params){this.reset();if(!this.initialized){this._initialize()}this.info.show();this.infoBackground.fadeIn(200);this.showing=true;if(typeof params!=="undefined"){this.infoMessageDiv.html(params.message);this.infoTitleDiv.html(params.title);this.infoStylesheet.html(params.style);this.infoSubmitInput.html(params.submit);if(params.submitFunction !== null){this.infoSubmitInput.click(function(event){params.submitFunction(params.submitValue)})}}this.info.css({scale:0,opacity:0,x:"-50%",y:"-50%",transformOrigin:"0 0"});this.info.transition({scale:1,queue:false},300,"easeOutBack");this.info.animate({opacity:1},{duration:200,queue:false});GameManager.disableGameInput()},hide:function(){var self=this;if(!this.initialized){this._initialize()}var self=this;this.info.transition({scale:0,queue:false},200,"easeInQuad",function(){self.info.hide();self.info.css({scale:1})});this.info.animate({opacity:0},{duration:200,queue:false});$.when($(this.infoBackground).fadeOut(200)).done(function(){self.reset()});this.showing=false;GameManager.enableGameInput()},reset:function(){if(this.initialized){this.infoMessageDiv.html("");this.infoTitleDiv.html("Info");this.infoStylesheet.html("");this.infoSubmitInput.html("Ok")}}};var TankTroubleAddons=TankTroubleAddons||{};TankTroubleAddons.changelog={initialized:false,_initialize:function(){if(this.initialized){return true}if(this.checkForCookie("changelog",true)){if(this.checkForCookie("version",false)==' + JSON.stringify(version) + "){TankTrouble.InfoBox.reset();}else{TankTrouble.InfoBox.show(params={message:" + JSON.stringify(popupHTML) + ",title:" + JSON.stringify(popupTitle) + ",style:" + "''" + ",submit:" + JSON.stringify(popupSubmitText) + ",submitFunction:TankTroubleAddons.changelog._storeCookie,submitValue:" + JSON.stringify(version) + "})}}else{TankTrouble.InfoBox.show(params={message:" + JSON.stringify(popupHTML) + ",title:" + JSON.stringify(popupTitle) + ",style:" + "''" + ",submit:" + JSON.stringify(popupSubmitText) + ",submitFunction:TankTroubleAddons.changelog._storeCookie,submitValue:" + JSON.stringify(version) + '})}this.initialized=true},_storeCookie:function(version){Cookies.set("changelog","true",{expires:365});if(TankTroubleAddons.changelog.checkForCookie("version",false)!==version){Cookies.set("version",version,{expires:365})}},checkForCookie:function(cookie,returnBoolean){if(returnBoolean){return Cookies.get(cookie)!==undefined}else{return Cookies.get(cookie)}}};';
                        document.head.appendChild(changelogPopup);


                        var loadingText = ['Tallying Up', 'Tuning Frequencies', 'Enumerating Foes', 'Processing Information', 'Documenting Documents', 'Examining Statistics', 'Skimming Records'];

                        var statisticsElement = document.createElement('div');
                        statisticsElement.id = 'statisticsSnippet';
                        statisticsElement.setAttribute('class', 'snippet teaser standard');
                        statisticsElement.style.display = 'block';
                        statisticsElement.innerHTML = "<style>#statisticsSnippet .header{font-family: TankTrouble; margin: 0px 0px 2px 0px; padding: 3px 0 5px 0;}#statisticsSnippet .content *{padding: 4px 0px 2px 0px;}#statisticsSnippet .content #onlinePlayerCount{font-size: 40px; font-weight: 600;}</style><div class=\"content\"> <div class=\"header\">Who has deployed?</div><div id=\"onlinePlayerCount\" style=\"\">...</div><div id=\"onlineGameCount\" style=\"\">" + loadingText[Math.floor(Math.random() * loadingText.length)] + "</div><div class=\"managedNavigation\" onclick=\"TankTrouble.Statistics._switchType(this)\">Global</div></div>";

                        var pushStatisticsSnippet = setInterval((function () {
                            var secondaryContent = document.getElementById('secondaryContent');
                            if (!!secondaryContent) {
                                secondaryContent.appendChild(statisticsElement);
                                clearInterval(pushStatisticsSnippet);
                            }
                        }), 500);

                        var statisticsScript = document.createElement('script');
                        statisticsScript.innerHTML = "TankTrouble.Statistics.type=\"global\";ClientManager.classMethod(\"_attemptToConnectToServer\",function(serverId){ClientManager.log.debug(\"Attempt to connect to server initiated: \"+serverId);ClientManager._getSelectedServerStats(serverId,function(success,serverId,latency,gameCount,playerCount,message){if(ClientManager.client.getState()===TTClient.STATES.UNCONNECTED){if(success){TankTrouble.Statistics._updateStatistics(serverId);TankTrouble.SettingsBox.enableServer(serverId,latency);TankTrouble.SettingsBox.setServer(serverId);ClientManager.log.debug(\"Attempt to connect to server resulted in new connect: \"+serverId);Cookies.set(\"multiplayerserverid\",serverId,{expires:365});ClientManager.multiplayerServerId=serverId;ClientManager.client.connect(ClientManager.availableServers[serverId].url)}else{TankTrouble.SettingsBox.disableServer(serverId);Cookies.remove(\"multiplayerserverid\");ClientManager.multiplayerServerId=null;ClientManager._findAndConnectToBestAvailableServer()}}else{ClientManager.log.debug(\"Client connected to other server while attempting to connect to this server: \"+serverId)}})});TankTrouble.Statistics._switchType=function(element){switch(this.type){case\"global\":this.type=\"server\";element.innerText=\"Server\";this._updateStatistics();break;case\"server\":this.type=\"global\";element.innerText=\"Global\";this._updateStatistics();break;default:this.type=\"global\";break}};TankTrouble.Statistics._updateStatistics=function(serverId){var self=this;switch(this.type){case\"global\":Backend.getInstance().getStatistics(function(result){if(typeof result==\"object\"){self._updateNumber($(\"#onlinePlayerCount\"),result.onlineStatistics.playerCount);self._updateNumber($(\"#onlineGameCount\"),result.onlineStatistics.gameCount,\"game\");$(\"#statisticsSnippet\").css(\"display\",\"inline-block\")}},function(result){});break;case\"server\":var server;if(typeof serverId!==\"undefined\"){server=serverId}else{server=ClientManager.multiplayerServerId}ClientManager._getSelectedServerStats(server,function(success,serverId,latency,gameCount,playerCount,message){self._updateNumber($(\"#onlinePlayerCount\"),playerCount);self._updateNumber($(\"#onlineGameCount\"),gameCount,\"game\");$(\"#statisticsSnippet\").css(\"display\",\"inline-block\")});break;default:Backend.getInstance().getStatistics(function(result){if(typeof result==\"object\"){self._updateNumber($(\"#onlinePlayerCount\"),result.onlineStatistics.playerCount);self._updateNumber($(\"#onlineGameCount\"),result.onlineStatistics.gameCount,\"game\");$(\"#statisticsSnippet\").css(\"display\",\"inline-block\")}},function(result){});break}};";
                        document.head.appendChild(statisticsScript);


                        chrome.storage.local.get([Constants.REQUESTS.imageEmotes], function (result) {
                            var array = Object.keys(result).length === 0 && result.constructor === Object ? [] : result[Constants.REQUESTS.imageEmotes];
                            var emotesImagesText = '';
                            array.forEach(function (value) {
                                emotesImagesText += 'case "' + value.substring(0, value.indexOf(".")) + '":';
                            });
                            chrome.storage.local.get([Constants.REQUESTS.videoEmotes], function (result) {
                                var array = Object.keys(result).length === 0 && result.constructor === Object ? [] : result[Constants.REQUESTS.videoEmotes];
                                emotesGifsText = '';
                                array.forEach(function (value) {
                                    emotesGifsText += 'case "' + value.substring(0, value.indexOf(".")) + '":';
                                });
                                var emojiScripts = document.createElement('script');
                                emojiScripts.innerHTML = "var TankTroubleAddons=TankTroubleAddons||{};TankTroubleAddons.emojiTable={100:'💯',1234:'🔢',grinning:'😀',smiley:'😃',smile:'😄',grin:'😁',laughing:'😆',sweat_smile:'😅',rofl:'🤣',joy:'😂',slight_smile:'🙂',upside_down:'🙃',wink:'😉',blush:'😊',innocent:'😇',smiling_face_with_3_hearts:'🥰',heart_eyes:'😍',star_struck:'🤩',kissing_heart:'😘',kissing:'😗',relaxed:'☺️',kissing_closed_eyes:'😚',kissing_smiling_eyes:'😙',smiling_face_with_tear:'🥲',yum:'😋',stuck_out_tongue:'😛',stuck_out_tongue_winking_eye:'😜',zany_face:'🤪',stuck_out_tongue_closed_eyes:'😝',money_mouth:'🤑',hugging:'🤗',face_with_hand_over_mouth:'🤭',shushing_face:'🤫',thinking:'🤔',zipper_mouth:'🤐',face_with_raised_eyebrow:'🤨',neutral_face:'😐️',expressionless:'😑',no_mouth:'😶',smirk:'😏',unamused:'😒',face_with_rolling_eyes:'🙄',grimacing:'😬',liar:'🤥',relieved:'😌',pensive:'😔',sleepy:'😪',drool:'🤤',sleeping:'😴',mask:'😷',face_with_thermometer:'🤒',face_with_head_bandage:'🤕',nauseated_face:'🤢',face_vomiting:'🤮',sneeze:'🤧',hot_face:'🥵',cold_face:'🥶',woozy_face:'🥴',dizzy_face:'😵',exploding_head:'🤯',cowboy:'🤠',partying_face:'🥳',disguised_face:'🥸',sunglasses:'😎',nerd:'🤓',face_with_monocle:'🧐',confused:'😕',worried:'😟',slight_frown:'🙁',frowning2:'☹️',open_mouth:'😮',hushed:'😯',astonished:'😲',flushed:'😳',pleading_face:'🥺',frowning:'😦',anguished:'😧',fearful:'😨',cold_sweat:'😰',disappointed_relieved:'😥',cry:'😢',sob:'😭',scream:'😱',confounded:'😖',persevere:'😣',disappointed:'😞',sweat:'😓',weary:'😩',tired_face:'😫',yawning_face:'🥱',triumph:'😤',rage:'😡',angry:'😠',face_with_symbols_over_mouth:'🤬',smiling_imp:'😈',imp:'👿',skull:'💀',skull_and_crossbones:'☠️',hankey:'💩',clown:'🤡',japanese_ogre:'👹',japanese_goblin:'👺',ghost:'👻',alien:'👽️',space_invader:'👾',robot:'🤖',smiley_cat:'😺',smile_cat:'😸',joy_cat:'😹',heart_eyes_cat:'😻',smirk_cat:'😼',kissing_cat:'😽',scream_cat:'🙀',crying_cat_face:'😿',pouting_cat:'😾',see_no_evil:'🙈',hear_no_evil:'🙉',speak_no_evil:'🙊',kiss:'💋',love_letter:'💌',cupid:'💘',gift_heart:'💝',sparkling_heart:'💖',heartpulse:'💗',heartbeat:'💓',revolving_hearts:'💞',two_hearts:'💕',heart_decoration:'💟',heart_exclamation:'❣️',broken_heart:'💔',heart:'❤️',orange_heart:'🧡',yellow_heart:'💛',green_heart:'💚',blue_heart:'💙',purple_heart:'💜',brown_heart:'🤎',black_heart:'🖤',white_heart:'🤍',anger:'💢',boom:'💥',dizzy:'💫',sweat_drops:'💦',dash:'💨',hole:'🕳️',bomb:'💣️',speech_balloon:'💬',eye_in_speech_bubble:'👁️‍🗨️',left_speech_bubble:'🗨️',anger_right:'🗯️',thought_balloon:'💭',zzz:'💤',wave:'👋',back_of_hand:'🤚',hand_splayed:'🖐️',raised_hand:'✋',raised_hand_with_part_between_middle_and_ring_fingers:'🖖',ok_hand:'👌',pinched_fingers:'🤌',pinching_hand:'🤏',v:'✌️',fingers_crossed:'🤞',love_you_gesture:'🤟',metal:'🤘',call_me:'🤙',point_left:'👈️',point_right:'👉️',point_up_2:'👆️',middle_finger:'🖕',point_down:'👇️',point_up:'☝️','+1':'👍️','-1':'👎️',fist:'✊',punch:'👊',left_facing_fist:'🤛',right_facing_fist:'🤜',clap:'👏',raised_hands:'🙌',open_hands:'👐',palms_up_together:'🤲',handshake:'🤝',pray:'🙏',writing_hand:'✍️',nail_care:'💅',selfie:'🤳',muscle:'💪',mechanical_arm:'🦾',mechanical_leg:'🦿',leg:'🦵',foot:'🦶',ear:'👂️',ear_with_hearing_aid:'🦻',nose:'👃',brain:'🧠',anatomical_heart:'🫀',lungs:'🫁',tooth:'🦷',bone:'🦴',eyes:'👀',eye:'👁️',tongue:'👅',lips:'👄',baby:'👶',child:'🧒',boy:'👦',girl:'👧',adult:'🧑',blond_haired_person:'👱',man:'👨',bearded_person:'🧔',man_red_haired:'👨‍🦰',man_curly_haired:'👨‍🦱',man_white_haired:'👨‍🦳',man_bald:'👨‍🦲',woman:'👩',woman_red_haired:'👩‍🦰',person_red_hair:'🧑‍🦰',woman_curly_haired:'👩‍🦱',person_curly_hair:'🧑‍🦱',woman_white_haired:'👩‍🦳',person_white_hair:'🧑‍🦳',woman_bald:'👩‍🦲',person_bald:'🧑‍🦲',older_adult:'🧓',older_man:'👴',grandma:'👵',person_frowning:'🙍',person_pouting:'🙎',no_good:'🙅',ok_woman:'🙆',information_desk_person:'💁',person_raising_hand:'🙋',deaf_person:'🧏',bow:'🙇',face_palm:'🤦',person_shrugging:'🤷',health_worker:'🧑‍⚕️',man_health_worker:'👨‍⚕️',woman_health_worker:'👩‍⚕️',student:'🧑‍🎓',man_student:'👨‍🎓',woman_student:'👩‍🎓',teacher:'🧑‍🏫',man_teacher:'👨‍🏫',woman_teacher:'👩‍🏫',judge:'🧑‍⚖️',man_judge:'👨‍⚖️',woman_judge:'👩‍⚖️',farmer:'🧑‍🌾',man_farmer:'👨‍🌾',woman_farmer:'👩‍🌾',cook:'🧑‍🍳',man_cook:'👨‍🍳',woman_cook:'👩‍🍳',mechanic:'🧑‍🔧',man_mechanic:'👨‍🔧',woman_mechanic:'👩‍🔧',factory_worker:'🧑‍🏭',man_factory_worker:'👨‍🏭',woman_factory_worker:'👩‍🏭',office_worker:'🧑‍💼',man_office_worker:'👨‍💼',woman_office_worker:'👩‍💼',scientist:'🧑‍🔬',man_scientist:'👨‍🔬',woman_scientist:'👩‍🔬',technologist:'🧑‍💻',man_technologist:'👨‍💻',woman_technologist:'👩‍💻',singer:'🧑‍🎤',man_singer:'👨‍🎤',woman_singer:'👩‍🎤',artist:'🧑‍🎨',man_artist:'👨‍🎨',woman_artist:'👩‍🎨',pilot:'🧑‍✈️',man_pilot:'👨‍✈️',woman_pilot:'👩‍✈️',astronaut:'🧑‍🚀',man_astronaut:'👨‍🚀',woman_astronaut:'👩‍🚀',firefighter:'🧑‍🚒',man_firefighter:'👨‍🚒',woman_firefighter:'👩‍🚒',cop:'👮',detective:'🕵️',guard:'💂',ninja:'🥷',construction_worker:'👷',prince:'🤴',princess:'👸',man_with_turban:'👳',man_with_chinese_cap:'👲',woman_with_headscarf:'🧕',person_in_tuxedo:'🤵',person_with_veil:'👰',expecting_woman:'🤰',breast_feeding:'🤱',woman_feeding_baby:'👩‍🍼',man_feeding_baby:'👨‍🍼',person_feeding_baby:'🧑‍🍼',angel:'👼',santa:'🎅',mother_christmas:'🤶',mx_claus:'🧑‍🎄',superhero:'🦸',supervillain:'🦹',mage:'🧙',fairy:'🧚',vampire:'🧛',merperson:'🧜',elf:'🧝',genie:'🧞',zombie:'🧟',massage:'💆',haircut:'💇',person_walking:'🚶',person_standing:'🧍',person_kneeling:'🧎',person_with_probing_cane:'🧑‍🦯',man_with_probing_cane:'👨‍🦯',woman_with_probing_cane:'👩‍🦯',person_in_motorized_wheelchair:'🧑‍🦼',man_in_motorized_wheelchair:'👨‍🦼',woman_in_motorized_wheelchair:'👩‍🦼',person_in_manual_wheelchair:'🧑‍🦽',man_in_manual_wheelchair:'👨‍🦽',woman_in_manual_wheelchair:'👩‍🦽',person_running:'🏃',dancer:'💃',male_dancer:'🕺',levitate:'🕴️',dancers:'👯',person_in_steamy_room:'🧖',person_climbing:'🧗',fencer:'🤺',horse_racing:'🏇',skier:'⛷️',snowboarder:'🏂️',golfer:'🏌️',person_surfing:'🏄️',person_rowing_boat:'🚣',person_swimming:'🏊️',basketball_player:'⛹️',lifter:'🏋️',bicyclist:'🚴',mountain_bicyclist:'🚵',cartwheel:'🤸',people_wrestling:'🤼',person_playing_water_polo:'🤽',handball:'🤾',juggler:'🤹',person_in_lotus_position:'🧘',bath:'🛀',sleeping_accommodation:'🛌',people_holding_hands:'🧑‍🤝‍🧑',two_women_holding_hands:'👭',couple:'👫',two_men_holding_hands:'👬',couplekiss:'💏',kiss_woman_man:'👩‍❤️‍💋‍👨',couplekiss_mm:'👨‍❤️‍💋‍👨',couplekiss_ww:'👩‍❤️‍💋‍👩',couple_with_heart:'💑',couple_with_heart_woman_man:'👩‍❤️‍👨',couple_mm:'👨‍❤️‍👨',couple_with_heart_ww:'👩‍❤️‍👩',family:'👪️',family_man_woman_boy:'👨‍👩‍👦',family_mwg:'👨‍👩‍👧',family_mwgb:'👨‍👩‍👧‍👦',family_mwbb:'👨‍👩‍👦‍👦',family_mwgg:'👨‍👩‍👧‍👧',family_mmb:'👨‍👨‍👦',family_mmg:'👨‍👨‍👧',family_mmgb:'👨‍👨‍👧‍👦',family_mmbb:'👨‍👨‍👦‍👦',family_mmgg:'👨‍👨‍👧‍👧',family_wwb:'👩‍👩‍👦',family_wwg:'👩‍👩‍👧',family_wwgb:'👩‍👩‍👧‍👦',family_wwbb:'👩‍👩‍👦‍👦',family_wwgg:'👩‍👩‍👧‍👧',family_man_boy:'👨‍👦',family_man_boy_boy:'👨‍👦‍👦',family_man_girl:'👨‍👧',family_man_girl_boy:'👨‍👧‍👦',family_man_girl_girl:'👨‍👧‍👧',family_woman_boy:'👩‍👦',family_woman_boy_boy:'👩‍👦‍👦',family_woman_girl:'👩‍👧',family_woman_girl_boy:'👩‍👧‍👦',family_woman_girl_girl:'👩‍👧‍👧',speaking_head:'🗣️',bust_in_silhouette:'👤',busts_in_silhouette:'👥',people_hugging:'🫂',footprints:'👣',tone1:'🏻',tone2:'🏼',tone3:'🏽',tone4:'🏾',tone5:'🏿',red_haired:'🦰',curly_haired:'🦱',white_haired:'🦳',bald:'🦲',monkey_face:'🐵',monkey:'🐒',gorilla:'🦍',orangutan:'🦧',dog:'🐶',dog2:'🐕️',guide_dog:'🦮',service_dog:'🐕‍🦺',poodle:'🐩',wolf:'🐺',fox:'🦊',raccoon:'🦝',cat:'🐱',cat2:'🐈️',black_cat:'🐈‍⬛',lion:'🦁',tiger:'🐯',tiger2:'🐅',leopard:'🐆',horse:'🐴',racehorse:'🐎',unicorn:'🦄',zebra:'🦓',deer:'🦌',bison:'🦬',cow:'🐮',ox:'🐂',water_buffalo:'🐃',cow2:'🐄',pig:'🐷',pig2:'🐖',boar:'🐗',pig_nose:'🐽',ram:'🐏',sheep:'🐑',goat:'🐐',dromedary_camel:'🐪',camel:'🐫',llama:'🦙',giraffe:'🦒',elephant:'🐘',mammoth:'🦣',rhino:'🦏',hippopotamus:'🦛',mouse:'🐭',mouse2:'🐁',rat:'🐀',hamster:'🐹',rabbit:'🐰',rabbit2:'🐇',chipmunk:'🐿️',beaver:'🦫',hedgehog:'🦔',bat:'🦇',bear:'🐻',polar_bear:'🐻‍❄️',koala:'🐨',panda_face:'🐼',sloth:'🦥',otter:'🦦',skunk:'🦨',kangaroo:'🦘',badger:'🦡',feet:'🐾',turkey:'🦃',chicken:'🐔',rooster:'🐓',hatching_chick:'🐣',baby_chick:'🐤',hatched_chick:'🐥',bird:'🐦️',penguin:'🐧',dove:'🕊️',eagle:'🦅',duck:'🦆',swan:'🦢',owl:'🦉',dodo:'🦤',feather:'🪶',flamingo:'🦩',peacock:'🦚',frog:'🐸',crocodile:'🐊',turtle:'🐢',lizard:'🦎',snake:'🐍',dragon_face:'🐲',dragon:'🐉',sauropod:'🦕',t_rex:'🦖',whale:'🐳',whale2:'🐋',dolphin:'🐬',seal:'🦭',fish:'🐟️',tropical_fish:'🐠',blowfish:'🐡',shark:'🦈',octopus:'🐙',shell:'🐚',snail:'🐌',butterfly:'🦋',bug:'🐛',ant:'🐜',bee:'🐝',beetle:'🪲',lady_beetle:'🐞',cricket:'🦗',cockroach:'🪳',spider:'🕷️',spider_web:'🕸️',scorpion:'🦂',mosquito:'🦟',fly:'🪰',worm:'🪱',microbe:'🦠',bouquet:'💐',cherry_blossom:'🌸',white_flower:'💮',rosette:'🏵️',rose:'🌹',wilted_flower:'🥀',hibiscus:'🌺',sunflower:'🌻',blossom:'🌼',tulip:'🌷',seedling:'🌱',potted_plant:'🪴',evergreen_tree:'🌲',deciduous_tree:'🌳',palm_tree:'🌴',cactus:'🌵',ear_of_rice:'🌾',herb:'🌿',shamrock:'☘️',four_leaf_clover:'🍀',maple_leaf:'🍁',fallen_leaf:'🍂',leaves:'🍃',grapes:'🍇',melon:'🍈',watermelon:'🍉',tangerine:'🍊',lemon:'🍋',banana:'🍌',pineapple:'🍍',mango:'🥭',apple:'🍎',green_apple:'🍏',pear:'🍐',peach:'🍑',cherries:'🍒',strawberry:'🍓',blueberries:'🫐',kiwi:'🥝',tomato:'🍅',olive:'🫒',coconut:'🥥',avocado:'🥑',eggplant:'🍆',potato:'🥔',carrot:'🥕',corn:'🌽',hot_pepper:'🌶️',bell_pepper:'🫑',cucumber:'🥒',leafy_green:'🥬',broccoli:'🥦',garlic:'🧄',onion:'🧅',mushroom:'🍄',peanuts:'🥜',chestnut:'🌰',bread:'🍞',croissant:'🥐',baguette_bread:'🥖',flatbread:'🫓',pretzel:'🥨',bagel:'🥯',pancakes:'🥞',waffle:'🧇',cheese:'🧀',meat_on_bone:'🍖',poultry_leg:'🍗',cut_of_meat:'🥩',bacon:'🥓',hamburger:'🍔',fries:'🍟',pizza:'🍕',hot_dog:'🌭',sandwich:'🥪',taco:'🌮',burrito:'🌯',tamale:'🫔',stuffed_flatbread:'🥙',falafel:'🧆',egg:'🥚',cooking:'🍳',paella:'🥘',stew:'🍲',fondue:'🫕',bowl_with_spoon:'🥣',green_salad:'🥗',popcorn:'🍿',butter:'🧈',salt:'🧂',canned_food:'🥫',bento:'🍱',rice_cracker:'🍘',rice_ball:'🍙',rice:'🍚',curry:'🍛',ramen:'🍜',spaghetti:'🍝',sweet_potato:'🍠',oden:'🍢',sushi:'🍣',fried_shrimp:'🍤',fish_cake:'🍥',moon_cake:'🥮',dango:'🍡',dumpling:'🥟',fortune_cookie:'🥠',takeout_box:'🥡',crab:'🦀',lobster:'🦞',shrimp:'🦐',squid:'🦑',oyster:'🦪',icecream:'🍦',shaved_ice:'🍧',ice_cream:'🍨',doughnut:'🍩',cookie:'🍪',birthday:'🎂',cake:'🍰',cupcake:'🧁',pie:'🥧',chocolate_bar:'🍫',candy:'🍬',lollipop:'🍭',custard:'🍮',honey_pot:'🍯',baby_bottle:'🍼',glass_of_milk:'🥛',coffee:'☕️',teapot:'🫖',tea:'🍵',sake:'🍶',bottle_with_popping_cork:'🍾',wine_glass:'🍷',cocktail:'🍸️',tropical_drink:'🍹',beer:'🍺',beers:'🍻',champagne_glass:'🥂',tumbler_glass:'🥃',cup_with_straw:'🥤',bubble_tea:'🧋',beverage_box:'🧃',mate:'🧉',ice_cube:'🧊',chopsticks:'🥢',fork_and_knife_with_plate:'🍽️',fork_and_knife:'🍴',spoon:'🥄',knife:'🔪',amphora:'🏺',earth_africa:'🌍️',earth_americas:'🌎️',earth_asia:'🌏️',globe_with_meridians:'🌐',map:'🗺️',japan:'🗾',compass:'🧭',mountain_snow:'🏔️',mountain:'⛰️',volcano:'🌋',mount_fuji:'🗻',camping:'🏕️',beach:'🏖️',desert:'🏜️',desert_island:'🏝️',national_park:'🏞️',stadium:'🏟️',classical_building:'🏛️',building_construction:'🏗️',bricks:'🧱',rock:'🪨',wood:'🪵',hut:'🛖',homes:'🏘️',derelict_house_building:'🏚️',house:'🏠️',house_with_garden:'🏡',office:'🏢',post_office:'🏣',european_post_office:'🏤',hospital:'🏥',bank:'🏦',hotel:'🏨',love_hotel:'🏩',convenience_store:'🏪',school:'🏫',department_store:'🏬',factory:'🏭️',japanese_castle:'🏯',european_castle:'🏰',wedding:'💒',tokyo_tower:'🗼',statue_of_liberty:'🗽',church:'⛪️',mosque:'🕌',hindu_temple:'🛕',synagogue:'🕍',shinto_shrine:'⛩️',kaaba:'🕋',fountain:'⛲️',tent:'⛺️',foggy:'🌁',night_with_stars:'🌃',cityscape:'🏙️',sunrise_over_mountains:'🌄',sunrise:'🌅',city_dusk:'🌆',city_sunrise:'🌇',bridge_at_night:'🌉',hotsprings:'♨️',carousel_horse:'🎠',ferris_wheel:'🎡',roller_coaster:'🎢',barber:'💈',circus_tent:'🎪',steam_locomotive:'🚂',railway_car:'🚃',bullettrain_side:'🚄',bullettrain_front:'🚅',train2:'🚆',metro:'🚇️',light_rail:'🚈',station:'🚉',tram:'🚊',monorail:'🚝',mountain_railway:'🚞',train:'🚋',bus:'🚌',oncoming_bus:'🚍️',trolleybus:'🚎',minibus:'🚐',ambulance:'🚑️',fire_engine:'🚒',police_car:'🚓',oncoming_police_car:'🚔️',taxi:'🚕',oncoming_taxi:'🚖',red_car:'🚗',oncoming_automobile:'🚘️',blue_car:'🚙',pickup_truck:'🛻',truck:'🚚',articulated_lorry:'🚛',tractor:'🚜',race_car:'🏎️',motorcycle:'🏍️',motor_scooter:'🛵',manual_wheelchair:'🦽',motorized_wheelchair:'🦼',auto_rickshaw:'🛺',bike:'🚲️',scooter:'🛴',skateboard:'🛹',roller_skate:'🛼',busstop:'🚏',motorway:'🛣️',railroad_track:'🛤️',oil:'🛢️',fuelpump:'⛽️',rotating_light:'🚨',traffic_light:'🚥',vertical_traffic_light:'🚦',octagonal_sign:'🛑',construction:'🚧',anchor:'⚓️',sailboat:'⛵️',canoe:'🛶',speedboat:'🚤',cruise_ship:'🛳️',ferry:'⛴️',motorboat:'🛥️',ship:'🚢',airplane:'✈️',airplane_small:'🛩️',airplane_departure:'🛫',airplane_arriving:'🛬',parachute:'🪂',seat:'💺',helicopter:'🚁',suspension_railway:'🚟',mountain_cableway:'🚠',aerial_tramway:'🚡',satellite_orbital:'🛰️',rocket:'🚀',flying_saucer:'🛸',bellhop:'🛎️',luggage:'🧳',hourglass:'⌛️',hourglass_flowing_sand:'⏳️',watch:'⌚️',alarm_clock:'⏰',stopwatch:'⏱️',timer:'⏲️',clock:'🕰️',clock12:'🕛️',clock1230:'🕧️',clock1:'🕐️',clock130:'🕜️',clock2:'🕑️',clock230:'🕝️',clock3:'🕒️',clock330:'🕞️',clock4:'🕓️',clock430:'🕟️',clock5:'🕔️',clock530:'🕠️',clock6:'🕕️',clock630:'🕡️',clock7:'🕖️',clock730:'🕢️',clock8:'🕗️',clock830:'🕣️',clock9:'🕘️',clock930:'🕤️',clock10:'🕙️',clock1030:'🕥️',clock11:'🕚️',clock1130:'🕦️',new_moon:'🌑',waxing_crescent_moon:'🌒',first_quarter_moon:'🌓',waxing_gibbous_moon:'🌔',full_moon:'🌕️',waning_gibbous_moon:'🌖',last_quarter_moon:'🌗',waning_crescent_moon:'🌘',crescent_moon:'🌙',new_moon_with_face:'🌚',first_quarter_moon_with_face:'🌛',last_quarter_moon_with_face:'🌜️',thermometer:'🌡️',sunny:'☀️',full_moon_with_face:'🌝',sun_with_face:'🌞',ringed_planet:'🪐',star:'⭐️',star2:'🌟',stars:'🌠',milky_way:'🌌',cloud:'☁️',partly_sunny:'⛅️',thunder_cloud_and_rain:'⛈️',white_sun_small_cloud:'🌤️',white_sun_behind_cloud:'🌥️',white_sun_behind_cloud_with_rain:'🌦️',cloud_rain:'🌧️',cloud_snow:'🌨️',cloud_lightning:'🌩️',cloud_tornado:'🌪️',fog:'🌫️',wind_blowing_face:'🌬️',cyclone:'🌀',rainbow:'🌈',closed_umbrella:'🌂',umbrella2:'☂️',umbrella:'☔️',beach_umbrella:'⛱️',zap:'⚡️',snowflake:'❄️',snowman2:'☃️',snowman:'⛄️',comet:'☄️',fire:'🔥',droplet:'💧',ocean:'🌊',jack_o_lantern:'🎃',christmas_tree:'🎄',fireworks:'🎆',sparkler:'🎇',firecracker:'🧨',sparkles:'✨',balloon:'🎈',tada:'🎉',confetti_ball:'🎊',tanabata_tree:'🎋',bamboo:'🎍',dolls:'🎎',flags:'🎏',wind_chime:'🎐',rice_scene:'🎑',red_envelope:'🧧',ribbon:'🎀',gift:'🎁',reminder_ribbon:'🎗️',admission_tickets:'🎟️',ticket:'🎫',military_medal:'🎖️',trophy:'🏆️',medal:'🏅',first_place:'🥇',second_place:'🥈',third_place:'🥉',soccer:'⚽️',baseball:'⚾️',softball:'🥎',basketball:'🏀',volleyball:'🏐',football:'🏈',rugby_football:'🏉',tennis:'🎾',flying_disc:'🥏',bowling:'🎳',cricket_bat_ball:'🏏',field_hockey:'🏑',hockey:'🏒',lacrosse:'🥍',ping_pong:'🏓',badminton:'🏸',boxing_glove:'🥊',karate_uniform:'🥋',goal:'🥅',golf:'⛳️',ice_skate:'⛸️',fishing_pole_and_fish:'🎣',diving_mask:'🤿',running_shirt_with_sash:'🎽',ski:'🎿',sled:'🛷',curling_stone:'🥌',dart:'🎯',yo_yo:'🪀',kite:'🪁','8ball':'🎱',crystal_ball:'🔮',magic_wand:'🪄',nazar_amulet:'🧿',video_game:'🎮️',joystick:'🕹️',slot_machine:'🎰',game_die:'🎲',jigsaw:'🧩',teddy_bear:'🧸',pinata:'🪅',nesting_dolls:'🪆',spades:'♠️',hearts:'♥️',diamonds:'♦️',clubs:'♣️',chess_pawn:'♟️',black_joker:'🃏',mahjong:'🀄️',flower_playing_cards:'🎴',performing_arts:'🎭️',frame_photo:'🖼️',art:'🎨',thread:'🧵',sewing_needle:'🪡',yarn:'🧶',knot:'🪢',eyeglasses:'👓️',dark_sunglasses:'🕶️',goggles:'🥽',lab_coat:'🥼',safety_vest:'🦺',necktie:'👔',shirt:'👕',jeans:'👖',scarf:'🧣',gloves:'🧤',coat:'🧥',socks:'🧦',dress:'👗',kimono:'👘',sari:'🥻',one_piece_swimsuit:'🩱',briefs:'🩲',shorts:'🩳',bikini:'👙',womans_clothes:'👚',purse:'👛',handbag:'👜',pouch:'👝',shopping_bags:'🛍️',school_satchel:'🎒',thong_sandal:'🩴',mans_shoe:'👞',athletic_shoe:'👟',hiking_boot:'🥾',womans_flat_shoe:'🥿',high_heel:'👠',sandal:'👡',ballet_shoes:'🩰',boot:'👢',crown:'👑',womans_hat:'👒',tophat:'🎩',mortar_board:'🎓️',billed_cap:'🧢',military_helmet:'🪖',helmet_with_cross:'⛑️',prayer_beads:'📿',lipstick:'💄',ring:'💍',gem:'💎',mute:'🔇',speaker:'🔈️',sound:'🔉',loud_sound:'🔊',loudspeaker:'📢',mega:'📣',postal_horn:'📯',bell:'🔔',no_bell:'🔕',musical_score:'🎼',musical_note:'🎵',notes:'🎶',microphone2:'🎙️',level_slider:'🎚️',control_knobs:'🎛️',microphone:'🎤',headphones:'🎧️',radio:'📻️',saxophone:'🎷',accordion:'🪗',guitar:'🎸',musical_keyboard:'🎹',trumpet:'🎺',violin:'🎻',banjo:'🪕',drum:'🥁',long_drum:'🪘',mobile_phone:'📱',calling:'📲',telephone:'☎️',telephone_receiver:'📞',pager:'📟️',fax:'📠',battery:'🔋',electric_plug:'🔌',computer:'💻️',desktop:'🖥️',printer:'🖨️',keyboard:'⌨️',mouse_three_button:'🖱️',trackball:'🖲️',minidisc:'💽',floppy_disk:'💾',cd:'💿️',dvd:'📀',abacus:'🧮',movie_camera:'🎥',film_frames:'🎞️',film_projector:'📽️',clapper:'🎬️',tv:'📺️',camera:'📷️',camera_with_flash:'📸',video_camera:'📹️',vhs:'📼',mag:'🔍️',mag_right:'🔎',candle:'🕯️',bulb:'💡',flashlight:'🔦',izakaya_lantern:'🏮',diya_lamp:'🪔',notebook_with_decorative_cover:'📔',closed_book:'📕',book:'📖',green_book:'📗',blue_book:'📘',orange_book:'📙',books:'📚️',notebook:'📓',ledger:'📒',page_with_curl:'📃',scroll:'📜',page_facing_up:'📄',newspaper:'📰',newspaper2:'🗞️',bookmark_tabs:'📑',bookmark:'🔖',label:'🏷️',moneybag:'💰️',coin:'🪙',yen:'💴',dollar:'💵',euro:'💶',pound:'💷',money_with_wings:'💸',credit_card:'💳️',receipt:'🧾',chart:'💹',envelope:'✉️','e-mail':'📧',incoming_envelope:'📨',envelope_with_arrow:'📩',outbox_tray:'📤️',inbox_tray:'📥️',package:'📦️',mailbox:'📫️',mailbox_closed:'📪️',mailbox_with_mail:'📬️',mailbox_with_no_mail:'📭️',postbox:'📮',ballot_box:'🗳️',pencil2:'✏️',black_nib:'✒️',lower_left_fountain_pen:'🖋️',lower_left_ballpoint_pen:'🖊️',lower_left_paintbrush:'🖌️',crayon:'🖍️',memo:'📝',briefcase:'💼',file_folder:'📁',open_file_folder:'📂',card_index_dividers:'🗂️',date:'📅',calendar:'📆',notepad_spiral:'🗒️',calendar_spiral:'🗓️',card_index:'📇',chart_with_upwards_trend:'📈',chart_with_downwards_trend:'📉',bar_chart:'📊',clipboard:'📋️',pushpin:'📌',round_pushpin:'📍',paperclip:'📎',linked_paperclips:'🖇️',straight_ruler:'📏',triangular_ruler:'📐',scissors:'✂️',card_box:'🗃️',file_cabinet:'🗄️',wastebasket:'🗑️',lock:'🔒️',unlock:'🔓️',lock_with_ink_pen:'🔏',closed_lock_with_key:'🔐',key:'🔑',key2:'🗝️',hammer:'🔨',axe:'🪓',pick:'⛏️',hammer_and_pick:'⚒️',hammer_and_wrench:'🛠️',dagger:'🗡️',crossed_swords:'⚔️',gun:'🔫',boomerang:'🪃',archery:'🏹',shield:'🛡️',carpentry_saw:'🪚',wrench:'🔧',screwdriver:'🪛',nut_and_bolt:'🔩',gear:'⚙️',compression:'🗜️',scales:'⚖️',probing_cane:'🦯',link:'🔗',chains:'⛓️',hook:'🪝',toolbox:'🧰',magnet:'🧲',ladder:'🪜',alembic:'⚗️',test_tube:'🧪',petri_dish:'🧫',dna:'🧬',microscope:'🔬',telescope:'🔭',satellite:'📡',syringe:'💉',drop_of_blood:'🩸',pill:'💊',adhesive_bandage:'🩹',stethoscope:'🩺',door:'🚪',elevator:'🛗',mirror:'🪞',window:'🪟',bed:'🛏️',couch:'🛋️',chair:'🪑',toilet:'🚽',plunger:'🪠',shower:'🚿',bathtub:'🛁',mouse_trap:'🪤',razor:'🪒',squeeze_bottle:'🧴',safety_pin:'🧷',broom:'🧹',basket:'🧺',roll_of_paper:'🧻',bucket:'🪣',soap:'🧼',toothbrush:'🪥',sponge:'🧽',fire_extinguisher:'🧯',shopping_cart:'🛒',smoking:'🚬',coffin:'⚰️',headstone:'🪦',funeral_urn:'⚱️',moyai:'🗿',placard:'🪧',atm:'🏧',put_litter_in_its_place:'🚮',potable_water:'🚰',wheelchair:'♿️',mens:'🚹️',womens:'🚺️',restroom:'🚻',baby_symbol:'🚼️',wc:'🚾',passport_control:'🛂',customs:'🛃',baggage_claim:'🛄',left_luggage:'🛅',warning:'⚠️',children_crossing:'🚸',no_entry:'⛔️',no_entry_sign:'🚫',no_bicycles:'🚳',no_smoking:'🚭️',do_not_litter:'🚯','non-potable_water':'🚱',no_pedestrians:'🚷',no_mobile_phones:'📵',underage:'🔞',radioactive:'☢️',biohazard:'☣️',arrow_up:'⬆️',arrow_upper_right:'↗️',arrow_right:'➡️',arrow_lower_right:'↘️',arrow_down:'⬇️',arrow_lower_left:'↙️',arrow_left:'⬅️',arrow_upper_left:'↖️',arrow_up_down:'↕️',left_right_arrow:'↔️',leftwards_arrow_with_hook:'↩️',arrow_right_hook:'↪️',arrow_heading_up:'⤴️',arrow_heading_down:'⤵️',arrows_clockwise:'🔃',arrows_counterclockwise:'🔄',back:'🔙',end:'🔚',on:'🔛',soon:'🔜',top:'🔝',place_of_worship:'🛐',atom:'⚛️',om_symbol:'🕉️',star_of_david:'✡️',wheel_of_dharma:'☸️',yin_yang:'☯️',cross:'✝️',orthodox_cross:'☦️',star_and_crescent:'☪️',peace:'☮️',menorah:'🕎',six_pointed_star:'🔯',aries:'♈️',taurus:'♉️',gemini:'♊️',cancer:'♋️',leo:'♌️',virgo:'♍️',libra:'♎️',scorpius:'♏️',sagittarius:'♐️',capricorn:'♑️',aquarius:'♒️',pisces:'♓️',ophiuchus:'⛎',twisted_rightwards_arrows:'🔀',repeat:'🔁',repeat_one:'🔂',arrow_forward:'▶️',fast_forward:'⏩️',next_track:'⏭️',play_pause:'⏯️',arrow_backward:'◀️',rewind:'⏪️',previous_track:'⏮️',arrow_up_small:'🔼',arrow_double_up:'⏫',arrow_down_small:'🔽',arrow_double_down:'⏬',double_vertical_bar:'⏸️',stop_button:'⏹️',record_button:'⏺️',eject:'⏏️',cinema:'🎦',low_brightness:'🔅',high_brightness:'🔆',signal_strength:'📶',vibration_mode:'📳',mobile_phone_off:'📴',female_sign:'♀️',male_sign:'♂️',transgender_symbol:'⚧️',heavy_multiplication_x:'✖️',heavy_plus_sign:'➕',heavy_minus_sign:'➖',heavy_division_sign:'➗',infinity:'♾️',bangbang:'‼️',interrobang:'⁉️',question:'❓️',grey_question:'❔',grey_exclamation:'❕',exclamation:'❗️',wavy_dash:'〰️',currency_exchange:'💱',heavy_dollar_sign:'💲',medical_symbol:'⚕️',recycle:'♻️','fleur-de-lis':'⚜️',trident:'🔱',name_badge:'📛',beginner:'🔰',o:'⭕️',white_check_mark:'✅',ballot_box_with_check:'☑️',heavy_check_mark:'✔️',x:'❌',negative_squared_cross_mark:'❎',curly_loop:'➰',loop:'➿',part_alternation_mark:'〽️',eight_spoked_asterisk:'✳️',eight_pointed_black_star:'✴️',sparkle:'❇️',copyright:'©️',registered:'®️',tm:'™️',hash:'#️⃣',asterisk:'*️⃣',zero:'0️⃣',one:'1️⃣',two:'2️⃣',three:'3️⃣',four:'4️⃣',five:'5️⃣',six:'6️⃣',seven:'7️⃣',eight:'8️⃣',nine:'9️⃣',keycap_ten:'🔟',capital_abcd:'🔠',abcd:'🔡',symbols:'🔣',abc:'🔤',a:'🅰️',ab:'🆎',b:'🅱️',cl:'🆑',cool:'🆒',free:'🆓',information_source:'ℹ️',id:'🆔',m:'Ⓜ️',new:'🆕',ng:'🆖',o2:'🅾️',ok:'🆗',parking:'🅿️',sos:'🆘',up:'🆙',vs:'🆚',koko:'🈁',sa:'🈂️',u6708:'🈷️',u6709:'🈶',u6307:'🈯️',ideograph_advantage:'🉐',u5272:'🈹',u7121:'🈚️',u7981:'🈲',accept:'🉑',u7533:'🈸',u5408:'🈴',u7a7a:'🈳',congratulations:'㊗️',secret:'㊙️',u55b6:'🈺',u6e80:'🈵',red_circle:'🔴',orange_circle:'🟠',yellow_circle:'🟡',green_circle:'🟢',blue_circle:'🔵',purple_circle:'🟣',brown_circle:'🟤',black_circle:'⚫️',white_circle:'⚪️',red_square:'🟥',orange_square:'🟧',yellow_square:'🟨',green_square:'🟩',blue_square:'🟦',purple_square:'🟪',brown_square:'🟫',black_large_square:'⬛️',white_large_square:'⬜️',black_medium_square:'◼️',white_medium_square:'◻️',black_medium_small_square:'◾️',white_medium_small_square:'◽️',black_small_square:'▪️',white_small_square:'▫️',large_orange_diamond:'🔶',large_blue_diamond:'🔷',small_orange_diamond:'🔸',small_blue_diamond:'🔹',small_red_triangle:'🔺',small_red_triangle_down:'🔻',diamond_shape_with_a_dot_inside:'💠',radio_button:'🔘',white_square_button:'🔳',black_square_button:'🔲',checkered_flag:'🏁',triangular_flag_on_post:'🚩',crossed_flags:'🎌',flag_black:'🏴',flag_white:'🏳️',gay_pride_flag:'🏳️‍🌈',transgender_flag:'🏳️‍⚧️',pirate_flag:'🏴‍☠️',ac:'🇦🇨',ad:'🇦🇩',ae:'🇦🇪',af:'🇦🇫',ag:'🇦🇬',ai:'🇦🇮',al:'🇦🇱',am:'🇦🇲',ao:'🇦🇴',aq:'🇦🇶',ar:'🇦🇷',as:'🇦🇸',at:'🇦🇹',au:'🇦🇺',aw:'🇦🇼',ax:'🇦🇽',az:'🇦🇿',ba:'🇧🇦',bb:'🇧🇧',bd:'🇧🇩',be:'🇧🇪',bf:'🇧🇫',bg:'🇧🇬',bh:'🇧🇭',bi:'🇧🇮',bj:'🇧🇯',bl:'🇧🇱',bm:'🇧🇲',bn:'🇧🇳',bo:'🇧🇴',bq:'🇧🇶',br:'🇧🇷',bs:'🇧🇸',bt:'🇧🇹',bv:'🇧🇻',bw:'🇧🇼',by:'🇧🇾',bz:'🇧🇿',ca:'🇨🇦',cc:'🇨🇨',congo:'🇨🇩',cf:'🇨🇫',cg:'🇨🇬',ch:'🇨🇭',ci:'🇨🇮',ck:'🇨🇰',chile:'🇨🇱',cm:'🇨🇲',cn:'🇨🇳',co:'🇨🇴',cp:'🇨🇵',cr:'🇨🇷',cu:'🇨🇺',cv:'🇨🇻',cw:'🇨🇼',cx:'🇨🇽',cy:'🇨🇾',cz:'🇨🇿',de:'🇩🇪',dg:'🇩🇬',dj:'🇩🇯',dk:'🇩🇰',dm:'🇩🇲','do':'🇩🇴',dz:'🇩🇿',ea:'🇪🇦',ec:'🇪🇨',ee:'🇪🇪',eg:'🇪🇬',eh:'🇪🇭',er:'🇪🇷',es:'🇪🇸',et:'🇪🇹',eu:'🇪🇺',fi:'🇫🇮',fj:'🇫🇯',fk:'🇫🇰',flag_fm:'🇫🇲',flag_fo:'🇫🇴',flag_fr:'🇫🇷',flag_ga:'🇬🇦',flag_gb:'🇬🇧',flag_gd:'🇬🇩',flag_ge:'🇬🇪',flag_gf:'🇬🇫',flag_gg:'🇬🇬',flag_gh:'🇬🇭',flag_gi:'🇬🇮',flag_gl:'🇬🇱',flag_gm:'🇬🇲',flag_gn:'🇬🇳',flag_gp:'🇬🇵',flag_gq:'🇬🇶',flag_gr:'🇬🇷',flag_gs:'🇬🇸',flag_gt:'🇬🇹',flag_gu:'🇬🇺',flag_gw:'🇬🇼',flag_gy:'🇬🇾',flag_hk:'🇭🇰',flag_hm:'🇭🇲',flag_hn:'🇭🇳',flag_hr:'🇭🇷',flag_ht:'🇭🇹',flag_hu:'🇭🇺',flag_ic:'🇮🇨',flag_id:'🇮🇩',flag_ie:'🇮🇪',flag_il:'🇮🇱',flag_im:'🇮🇲',flag_in:'🇮🇳',flag_io:'🇮🇴',flag_iq:'🇮🇶',flag_ir:'🇮🇷',flag_is:'🇮🇸',flag_it:'🇮🇹',flag_je:'🇯🇪',flag_jm:'🇯🇲',flag_jo:'🇯🇴',flag_jp:'🇯🇵',flag_ke:'🇰🇪',flag_kg:'🇰🇬',flag_kh:'🇰🇭',flag_ki:'🇰🇮',flag_km:'🇰🇲',flag_kn:'🇰🇳',flag_kp:'🇰🇵',flag_kr:'🇰🇷',flag_kw:'🇰🇼',flag_ky:'🇰🇾',flag_kz:'🇰🇿',flag_la:'🇱🇦',flag_lb:'🇱🇧',flag_lc:'🇱🇨',flag_li:'🇱🇮',flag_lk:'🇱🇰',flag_lr:'🇱🇷',flag_ls:'🇱🇸',flag_lt:'🇱🇹',flag_lu:'🇱🇺',flag_lv:'🇱🇻',flag_ly:'🇱🇾',flag_ma:'🇲🇦',flag_mc:'🇲🇨',flag_md:'🇲🇩',flag_me:'🇲🇪',flag_mf:'🇲🇫',flag_mg:'🇲🇬',flag_mh:'🇲🇭',flag_mk:'🇲🇰',flag_ml:'🇲🇱',flag_mm:'🇲🇲',flag_mn:'🇲🇳',flag_mo:'🇲🇴',flag_mp:'🇲🇵',flag_mq:'🇲🇶',flag_mr:'🇲🇷',flag_ms:'🇲🇸',flag_mt:'🇲🇹',flag_mu:'🇲🇺',flag_mv:'🇲🇻',flag_mw:'🇲🇼',flag_mx:'🇲🇽',flag_my:'🇲🇾',flag_mz:'🇲🇿',flag_na:'🇳🇦',flag_nc:'🇳🇨',flag_ne:'🇳🇪',flag_nf:'🇳🇫',flag_ng:'🇳🇬',flag_ni:'🇳🇮',flag_nl:'🇳🇱',flag_no:'🇳🇴',flag_np:'🇳🇵',flag_nr:'🇳🇷',flag_nu:'🇳🇺',flag_nz:'🇳🇿',flag_om:'🇴🇲',flag_pa:'🇵🇦',flag_pe:'🇵🇪',flag_pf:'🇵🇫',flag_pg:'🇵🇬',flag_ph:'🇵🇭',flag_pk:'🇵🇰',flag_pl:'🇵🇱',flag_pm:'🇵🇲',flag_pn:'🇵🇳',flag_pr:'🇵🇷',flag_ps:'🇵🇸',flag_pt:'🇵🇹',flag_pw:'🇵🇼',flag_py:'🇵🇾',flag_qa:'🇶🇦',flag_re:'🇷🇪',flag_ro:'🇷🇴',flag_rs:'🇷🇸',flag_ru:'🇷🇺',flag_rw:'🇷🇼',flag_sa:'🇸🇦',flag_sb:'🇸🇧',flag_sc:'🇸🇨',flag_sd:'🇸🇩',flag_se:'🇸🇪',flag_sg:'🇸🇬',flag_sh:'🇸🇭',flag_si:'🇸🇮',flag_sj:'🇸🇯',flag_sk:'🇸🇰',flag_sl:'🇸🇱',flag_sm:'🇸🇲',flag_sn:'🇸🇳',flag_so:'🇸🇴',flag_sr:'🇸🇷',flag_ss:'🇸🇸',flag_st:'🇸🇹',flag_sv:'🇸🇻',flag_sx:'🇸🇽',flag_sy:'🇸🇾',flag_sz:'🇸🇿',flag_ta:'🇹🇦',flag_tc:'🇹🇨',flag_td:'🇹🇩',flag_tf:'🇹🇫',flag_tg:'🇹🇬',flag_th:'🇹🇭',flag_tj:'🇹🇯',flag_tk:'🇹🇰',flag_tl:'🇹🇱',flag_tm:'🇹🇲',flag_tn:'🇹🇳',flag_to:'🇹🇴',flag_tr:'🇹🇷',flag_tt:'🇹🇹',flag_tv:'🇹🇻',flag_tw:'🇹🇼',flag_tz:'🇹🇿',flag_ua:'🇺🇦',flag_ug:'🇺🇬',flag_um:'🇺🇲',united_nations:'🇺🇳',flag_us:'🇺🇸',flag_uy:'🇺🇾',flag_uz:'🇺🇿',flag_va:'🇻🇦',flag_vc:'🇻🇨',flag_ve:'🇻🇪',flag_vg:'🇻🇬',flag_vi:'🇻🇮',flag_vn:'🇻🇳',flag_vu:'🇻🇺',flag_wf:'🇼🇫',flag_ws:'🇼🇸',flag_xk:'🇽🇰',flag_ye:'🇾🇪',flag_yt:'🇾🇹',flag_za:'🇿🇦',flag_zm:'🇿🇲',flag_zw:'🇿🇼',england:'🏴󠁧󠁢󠁥󠁮󠁧󠁿',scotland:'🏴󠁧󠁢󠁳󠁣󠁴󠁿',wales:'🏴󠁧󠁢󠁷󠁬󠁳󠁿',regional_indicator_a:'🇦',regional_indicator_b:'🇧',regional_indicator_c:'🇨',regional_indicator_d:'🇩',regional_indicator_e:'🇪',regional_indicator_f:'🇫',regional_indicator_g:'🇬',regional_indicator_h:'🇭',regional_indicator_i:'🇮',regional_indicator_j:'🇯',regional_indicator_k:'🇰',regional_indicator_l:'🇱',regional_indicator_m:'🇲',regional_indicator_n:'🇳',regional_indicator_o:'🇴',regional_indicator_p:'🇵',regional_indicator_q:'🇶',regional_indicator_r:'🇷',regional_indicator_s:'🇸',regional_indicator_t:'🇹',regional_indicator_u:'🇺',regional_indicator_v:'🇻',regional_indicator_w:'🇼',regional_indicator_x:'🇽',regional_indicator_y:'🇾',regional_indicator_z:'🇿'};TankTroubleAddons.getEmojisInString=function(string){string=string.replaceAll(':','⫶');var originalLength=string.length;var resultsTable=[];var regex=/⫶[^⫶\\s]*(?:⫶⫶[⫶\\s]*)*⫶/u;while((match=regex.exec(string))!=null){var code=match[0].slice(1,-1);var emoji=this.emojiTable[code.toLowerCase()]?this.emojiTable[code.toLowerCase()]:this.getEmoteFromString(code);string=string.replace(match[0],emoji)}string=string.replaceAll('⫶',':');return string};TankTroubleAddons.getEmoteFromString=function(string){switch(string){" + emotesImagesText + "return ' ։'+d_url('images/emotes/'+string+'.png')+'։ ';" + emotesGifsText + "return ' ։'+d_url('images/emotes/'+string+'.gif')+'։ ';default:return':'+string+':';break}};";
                                document.head.appendChild(emojiScripts);
                            })
                        });

                        var today = new Date;
                        var year = today.getFullYear();
                        if (today > new Date('Dec 1 ' + year) && today < new Date('Dec 26 ' + year)) {
                            var flakesScript = document.createElement('script');
                            flakesScript.innerHTML = '$(window).load(function(){$("#header").prepend(\'<canvas id="headerCanvas" style="pointer-events: none; position: absolute;width: 100%;height: 100%;"></canvas>\');var canvas=document.querySelector("#headerCanvas"),ctx=canvas.getContext("2d"),windowW=canvas.offsetWidth,windowH=canvas.offsetHeight,numFlakes=20,flakes=[];function Flake(x,y){var maxWeight=7,maxSpeed=.9;this.x=x;this.y=y;this.r=randomBetween(.05,.4);this.a=randomBetween(0,Math.PI);this.aStep=.01;this.weight=randomBetween(2,maxWeight);this.alpha=this.weight/maxWeight;this.speed=this.weight/maxWeight*maxSpeed;this.update=function(){this.x+=Math.cos(this.a)*this.r;this.a+=this.aStep;this.y+=this.speed}}function init(){var i=numFlakes,flake,x,y;while(i--){x=randomBetween(0,windowW,true);y=randomBetween(0,windowH,true);flake=new Flake(x,y);flakes.push(flake)}scaleCanvas();loop()}function scaleCanvas(){canvas.width=windowW;canvas.height=windowH}function loop(){var i=flakes.length,z,dist,flakeA,flakeB;ctx.save();ctx.setTransform(1,0,0,1,0,0);ctx.clearRect(0,0,windowW,windowH);ctx.restore();while(i--){flakeA=flakes[i];flakeA.update();ctx.beginPath();ctx.arc(flakeA.x,flakeA.y,flakeA.weight,0,2*Math.PI,false);ctx.fillStyle="rgba(255, 255, 255, "+flakeA.alpha+")";ctx.fill();if(flakeA.y>=windowH){flakeA.y=-flakeA.weight}}if(windowH==0){return}requestAnimationFrame(loop)}function randomBetween(min,max,round){var num=Math.random()*(max-min+1)+min;if(round){return Math.floor(num)}else{return num}}function distanceBetween(vector1,vector2){var dx=vector2.x-vector1.x,dy=vector2.y-vector1.y;return Math.sqrt(dx*dx+dy*dy)}function onResize(element,callback){var checkInterval=setInterval(function(){if(element.offsetHeight==0){clearInterval(checkInterval)}if(element.offsetHeight!==windowH||element.offsetWidth!==windowW){windowH=element.offsetHeight;windowW=element.offsetWidth;callback()}},300)}onResize(canvas,scaleCanvas);init()});';
                            document.head.appendChild(flakesScript);
                        }
                        var AddonLoader = document.createElement('script');
                        document.head.appendChild(AddonLoader);
                    }
                    injectScripts();
                    window.onload = function () {
                        document.body.insertAdjacentHTML('beforeend', '<div id="image-placeholder">');
                    }
                });
        }
    }
    TankTroubleAddons.main();
})();